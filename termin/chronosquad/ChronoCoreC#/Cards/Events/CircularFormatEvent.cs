using System;
using UnityEngine;
using System.Collections.Generic;

public class CircularFormatEvent : GlobalEvent
{
    [IgnoreRefflectionAttribute]
    List<MyList<IAStarNode>> format_pathes;

    [IgnoreRefflectionAttribute]
    MyList<IAStarNode> all_nodes;

    public CircularFormatEvent(long step, MyList<IAStarEdge> graph, IAStarNode start_node)
        : base(step + 1, step + 400)
    {
        int scan_radius = 3;
        format_pathes = AStarSolver.CircularScan(graph, start_node, scan_radius);

        all_nodes = new MyList<IAStarNode>();
        foreach (var path in format_pathes)
        {
            foreach (var node in path)
            {
                //if (!all_nodes.Contains(node))
                all_nodes.Add(node);
            }
        }
    }

    public override void update(long current_step, ITimeline tl)
    {
        // int maxstep = 3;

        // foreach (var path in format_pathes)
        // {
        // 	for (int i = 0; i < maxstep; i++)
        // 	{
        // 		IAStarNode node = path[i];
        // 		var netpoint = node as NetPoint;
        // 		if (netpoint == null)
        // 			continue;

        // 		Debug.Log("NetPoint: " + netpoint.Name);

        // 		var avatars = netpoint.AvatarInPoint;
        // 		foreach (var avatar in avatars)
        // 		{
        // 			Debug.Log("avatar: " + avatar);
        // 		}
        // 	}
        // }
    }

    public override void on_enter(long current_step, ITimeline tl)
    {
        foreach (var node in all_nodes)
        {
            var netpoint = node as NetPoint;
            if (netpoint == null)
                continue;

            netpoint.IncrementFormatedZoneMark();
        }
    }

    public override void on_leave(long current_step, ITimeline tl)
    {
        foreach (var node in all_nodes)
        {
            var netpoint = node as NetPoint;
            if (netpoint == null)
                continue;

            netpoint.DecrementFormatedZoneMark();
        }
    }

    //BEGIN################################################################
    // This code was generated by FieldScanner

    public override long HashCode()
    {
        long result = 0;
        result = FieldScanner.ModifyHash(result, start_step);
        result = FieldScanner.ModifyHash(result, finish_step);
        return result;
    }

    public override bool Equals(object obj)
    {
        if (obj == null)
            return false;
        if (obj.GetType() != GetType())
            return false;
        var other = obj as CircularFormatEvent;
        return start_step == other.start_step && finish_step == other.finish_step && true;
    }

    public override int GetHashCode()
    {
        return (int)HashCode();
    }
    //END################################################################
}
