#if UNITY_64
using UnityEngine;
#endif

using System;
using System.Collections.Generic;

public struct CoinPathPoint
{
    public Vector3 _position;
    public long _step_from_start;
}

public abstract class ParametricCurve3d
{
    public abstract Vector3 Evaluate(float t);
}

public class ParabolicCurve3d : ParametricCurve3d
{
    private Vector3 _start;
    private Vector3 _end;
    private float _height;

    public ParabolicCurve3d(Vector3 start, Vector3 end, float height)
    {
        _start = start;
        _end = end;
        _height = height;
    }

    public override Vector3 Evaluate(float t)
    {
        return Vector3.Lerp(_start, _end, t) + new Vector3(0, _height * 4 * t * (1 - t), 0);
    }
}

class CoinProjectileEvent : GlobalEvent
{
    private ParabolicCurve3d curve;

    [IgnoreRefflectionAttribute]
    private GameObject sphere;

    public CoinProjectileEvent(long start_step, long final_step, ParabolicCurve3d path)
        : base(start_step, final_step)
    {
        this.curve = path;
    }

    public override void on_enter(long current_step, ITimeline tl)
    {
        if (tl.IsTimeSpirit)
            return;

        // create sphere
        sphere = GameObject.CreatePrimitive(PrimitiveType.Sphere);
        sphere.transform.localScale = new Vector3(0.5f, 0.5f, 0.5f);
        sphere.layer = 13;
        update(current_step, tl);
    }

    public override void on_leave(long current_step, ITimeline tl)
    {
        if (tl.IsTimeSpirit)
            return;

        if (sphere != null)
        {
            GameObject.Destroy(sphere);
        }
    }

    public override void update(long current_step, ITimeline tl)
    {
        if (tl.IsTimeSpirit)
            return;

        float t = (float)(current_step - StartStep) / (float)(FinishStep - StartStep);
        Vector3 position = curve.Evaluate(t);
        sphere.transform.position = position;
    }

    //BEGIN################################################################
    // This code was generated by FieldScanner

    public override long HashCode()
    {
        long result = 0;
        result = FieldScanner.ModifyHash(result, curve);
        result = FieldScanner.ModifyHash(result, start_step);
        result = FieldScanner.ModifyHash(result, finish_step);
        return result;
    }

    public override bool Equals(object obj)
    {
        if (obj == null)
            return false;
        if (obj.GetType() != GetType())
            return false;
        var other = obj as CoinProjectileEvent;
        return curve == other.curve
            && start_step == other.start_step
            && finish_step == other.finish_step
            && true;
    }

    public override int GetHashCode()
    {
        return (int)HashCode();
    }
    //END################################################################
}
