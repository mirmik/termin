#if UNITY_64
using UnityEngine;
#endif

using System;

class BlindEffect : GlobalEvent
{
    Vector3 position;

    string MaterialName = "BlinkShaderMat";

    [IgnoreRefflectionAttribute]
    Material material = null;

    [IgnoreRefflectionAttribute]
    GameObject sphere1 = null;

    public BlindEffect(long start_step, long finish_step, Vector3 position, string material_name)
        : base(start_step, finish_step)
    {
        this.position = position;
        this.MaterialName = material_name;
    }

    public override void on_enter(long current_step, ITimeline tl)
    {
        if (tl.IsTimeSpirit)
            return;

        if (material == null)
        {
            if (MaterialKeeper.Instance == null)
                material = new Material("");
            else
                material = new Material(MaterialKeeper.Instance.GetMaterial(MaterialName));
        }

        if (sphere1 == null)
            sphere1 = GameObject.CreatePrimitive(PrimitiveType.Sphere);
        sphere1.transform.localScale = new Vector3(1.8f, 1.8f, 1.8f);
        sphere1.transform.position = position + new Vector3(0, 0.9f, 0);

        if (sphere1.GetComponent<Renderer>() != null)
            sphere1.GetComponent<Renderer>().material = material;

        sphere1.layer = 13;
    }

    public override void on_leave(long current_step, ITimeline tl)
    {
        if (tl.IsTimeSpirit)
            return;

        GameObject.Destroy(sphere1);
        sphere1 = null;
    }

    public float Intensivity(long stepstamp)
    {
        float center = (FinishStep - StartStep) / 2;
        float a = (stepstamp - StartStep) - center;
        return 1 - Math.Abs(a / center);
    }

    public override void update(long current_step, ITimeline tl)
    {
        if (tl.IsTimeSpirit)
            return;

        material.SetFloat("intensivity", Intensivity(current_step));
    }

    //BEGIN################################################################
    // This code was generated by FieldScanner

    public override long HashCode()
    {
        long result = 0;
        result = FieldScanner.ModifyHash(result, position);
        result = FieldScanner.ModifyHash(result, MaterialName);
        result = FieldScanner.ModifyHash(result, start_step);
        result = FieldScanner.ModifyHash(result, finish_step);
        return result;
    }

    public override bool Equals(object obj)
    {
        if (obj == null)
            return false;
        if (obj.GetType() != GetType())
            return false;
        var other = obj as BlindEffect;
        return position == other.position
            && MaterialName == other.MaterialName
            && start_step == other.start_step
            && finish_step == other.finish_step
            && true;
    }

    public override int GetHashCode()
    {
        return (int)HashCode();
    }
    //END################################################################
}
