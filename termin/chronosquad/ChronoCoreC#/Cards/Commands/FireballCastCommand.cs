using System.Collections;
using System.Collections.Generic;
using System;
using UnityEngine;

public class FireballCastCommand : ThrowToEnvironmentCommand
{
    public float radius_of_sound = 2;

    public FireballCastCommand(
        ReferencedPoint target,
        float shoot_distance,
        float radius_of_sound,
        long stamp
    ) : base(target, shoot_distance, stamp)
    {
        this.radius_of_sound = radius_of_sound;
    }

    override protected void AddEvents(ObjectOfTimeline actor, ITimeline tl)
    {
        var target = _target_position.GlobalPosition(tl);
        //long offset = (long)(0.0f * Utility.GAME_GLOBAL_FREQUENCY);

        var global_step = tl.CurrentStep();
        Vector3 gun_position = actor.GunPosition();

        float blaster_speed = 10.0f;
        var target_global = _target_position.GlobalPosition(tl);
        float distance = Vector3.Distance(gun_position, target_global);
        float time = distance / blaster_speed;

        var shoot_event = new FireballEffect(
            start_step: global_step,
            finish_step: global_step + (long)(time * Utility.GAME_GLOBAL_FREQUENCY),
            position1: gun_position,
            position2: target_global
        );
        tl.AddEvent(shoot_event);
    }

    public override bool IsTrajectoryClear(
        ObjectOfTimeline actor,
        ITimeline timeline,
        Vector3 target_global
    )
    {
        return GameCore.InLineOfSight(actor, target_global, maxdistance: shoot_distance);
    }

    //BEGIN################################################################
    // This code was generated by FieldScanner

    public override long HashCode()
    {
        long result = 0;
        result = FieldScanner.ModifyHash(result, radius_of_sound);
        result = FieldScanner.ModifyHash(result, shoot_distance);
        result = FieldScanner.ModifyHash(result, noise_parameters);
        result = FieldScanner.ModifyHash(result, can_shoot_from_croach);
        result = FieldScanner.ModifyHash(result, _target_position);
        result = FieldScanner.ModifyHash(result, _target_type);
        result = FieldScanner.ModifyHash(result, _start_type);
        result = FieldScanner.ModifyHash(result, _walking_type);
        result = FieldScanner.ModifyHash(result, _braced_coordinates);
        result = FieldScanner.ModifyHash(result, _look_around);
        result = FieldScanner.ModifyHash(result, start_step);
        result = FieldScanner.ModifyHash(result, finish_step);
        return result;
    }

    public override bool Equals(object obj)
    {
        if (obj == null)
            return false;
        if (obj.GetType() != GetType())
            return false;
        var other = obj as FireballCastCommand;
        return radius_of_sound == other.radius_of_sound
            && shoot_distance == other.shoot_distance
            && noise_parameters == other.noise_parameters
            && can_shoot_from_croach == other.can_shoot_from_croach
            && _target_position == other._target_position
            && _target_type == other._target_type
            && _start_type == other._start_type
            && _walking_type == other._walking_type
            && _braced_coordinates == other._braced_coordinates
            && _look_around == other._look_around
            && start_step == other.start_step
            && finish_step == other.finish_step
            && true;
    }

    public override int GetHashCode()
    {
        return (int)HashCode();
    }
    //END################################################################
}
