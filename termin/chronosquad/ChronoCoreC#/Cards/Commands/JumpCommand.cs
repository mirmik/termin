using System.Collections;
using System.Collections.Generic;
using System;
using UnityEngine;

public class JumpCommand : MovingCommand
{
    public float radius_of_sound = 2;
    public float jump_radius;

    public JumpCommand(ReferencedPoint target, float jump_radius, long stamp)
        : base(target, WalkingType.Run, stamp: stamp, PathFindingTarget.Standart)
    {
        this.jump_radius = jump_radius;
    }

    protected void AddEvents(ObjectOfTimeline actor, ITimeline tl)
    {
        (actor as Actor).JumpImpl(_target_position);
    }

    public bool IsTrajectoryClear(ObjectOfTimeline actor, ITimeline timeline, Vector3 target_global)
    {
        return GameCore.InLineOfSight(actor, target_global, maxdistance: jump_radius);
    }

    bool JumpPhase(ObjectOfTimeline actor, ITimeline timeline)
    {
        AddEvents(actor, timeline);
        return true;
    }

    public override bool Execute(ObjectOfTimeline actor, ITimeline timeline)
    {
        var current_position = actor.CurrentReferencedPosition();
        var target_global = _target_position.GlobalPosition(timeline);
        target_global += new Vector3(0, 0.5f, 0);

        if (IsTrajectoryClear(actor, timeline, target_global))
        {
            return JumpPhase(actor, timeline);
        }

        if (current_position.DistanceTo(_target_position, timeline) < 0.1f)
        {
            return true;
        }

        return false;
    }

    //BEGIN################################################################
    // This code was generated by FieldScanner

    public override long HashCode()
    {
        long result = 0;
        result = FieldScanner.ModifyHash(result, radius_of_sound);
        result = FieldScanner.ModifyHash(result, jump_radius);
        result = FieldScanner.ModifyHash(result, _target_position);
        result = FieldScanner.ModifyHash(result, _target_type);
        result = FieldScanner.ModifyHash(result, _start_type);
        result = FieldScanner.ModifyHash(result, _walking_type);
        result = FieldScanner.ModifyHash(result, _braced_coordinates);
        result = FieldScanner.ModifyHash(result, _look_around);
        result = FieldScanner.ModifyHash(result, start_step);
        result = FieldScanner.ModifyHash(result, finish_step);
        return result;
    }

    public override bool Equals(object obj)
    {
        if (obj == null)
            return false;
        if (obj.GetType() != GetType())
            return false;
        var other = obj as JumpCommand;
        return radius_of_sound == other.radius_of_sound
            && jump_radius == other.jump_radius
            && _target_position == other._target_position
            && _target_type == other._target_type
            && _start_type == other._start_type
            && _walking_type == other._walking_type
            && _braced_coordinates == other._braced_coordinates
            && _look_around == other._look_around
            && start_step == other.start_step
            && finish_step == other.finish_step
            && true;
    }

    public override int GetHashCode()
    {
        return (int)HashCode();
    }
    //END################################################################
}
