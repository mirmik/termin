using System.Collections.Generic;
using System;

#if UNITY_64
using UnityEngine;
#endif

public class AvatarMoveCommand : ActorCommand
{
    private ObjectId target_location;
    bool ignore_pathfinding = false;

    public AvatarMoveCommand() { }

    public AvatarMoveCommand(ObjectId target_position, long stamp, bool ignore_pathfinding = false)
        : base(stamp)
    {
        this.target_location = target_position;
        this.ignore_pathfinding = ignore_pathfinding;
    }

    public void MovingPhase(ObjectOfTimeline actor, ITimeline timeline)
    {
        var net_point = timeline.GetObject(target_location).GetComponent<NetPoint>();
        (actor as Avatar).MoveToNetworkPoint(net_point, ignore_pathfinding: ignore_pathfinding);
    }

    public override bool ExecuteFirstTime(ObjectOfTimeline actor, ITimeline timeline)
    {
        MovingPhase(actor, timeline);
        return false;
    }

    public override bool Execute(ObjectOfTimeline actor, ITimeline timeline)
    {
        var target_position = TargetPosition(timeline);
        var current_position = actor.CurrentReferencedPosition();
        if (current_position.DistanceTo(target_position, timeline) < 0.1f)
        {
            return true;
        }

        return false;
    }

    public ReferencedPoint TargetPosition(ITimeline timeline)
    {
        return timeline.GetObject(target_location).CurrentReferencedPose().ToPoint();
    }

    public override void CancelHandler(CommandBufferBehaviour behaviour) { }

    //BEGIN################################################################
    // This code was generated by FieldScanner

    public override long HashCode()
    {
        long result = 0;
        result = FieldScanner.ModifyHash(result, target_location);
        result = FieldScanner.ModifyHash(result, ignore_pathfinding);
        result = FieldScanner.ModifyHash(result, start_step);
        result = FieldScanner.ModifyHash(result, finish_step);
        return result;
    }

    public override bool Equals(object obj)
    {
        if (obj == null)
            return false;
        if (obj.GetType() != GetType())
            return false;
        var other = obj as AvatarMoveCommand;
        return target_location == other.target_location
            && ignore_pathfinding == other.ignore_pathfinding
            && start_step == other.start_step
            && finish_step == other.finish_step
            && true;
    }

    public override int GetHashCode()
    {
        return (int)HashCode();
    }
    //END################################################################
}
