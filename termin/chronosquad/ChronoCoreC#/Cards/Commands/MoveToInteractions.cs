using System.Collections.Generic;
using System;

#if UNITY_64
using UnityEngine;
#endif

public class MoveToInteractionCommand : ClosestCommand
{
    public MoveToInteractionCommand(ObjectId target_actor, WalkingType walktype, long stamp)
        : base(target_actor, walktype, 0.5f, stamp) { }

    void StartInteractPhase(ObjectOfTimeline actor, ITimeline timeline)
    {
        actor.UnDisguise();
        actor.ShowModel();

        var target_actor = TargetObject(timeline);
        var curstep = actor.LocalStep();
        InteractionAnimatronic punch = new InteractionAnimatronic(
            start_step: curstep + 0,
            finish_step: curstep + 100,
            pose: target_actor.InteractionPose()
        );
        actor.SetNextAnimatronic(punch);
    }

    void InteractTarget(ObjectOfTimeline obj, ITimeline timeline)
    {
        var target = TargetObject(timeline);
        var _interaction_component = target.GetInteraction();
        if (_interaction_component != null)
            _interaction_component.ApplyInteraction(obj);
    }

    public override bool ActionPhase(ObjectOfTimeline actor, ITimeline timeline)
    {
        bool is_shoot_started = actor.CurrentAnimatronic() is InteractionAnimatronic;

        if (!is_shoot_started)
        {
            StartInteractPhase(actor, timeline);
            return false;
        }
        else
        {
            var start_local_time = actor.CurrentAnimatronic().StartStep;
            var current_local_time = actor.LocalStep();
            if (current_local_time - start_local_time > 100)
            {
                InteractTarget(actor, timeline);
                return true;
            }
            else
            {
                return false;
            }
        }
    }

    public override bool IsActionStarted(ObjectOfTimeline actor)
    {
        return actor.CurrentAnimatronic() is InteractionAnimatronic;
    }

    //BEGIN################################################################
    // This code was generated by FieldScanner

    public override long HashCode()
    {
        long result = 0;
        result = FieldScanner.ModifyHash(result, _action_distance);
        result = FieldScanner.ModifyHash(result, target_actor_name);
        result = FieldScanner.ModifyHash(result, can_use_air_strike);
        result = FieldScanner.ModifyHash(result, walktype);
        result = FieldScanner.ModifyHash(result, use_interaction_pose);
        result = FieldScanner.ModifyHash(result, start_step);
        result = FieldScanner.ModifyHash(result, finish_step);
        return result;
    }

    public override bool Equals(object obj)
    {
        if (obj == null)
            return false;
        if (obj.GetType() != GetType())
            return false;
        var other = obj as MoveToInteractionCommand;
        return _action_distance == other._action_distance
            && target_actor_name == other.target_actor_name
            && can_use_air_strike == other.can_use_air_strike
            && walktype == other.walktype
            && use_interaction_pose == other.use_interaction_pose
            && start_step == other.start_step
            && finish_step == other.finish_step
            && true;
    }

    public override int GetHashCode()
    {
        return (int)HashCode();
    }
    //END################################################################
}
