using System;
using System.Collections.Generic;

#if UNITY_64
using UnityEngine;
#endif
public class WalkieTalkieComponent : ItemComponent
{
    public WalkieTalkieComponent(ObjectOfTimeline owner) : base(owner) { }

    MyList<string> message_targets = new MyList<string>();
    long _period = (long)(1.0f * Utility.GAME_GLOBAL_FREQUENCY);

    public override void Promote(long local_step) { }

    public void ExecuteForActor(
        Actor actor,
        long timeline_step,
        long local_step,
        ITimeline timeline
    )
    {
        var WalkieTalkieConnection = new WalkieTalkieConnection(timeline_step, message_targets);
        timeline.AddEvent(WalkieTalkieConnection);
    }

    public override void Execute(long timeline_step, long local_step)
    {
        var timeline = _owner.GetTimeline();
        foreach (var target in message_targets)
        {
            var actor = timeline.GetActor(target);
            if (actor == null)
            {
                Debug.Log("WalkieTalkieComponent:Execute: actor not found: " + target);
                continue;
            }
            ExecuteForActor(actor, timeline_step, local_step, timeline);
        }
    }

    public override ItemComponent Copy(ObjectOfTimeline newowner)
    {
        var component = new WalkieTalkieComponent(newowner);
        component.message_targets = new MyList<string>(message_targets);
        component._period = _period;
        return component;
    }
}

[Serializable]
public class WalkieTalkieConnection : GlobalEvent
{
    [IgnoreRefflectionAttribute]
    MyList<string> _targets;

    public WalkieTalkieConnection(long step, MyList<string> targets) : base(step)
    {
        _targets = targets;
    }

    public override void on_forward_enter(long current_step, ITimeline obj) { }

    public override void on_backward_leave(long current_step, ITimeline obj) { }

    //BEGIN################################################################
    // This code was generated by FieldScanner

    public override long HashCode()
    {
        long result = 0;
        result = FieldScanner.ModifyHash(result, start_step);
        result = FieldScanner.ModifyHash(result, finish_step);
        return result;
    }

    public override bool Equals(object obj)
    {
        if (obj == null)
            return false;
        if (obj.GetType() != GetType())
            return false;
        var other = obj as WalkieTalkieConnection;
        return start_step == other.start_step && finish_step == other.finish_step && true;
    }

    public override int GetHashCode()
    {
        return (int)HashCode();
    }
    //END################################################################
}
