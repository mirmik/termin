<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/algeom.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
&quot;&quot;&quot;Алгебраическая&nbsp;геометрия:&nbsp;квадратичные&nbsp;формы,&nbsp;эллипсоиды,&nbsp;коники.&quot;&quot;&quot;<br>
import&nbsp;numpy<br>
import&nbsp;math<br>
<br>
<br>
def&nbsp;fit_quadric(points,&nbsp;center=None):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Строит&nbsp;квадратичную&nbsp;форму&nbsp;(квадрику)&nbsp;по&nbsp;набору&nbsp;точек&nbsp;методом&nbsp;наименьших&nbsp;квадратов.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Универсальная&nbsp;функция&nbsp;для&nbsp;восстановления&nbsp;центральных&nbsp;квадрик:<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Эллипсоид&nbsp;(все&nbsp;собственные&nbsp;значения&nbsp;&gt;&nbsp;0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Гиперболоид&nbsp;(собственные&nbsp;значения&nbsp;разных&nbsp;знаков)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Квадрика&nbsp;задаётся&nbsp;уравнением:&nbsp;(x-c)ᵀ&nbsp;A&nbsp;(x-c)&nbsp;=&nbsp;±1,&nbsp;где:<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;A&nbsp;-&nbsp;симметричная&nbsp;матрица&nbsp;(задаёт&nbsp;форму&nbsp;и&nbsp;ориентацию)<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;c&nbsp;-&nbsp;центр&nbsp;квадрики<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;points:&nbsp;Массив&nbsp;точек&nbsp;размера&nbsp;(n_points,&nbsp;n_dim).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Точки&nbsp;должны&nbsp;приблизительно&nbsp;лежать&nbsp;на&nbsp;поверхности&nbsp;квадрики.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Минимум&nbsp;n_dim*(n_dim+3)/2&nbsp;точек&nbsp;для&nbsp;определённости.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;center:&nbsp;Центр&nbsp;квадрики&nbsp;размера&nbsp;(n_dim,).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Если&nbsp;None,&nbsp;центр&nbsp;определяется&nbsp;автоматически.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Если&nbsp;задан,&nbsp;строится&nbsp;квадрика&nbsp;с&nbsp;фиксированным&nbsp;центром.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A:&nbsp;Матрица&nbsp;квадратичной&nbsp;формы&nbsp;размера&nbsp;(n_dim,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;center:&nbsp;Центр&nbsp;квадрики&nbsp;размера&nbsp;(n_dim,)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Notes:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Решает&nbsp;задачу&nbsp;наименьших&nbsp;квадратов&nbsp;для&nbsp;общей&nbsp;квадратичной&nbsp;формы:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x²&nbsp;+&nbsp;B₁₁xy&nbsp;+&nbsp;B₁₂xz&nbsp;+&nbsp;B₂₂y²&nbsp;+&nbsp;B₂₃yz&nbsp;+&nbsp;B₃₃z²&nbsp;+&nbsp;C₁x&nbsp;+&nbsp;C₂y&nbsp;+&nbsp;C₃z&nbsp;+&nbsp;D&nbsp;=&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Метод&nbsp;не&nbsp;делает&nbsp;предположений&nbsp;о&nbsp;знаках&nbsp;собственных&nbsp;значений&nbsp;A.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Для&nbsp;специфичных&nbsp;проверок&nbsp;используйте&nbsp;fit_ellipsoid().<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;points&nbsp;=&nbsp;numpy.asarray(points,&nbsp;dtype=float)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;points.ndim&nbsp;!=&nbsp;2:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ValueError(f&quot;points&nbsp;должен&nbsp;быть&nbsp;2D&nbsp;массивом,&nbsp;получен&nbsp;{points.ndim}D&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;n_points,&nbsp;n_dim&nbsp;=&nbsp;points.shape<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Минимальное&nbsp;количество&nbsp;точек&nbsp;для&nbsp;определения&nbsp;квадрики<br>
&nbsp;&nbsp;&nbsp;&nbsp;min_points&nbsp;=&nbsp;n_dim&nbsp;*&nbsp;(n_dim&nbsp;+&nbsp;3)&nbsp;//&nbsp;2<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;n_points&nbsp;&lt;&nbsp;min_points:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ValueError(f&quot;Недостаточно&nbsp;точек:&nbsp;нужно&nbsp;минимум&nbsp;{min_points},&nbsp;получено&nbsp;{n_points}&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Решаем&nbsp;задачу&nbsp;подгонки<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;center&nbsp;is&nbsp;not&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;center&nbsp;=&nbsp;numpy.asarray(center,&nbsp;dtype=float)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;center.shape&nbsp;!=&nbsp;(n_dim,):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ValueError(f&quot;center&nbsp;должен&nbsp;иметь&nbsp;размер&nbsp;({n_dim},),&nbsp;получен&nbsp;{center.shape}&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;=&nbsp;_fit_quadric_fixed_center(points,&nbsp;center)<br>
&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A,&nbsp;center&nbsp;=&nbsp;_fit_quadric_auto_center(points)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;A,&nbsp;center<br>
<br>
<br>
def&nbsp;fit_ellipsoid(points,&nbsp;center=None):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Строит&nbsp;эллипсоид&nbsp;по&nbsp;набору&nbsp;точек&nbsp;с&nbsp;валидацией&nbsp;и&nbsp;вычислением&nbsp;полуосей.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Эллипсоид&nbsp;задаётся&nbsp;уравнением:&nbsp;(x-c)ᵀ&nbsp;A&nbsp;(x-c)&nbsp;=&nbsp;1,&nbsp;где:<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;A&nbsp;-&nbsp;положительно&nbsp;определённая&nbsp;матрица&nbsp;(задаёт&nbsp;форму&nbsp;и&nbsp;ориентацию)<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;c&nbsp;-&nbsp;центр&nbsp;эллипсоида<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;points:&nbsp;Массив&nbsp;точек&nbsp;размера&nbsp;(n_points,&nbsp;n_dim).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;center:&nbsp;Центр&nbsp;эллипсоида&nbsp;размера&nbsp;(n_dim,)&nbsp;или&nbsp;None.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A:&nbsp;Матрица&nbsp;квадратичной&nbsp;формы&nbsp;размера&nbsp;(n_dim,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;center:&nbsp;Центр&nbsp;эллипсоида&nbsp;размера&nbsp;(n_dim,)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;radii:&nbsp;Полуоси&nbsp;эллипсоида&nbsp;(собственные&nbsp;значения&nbsp;A⁻¹)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;axes:&nbsp;Направления&nbsp;осей&nbsp;(собственные&nbsp;векторы&nbsp;A)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Raises:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ValueError:&nbsp;Если&nbsp;восстановленная&nbsp;квадрика&nbsp;не&nbsp;является&nbsp;эллипсоидом<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Examples:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;#&nbsp;Точки&nbsp;на&nbsp;сфере&nbsp;радиуса&nbsp;2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;theta&nbsp;=&nbsp;np.linspace(0,&nbsp;2*np.pi,&nbsp;50)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;phi&nbsp;=&nbsp;np.linspace(0,&nbsp;np.pi,&nbsp;50)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;THETA,&nbsp;PHI&nbsp;=&nbsp;np.meshgrid(theta,&nbsp;phi)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;X&nbsp;=&nbsp;2&nbsp;*&nbsp;np.sin(PHI)&nbsp;*&nbsp;np.cos(THETA)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;Y&nbsp;=&nbsp;2&nbsp;*&nbsp;np.sin(PHI)&nbsp;*&nbsp;np.sin(THETA)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;Z&nbsp;=&nbsp;2&nbsp;*&nbsp;np.cos(PHI)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;points&nbsp;=&nbsp;np.column_stack([X.ravel(),&nbsp;Y.ravel(),&nbsp;Z.ravel()])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;A,&nbsp;center,&nbsp;radii,&nbsp;axes&nbsp;=&nbsp;fit_ellipsoid(points)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;radii&nbsp;&nbsp;#&nbsp;[2,&nbsp;2,&nbsp;2]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Восстанавливаем&nbsp;квадрику&nbsp;универсальным&nbsp;методом<br>
&nbsp;&nbsp;&nbsp;&nbsp;A,&nbsp;center&nbsp;=&nbsp;fit_quadric(points,&nbsp;center)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Проверяем,&nbsp;что&nbsp;это&nbsp;именно&nbsp;эллипсоид&nbsp;(все&nbsp;собственные&nbsp;значения&nbsp;&gt;&nbsp;0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;eigvals,&nbsp;eigvecs&nbsp;=&nbsp;numpy.linalg.eigh(A)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;numpy.any(eigvals&nbsp;&lt;=&nbsp;0):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ValueError(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Получена&nbsp;не&nbsp;положительно&nbsp;определённая&nbsp;матрица.&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Точки&nbsp;не&nbsp;лежат&nbsp;на&nbsp;эллипсоиде.&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Вычисляем&nbsp;полуоси&nbsp;=&nbsp;sqrt(1/λᵢ),&nbsp;так&nbsp;как&nbsp;(x-c)ᵀA(x-c)&nbsp;=&nbsp;1&nbsp;и&nbsp;A&nbsp;=&nbsp;VΛV^T<br>
&nbsp;&nbsp;&nbsp;&nbsp;radii&nbsp;=&nbsp;1.0&nbsp;/&nbsp;numpy.sqrt(eigvals)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Сортируем&nbsp;по&nbsp;убыванию&nbsp;полуосей&nbsp;(a&nbsp;≥&nbsp;b&nbsp;≥&nbsp;c)<br>
&nbsp;&nbsp;&nbsp;&nbsp;sort_idx&nbsp;=&nbsp;numpy.argsort(radii)[::-1]<br>
&nbsp;&nbsp;&nbsp;&nbsp;radii&nbsp;=&nbsp;radii[sort_idx]<br>
&nbsp;&nbsp;&nbsp;&nbsp;axes&nbsp;=&nbsp;eigvecs[:,&nbsp;sort_idx]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;A,&nbsp;center,&nbsp;radii,&nbsp;axes<br>
<br>
<br>
def&nbsp;fit_hyperboloid(points,&nbsp;center=None):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Строит&nbsp;гиперболоид&nbsp;по&nbsp;набору&nbsp;точек&nbsp;с&nbsp;валидацией&nbsp;и&nbsp;анализом&nbsp;типа.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Гиперболоид&nbsp;задаётся&nbsp;уравнением:&nbsp;(x-c)ᵀ&nbsp;A&nbsp;(x-c)&nbsp;=&nbsp;±1,&nbsp;где:<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;A&nbsp;-&nbsp;матрица&nbsp;со&nbsp;смешанными&nbsp;знаками&nbsp;собственных&nbsp;значений<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;c&nbsp;-&nbsp;центр&nbsp;гиперболоида<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;points:&nbsp;Массив&nbsp;точек&nbsp;размера&nbsp;(n_points,&nbsp;n_dim).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;center:&nbsp;Центр&nbsp;гиперболоида&nbsp;размера&nbsp;(n_dim,)&nbsp;или&nbsp;None.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A:&nbsp;Матрица&nbsp;квадратичной&nbsp;формы&nbsp;размера&nbsp;(n_dim,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;center:&nbsp;Центр&nbsp;гиперболоида&nbsp;размера&nbsp;(n_dim,)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eigvals:&nbsp;Собственные&nbsp;значения&nbsp;(с&nbsp;разными&nbsp;знаками)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eigvecs:&nbsp;Собственные&nbsp;векторы&nbsp;(главные&nbsp;направления)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hyperboloid_type:&nbsp;Тип&nbsp;гиперболоида:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&quot;one-sheet&quot;:&nbsp;однополостный&nbsp;(n-1&nbsp;положительных,&nbsp;1&nbsp;отрицательное)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&quot;two-sheet&quot;:&nbsp;двуполостный&nbsp;(n-2&nbsp;положительных,&nbsp;2&nbsp;отрицательных)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&quot;multi-sheet&quot;:&nbsp;многополостный&nbsp;(для&nbsp;размерностей&nbsp;&gt;&nbsp;3)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Raises:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ValueError:&nbsp;Если&nbsp;восстановленная&nbsp;квадрика&nbsp;не&nbsp;является&nbsp;гиперболоидом<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Examples:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;#&nbsp;Однополостный&nbsp;гиперболоид:&nbsp;x²/4&nbsp;+&nbsp;y²/4&nbsp;-&nbsp;z²&nbsp;=&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;u&nbsp;=&nbsp;np.linspace(0,&nbsp;2*np.pi,&nbsp;50)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;v&nbsp;=&nbsp;np.linspace(-2,&nbsp;2,&nbsp;50)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;U,&nbsp;V&nbsp;=&nbsp;np.meshgrid(u,&nbsp;v)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;X&nbsp;=&nbsp;2&nbsp;*&nbsp;np.cosh(V)&nbsp;*&nbsp;np.cos(U)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;Y&nbsp;=&nbsp;2&nbsp;*&nbsp;np.cosh(V)&nbsp;*&nbsp;np.sin(U)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;Z&nbsp;=&nbsp;2&nbsp;*&nbsp;np.sinh(V)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;points&nbsp;=&nbsp;np.column_stack([X.ravel(),&nbsp;Y.ravel(),&nbsp;Z.ravel()])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;A,&nbsp;center,&nbsp;eigvals,&nbsp;eigvecs,&nbsp;htype&nbsp;=&nbsp;fit_hyperboloid(points)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;htype&nbsp;&nbsp;#&nbsp;&quot;one-sheet&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Восстанавливаем&nbsp;квадрику&nbsp;универсальным&nbsp;методом<br>
&nbsp;&nbsp;&nbsp;&nbsp;A,&nbsp;center&nbsp;=&nbsp;fit_quadric(points,&nbsp;center)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Анализируем&nbsp;собственные&nbsp;значения<br>
&nbsp;&nbsp;&nbsp;&nbsp;eigvals,&nbsp;eigvecs&nbsp;=&nbsp;numpy.linalg.eigh(A)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;pos_count&nbsp;=&nbsp;numpy.sum(eigvals&nbsp;&gt;&nbsp;0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;neg_count&nbsp;=&nbsp;numpy.sum(eigvals&nbsp;&lt;&nbsp;0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;n_dim&nbsp;=&nbsp;len(eigvals)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Проверяем,&nbsp;что&nbsp;это&nbsp;гиперболоид&nbsp;(смешанные&nbsp;знаки)<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;pos_count&nbsp;==&nbsp;n_dim&nbsp;or&nbsp;neg_count&nbsp;==&nbsp;n_dim:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ValueError(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&quot;Получена&nbsp;квадрика&nbsp;с&nbsp;собственными&nbsp;значениями&nbsp;одного&nbsp;знака.&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&quot;Это&nbsp;эллипсоид,&nbsp;а&nbsp;не&nbsp;гиперболоид.&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&quot;Положительных:&nbsp;{pos_count},&nbsp;отрицательных:&nbsp;{neg_count}&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;pos_count&nbsp;==&nbsp;0&nbsp;or&nbsp;neg_count&nbsp;==&nbsp;0:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ValueError(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Получена&nbsp;вырожденная&nbsp;квадрика.&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Точки&nbsp;не&nbsp;лежат&nbsp;на&nbsp;гиперболоиде.&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Определяем&nbsp;тип&nbsp;гиперболоида<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;neg_count&nbsp;==&nbsp;1:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hyperboloid_type&nbsp;=&nbsp;&quot;one-sheet&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;neg_count&nbsp;==&nbsp;2:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hyperboloid_type&nbsp;=&nbsp;&quot;two-sheet&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hyperboloid_type&nbsp;=&nbsp;&quot;multi-sheet&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;A,&nbsp;center,&nbsp;eigvals,&nbsp;eigvecs,&nbsp;hyperboloid_type<br>
<br>
<br>
def&nbsp;fit_paraboloid(points):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Строит&nbsp;параболоид&nbsp;по&nbsp;набору&nbsp;точек&nbsp;методом&nbsp;линейной&nbsp;регрессии.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Параболоид&nbsp;задаётся&nbsp;уравнением:&nbsp;z&nbsp;=&nbsp;xᵀAx&nbsp;+&nbsp;bᵀx&nbsp;+&nbsp;c,&nbsp;где:<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;A&nbsp;-&nbsp;симметричная&nbsp;матрица&nbsp;размера&nbsp;(n-1,&nbsp;n-1)&nbsp;для&nbsp;координат&nbsp;(x₁,...,xₙ₋₁)<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;b&nbsp;-&nbsp;вектор&nbsp;линейных&nbsp;коэффициентов<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;c&nbsp;-&nbsp;константа<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;z&nbsp;=&nbsp;xₙ&nbsp;-&nbsp;зависимая&nbsp;переменная<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;points:&nbsp;Массив&nbsp;точек&nbsp;размера&nbsp;(n_points,&nbsp;n_dim).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Последняя&nbsp;координата&nbsp;считается&nbsp;зависимой&nbsp;(высота).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Минимум&nbsp;n_dim*(n_dim+1)/2&nbsp;точек.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A:&nbsp;Матрица&nbsp;квадратичной&nbsp;формы&nbsp;размера&nbsp;(n_dim-1,&nbsp;n_dim-1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b:&nbsp;Вектор&nbsp;линейных&nbsp;коэффициентов&nbsp;размера&nbsp;(n_dim-1,)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c:&nbsp;Константа&nbsp;(скаляр)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertex:&nbsp;Вершина&nbsp;параболоида&nbsp;размера&nbsp;(n_dim-1,)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eigvals:&nbsp;Собственные&nbsp;значения&nbsp;матрицы&nbsp;A<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eigvecs:&nbsp;Собственные&nbsp;векторы&nbsp;(главные&nbsp;направления&nbsp;кривизны)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Notes:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;В&nbsp;отличие&nbsp;от&nbsp;эллипсоида/гиперболоида,&nbsp;параболоид&nbsp;не&nbsp;является<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;центральной&nbsp;квадрикой.&nbsp;Он&nbsp;решается&nbsp;через&nbsp;линейную&nbsp;регрессию,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;где&nbsp;z&nbsp;явно&nbsp;выражается&nbsp;через&nbsp;остальные&nbsp;координаты.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Для&nbsp;3D:&nbsp;z&nbsp;=&nbsp;ax²&nbsp;+&nbsp;by²&nbsp;+&nbsp;cxy&nbsp;+&nbsp;dx&nbsp;+&nbsp;ey&nbsp;+&nbsp;f<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Вершина&nbsp;находится&nbsp;из&nbsp;условия&nbsp;∇z&nbsp;=&nbsp;0:&nbsp;vertex&nbsp;=&nbsp;-½A⁻¹b<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Examples:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;#&nbsp;Параболоид&nbsp;вращения:&nbsp;z&nbsp;=&nbsp;x²&nbsp;+&nbsp;y²<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;x&nbsp;=&nbsp;np.linspace(-2,&nbsp;2,&nbsp;50)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;y&nbsp;=&nbsp;np.linspace(-2,&nbsp;2,&nbsp;50)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;X,&nbsp;Y&nbsp;=&nbsp;np.meshgrid(x,&nbsp;y)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;Z&nbsp;=&nbsp;X**2&nbsp;+&nbsp;Y**2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;points&nbsp;=&nbsp;np.column_stack([X.ravel(),&nbsp;Y.ravel(),&nbsp;Z.ravel()])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;A,&nbsp;b,&nbsp;c,&nbsp;vertex,&nbsp;eigvals,&nbsp;eigvecs&nbsp;=&nbsp;fit_paraboloid(points)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;vertex&nbsp;&nbsp;#&nbsp;≈&nbsp;[0,&nbsp;0]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;points&nbsp;=&nbsp;numpy.asarray(points,&nbsp;dtype=float)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;points.ndim&nbsp;!=&nbsp;2:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ValueError(f&quot;points&nbsp;должен&nbsp;быть&nbsp;2D&nbsp;массивом,&nbsp;получен&nbsp;{points.ndim}D&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;n_points,&nbsp;n_dim&nbsp;=&nbsp;points.shape<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;n_dim&nbsp;&lt;&nbsp;2:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ValueError(f&quot;Параболоид&nbsp;требует&nbsp;минимум&nbsp;2D,&nbsp;получено&nbsp;{n_dim}D&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Минимальное&nbsp;количество&nbsp;точек&nbsp;для&nbsp;параболоида<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Для&nbsp;параметров&nbsp;квадратичной&nbsp;формы&nbsp;без&nbsp;z:&nbsp;(n-1)(n-1+1)/2&nbsp;+&nbsp;(n-1)&nbsp;+&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;min_points&nbsp;=&nbsp;(n_dim&nbsp;-&nbsp;1)&nbsp;*&nbsp;(n_dim)&nbsp;//&nbsp;2&nbsp;+&nbsp;(n_dim&nbsp;-&nbsp;1)&nbsp;+&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;n_points&nbsp;&lt;&nbsp;min_points:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ValueError(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&quot;Недостаточно&nbsp;точек&nbsp;для&nbsp;параболоида:&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&quot;нужно&nbsp;минимум&nbsp;{min_points},&nbsp;получено&nbsp;{n_points}&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Выделяем&nbsp;независимые&nbsp;координаты&nbsp;(x₁,...,xₙ₋₁)&nbsp;и&nbsp;зависимую&nbsp;(z&nbsp;=&nbsp;xₙ)<br>
&nbsp;&nbsp;&nbsp;&nbsp;x_coords&nbsp;=&nbsp;points[:,&nbsp;:-1]&nbsp;&nbsp;#&nbsp;(n_points,&nbsp;n_dim-1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;z_coords&nbsp;=&nbsp;points[:,&nbsp;-1]&nbsp;&nbsp;&nbsp;#&nbsp;(n_points,)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;n_indep&nbsp;=&nbsp;n_dim&nbsp;-&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Строим&nbsp;матрицу&nbsp;дизайна:&nbsp;[x₁²,&nbsp;x₁x₂,&nbsp;x₁x₃,&nbsp;x₂²,&nbsp;x₂x₃,&nbsp;x₃²,&nbsp;x₁,&nbsp;x₂,&nbsp;x₃,&nbsp;1]<br>
&nbsp;&nbsp;&nbsp;&nbsp;columns&nbsp;=&nbsp;[]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Квадратичные&nbsp;члены<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;range(n_indep):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;j&nbsp;in&nbsp;range(i,&nbsp;n_indep):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;i&nbsp;==&nbsp;j:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;columns.append(x_coords[:,&nbsp;i]&nbsp;**&nbsp;2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;columns.append(x_coords[:,&nbsp;i]&nbsp;*&nbsp;x_coords[:,&nbsp;j])<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Линейные&nbsp;члены<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;range(n_indep):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;columns.append(x_coords[:,&nbsp;i])<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Константный&nbsp;член<br>
&nbsp;&nbsp;&nbsp;&nbsp;columns.append(numpy.ones(n_points))<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;design_matrix&nbsp;=&nbsp;numpy.column_stack(columns)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Решаем&nbsp;линейную&nbsp;регрессию:&nbsp;z&nbsp;=&nbsp;design_matrix&nbsp;@&nbsp;coeffs<br>
&nbsp;&nbsp;&nbsp;&nbsp;coeffs,&nbsp;residuals,&nbsp;rank,&nbsp;s&nbsp;=&nbsp;numpy.linalg.lstsq(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;design_matrix,&nbsp;z_coords,&nbsp;rcond=None<br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Извлекаем&nbsp;коэффициенты<br>
&nbsp;&nbsp;&nbsp;&nbsp;n_quad&nbsp;=&nbsp;n_indep&nbsp;*&nbsp;(n_indep&nbsp;+&nbsp;1)&nbsp;//&nbsp;2<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Восстанавливаем&nbsp;симметричную&nbsp;матрицу&nbsp;A<br>
&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;=&nbsp;numpy.zeros((n_indep,&nbsp;n_indep))<br>
&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;=&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;range(n_indep):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;j&nbsp;in&nbsp;range(i,&nbsp;n_indep):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;i&nbsp;==&nbsp;j:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A[i,&nbsp;j]&nbsp;=&nbsp;coeffs[idx]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A[i,&nbsp;j]&nbsp;=&nbsp;coeffs[idx]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A[j,&nbsp;i]&nbsp;=&nbsp;coeffs[idx]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;+=&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Линейные&nbsp;коэффициенты<br>
&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;coeffs[n_quad:n_quad&nbsp;+&nbsp;n_indep]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Константа<br>
&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;coeffs[n_quad&nbsp;+&nbsp;n_indep]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Вычисляем&nbsp;вершину&nbsp;параболоида:&nbsp;точку&nbsp;экстремума<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;∇z&nbsp;=&nbsp;2Ax&nbsp;+&nbsp;b&nbsp;=&nbsp;0&nbsp;=&gt;&nbsp;x&nbsp;=&nbsp;-½A⁻¹b<br>
&nbsp;&nbsp;&nbsp;&nbsp;try:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A_inv&nbsp;=&nbsp;numpy.linalg.inv(A)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertex&nbsp;=&nbsp;-0.5&nbsp;*&nbsp;A_inv&nbsp;@&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;numpy.linalg.LinAlgError:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Вырожденный&nbsp;случай&nbsp;(например,&nbsp;цилиндр)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertex&nbsp;=&nbsp;numpy.zeros(n_indep)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertex[:]&nbsp;=&nbsp;numpy.nan<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Анализируем&nbsp;кривизну&nbsp;через&nbsp;собственные&nbsp;значения<br>
&nbsp;&nbsp;&nbsp;&nbsp;eigvals,&nbsp;eigvecs&nbsp;=&nbsp;numpy.linalg.eigh(A)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;A,&nbsp;b,&nbsp;c,&nbsp;vertex,&nbsp;eigvals,&nbsp;eigvecs<br>
<br>
<br>
def&nbsp;_fit_quadric_fixed_center(points,&nbsp;center):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Подгоняет&nbsp;квадрику&nbsp;с&nbsp;заданным&nbsp;центром.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;points:&nbsp;Массив&nbsp;точек&nbsp;размера&nbsp;(n_points,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;center:&nbsp;Центр&nbsp;квадрики&nbsp;размера&nbsp;(n_dim,)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Матрица&nbsp;A&nbsp;размера&nbsp;(n_dim,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;n_points,&nbsp;n_dim&nbsp;=&nbsp;points.shape<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Сдвигаем&nbsp;точки&nbsp;к&nbsp;центру<br>
&nbsp;&nbsp;&nbsp;&nbsp;points_centered&nbsp;=&nbsp;points&nbsp;-&nbsp;center<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Строим&nbsp;матрицу&nbsp;дизайна&nbsp;для&nbsp;квадратичной&nbsp;формы&nbsp;xᵀAx&nbsp;=&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;design_matrix&nbsp;=&nbsp;_build_quadratic_design_matrix(points_centered)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Решаем&nbsp;систему:&nbsp;design_matrix&nbsp;@&nbsp;coeffs&nbsp;=&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;coeffs,&nbsp;residuals,&nbsp;rank,&nbsp;s&nbsp;=&nbsp;numpy.linalg.lstsq(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;design_matrix,&nbsp;numpy.ones(n_points),&nbsp;rcond=None<br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Восстанавливаем&nbsp;симметричную&nbsp;матрицу&nbsp;A&nbsp;из&nbsp;коэффициентов<br>
&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;=&nbsp;_coeffs_to_matrix(coeffs,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;A<br>
<br>
<br>
def&nbsp;_fit_quadric_auto_center(points):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Подгоняет&nbsp;квадрику&nbsp;с&nbsp;автоматическим&nbsp;определением&nbsp;центра.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;points:&nbsp;Массив&nbsp;точек&nbsp;размера&nbsp;(n_points,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A:&nbsp;Матрица&nbsp;размера&nbsp;(n_dim,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;center:&nbsp;Центр&nbsp;размера&nbsp;(n_dim,)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;n_points,&nbsp;n_dim&nbsp;=&nbsp;points.shape<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Строим&nbsp;полную&nbsp;матрицу&nbsp;дизайна:&nbsp;[квадратичные,&nbsp;линейные,&nbsp;константа]<br>
&nbsp;&nbsp;&nbsp;&nbsp;design_matrix&nbsp;=&nbsp;_build_full_design_matrix(points)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Решаем&nbsp;однородную&nbsp;систему&nbsp;с&nbsp;ограничением&nbsp;||coeffs||&nbsp;=&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Используем&nbsp;SVD:&nbsp;решение&nbsp;=&nbsp;правый&nbsp;сингулярный&nbsp;вектор&nbsp;для&nbsp;минимального&nbsp;σ<br>
&nbsp;&nbsp;&nbsp;&nbsp;u,&nbsp;s,&nbsp;vh&nbsp;=&nbsp;numpy.linalg.svd(design_matrix,&nbsp;full_matrices=True)<br>
&nbsp;&nbsp;&nbsp;&nbsp;coeffs&nbsp;=&nbsp;vh[-1,&nbsp;:]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Извлекаем&nbsp;компоненты<br>
&nbsp;&nbsp;&nbsp;&nbsp;n_quad&nbsp;=&nbsp;n_dim&nbsp;*&nbsp;(n_dim&nbsp;+&nbsp;1)&nbsp;//&nbsp;2<br>
&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;=&nbsp;_coeffs_to_matrix(coeffs[:n_quad],&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;coeffs[n_quad:n_quad&nbsp;+&nbsp;n_dim]<br>
&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;=&nbsp;coeffs[n_quad&nbsp;+&nbsp;n_dim]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;SVD&nbsp;может&nbsp;дать&nbsp;решение&nbsp;с&nbsp;произвольным&nbsp;знаком<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Нормализуем&nbsp;так,&nbsp;чтобы&nbsp;след&nbsp;матрицы&nbsp;был&nbsp;положительным<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;numpy.trace(A)&nbsp;&lt;&nbsp;0:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;=&nbsp;-A<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;-b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;=&nbsp;-d<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Проверяем&nbsp;невырожденность<br>
&nbsp;&nbsp;&nbsp;&nbsp;eigvals&nbsp;=&nbsp;numpy.linalg.eigvalsh(A)<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;numpy.all(numpy.abs(eigvals)&nbsp;&lt;&nbsp;1e-10):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ValueError(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Получена&nbsp;вырожденная&nbsp;матрица.&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Точки&nbsp;не&nbsp;лежат&nbsp;на&nbsp;центральной&nbsp;квадрике.&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Находим&nbsp;центр:&nbsp;c&nbsp;=&nbsp;-½A⁻¹b<br>
&nbsp;&nbsp;&nbsp;&nbsp;try:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A_inv&nbsp;=&nbsp;numpy.linalg.inv(A)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;center&nbsp;=&nbsp;-0.5&nbsp;*&nbsp;A_inv&nbsp;@&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;numpy.linalg.LinAlgError:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ValueError(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Не&nbsp;удалось&nbsp;найти&nbsp;центр&nbsp;квадрики.&nbsp;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Возможно,&nbsp;точки&nbsp;лежат&nbsp;на&nbsp;параболоиде&nbsp;или&nbsp;вырожденной&nbsp;поверхности.&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Нормализуем&nbsp;к&nbsp;канонической&nbsp;форме&nbsp;(x-c)ᵀA(x-c)&nbsp;=&nbsp;±1<br>
&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;-(center&nbsp;@&nbsp;A&nbsp;@&nbsp;center&nbsp;+&nbsp;b&nbsp;@&nbsp;center&nbsp;+&nbsp;d)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;numpy.abs(k)&nbsp;&lt;&nbsp;1e-10:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ValueError(&quot;Некорректная&nbsp;нормализация.&nbsp;Проверьте&nbsp;входные&nbsp;данные.&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;=&nbsp;A&nbsp;/&nbsp;k<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;A,&nbsp;center<br>
<br>
<br>
def&nbsp;_build_quadratic_design_matrix(points):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Строит&nbsp;матрицу&nbsp;дизайна&nbsp;для&nbsp;квадратичных&nbsp;членов.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Для&nbsp;каждой&nbsp;точки:&nbsp;[x²,&nbsp;xy,&nbsp;xz,&nbsp;y²,&nbsp;yz,&nbsp;z²,&nbsp;...]&nbsp;(верхний&nbsp;треугольник).<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;points:&nbsp;Массив&nbsp;точек&nbsp;размера&nbsp;(n_points,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Матрица&nbsp;дизайна&nbsp;размера&nbsp;(n_points,&nbsp;n_dim*(n_dim+1)/2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;n_points,&nbsp;n_dim&nbsp;=&nbsp;points.shape<br>
&nbsp;&nbsp;&nbsp;&nbsp;columns&nbsp;=&nbsp;[]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;range(n_dim):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;j&nbsp;in&nbsp;range(i,&nbsp;n_dim):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;i&nbsp;==&nbsp;j:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Диагональные&nbsp;элементы:&nbsp;x²,&nbsp;y²,&nbsp;z²<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;columns.append(points[:,&nbsp;i]&nbsp;**&nbsp;2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Внедиагональные:&nbsp;2*xy,&nbsp;2*xz,&nbsp;2*yz&nbsp;(множитель&nbsp;2&nbsp;для&nbsp;симметрии)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;columns.append(2&nbsp;*&nbsp;points[:,&nbsp;i]&nbsp;*&nbsp;points[:,&nbsp;j])<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;numpy.column_stack(columns)<br>
<br>
<br>
def&nbsp;_build_full_design_matrix(points):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Строит&nbsp;полную&nbsp;матрицу&nbsp;дизайна:&nbsp;квадратичные&nbsp;+&nbsp;линейные&nbsp;+&nbsp;константа.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;points:&nbsp;Массив&nbsp;точек&nbsp;размера&nbsp;(n_points,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Матрица&nbsp;дизайна&nbsp;размера&nbsp;(n_points,&nbsp;n_dim*(n_dim+3)/2&nbsp;+&nbsp;1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;n_points,&nbsp;n_dim&nbsp;=&nbsp;points.shape<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Квадратичные&nbsp;члены<br>
&nbsp;&nbsp;&nbsp;&nbsp;quad_matrix&nbsp;=&nbsp;_build_quadratic_design_matrix(points)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Линейные&nbsp;члены<br>
&nbsp;&nbsp;&nbsp;&nbsp;linear_columns&nbsp;=&nbsp;[points[:,&nbsp;i]&nbsp;for&nbsp;i&nbsp;in&nbsp;range(n_dim)]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Константный&nbsp;член<br>
&nbsp;&nbsp;&nbsp;&nbsp;const_column&nbsp;=&nbsp;[numpy.ones(n_points)]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;numpy.column_stack([quad_matrix]&nbsp;+&nbsp;linear_columns&nbsp;+&nbsp;const_column)<br>
<br>
<br>
def&nbsp;_coeffs_to_matrix(coeffs,&nbsp;n_dim):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Восстанавливает&nbsp;симметричную&nbsp;матрицу&nbsp;из&nbsp;коэффициентов&nbsp;верхнего&nbsp;треугольника.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coeffs:&nbsp;Коэффициенты&nbsp;размера&nbsp;(n_dim*(n_dim+1)/2,)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n_dim:&nbsp;Размерность&nbsp;матрицы<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Симметричная&nbsp;матрица&nbsp;размера&nbsp;(n_dim,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;=&nbsp;numpy.zeros((n_dim,&nbsp;n_dim))<br>
&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;=&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;range(n_dim):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;j&nbsp;in&nbsp;range(i,&nbsp;n_dim):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;i&nbsp;==&nbsp;j:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A[i,&nbsp;j]&nbsp;=&nbsp;coeffs[idx]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A[i,&nbsp;j]&nbsp;=&nbsp;coeffs[idx]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A[j,&nbsp;i]&nbsp;=&nbsp;coeffs[idx]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;+=&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;A<br>
<br>
<br>
def&nbsp;ellipsoid_equation(A,&nbsp;center):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Форматирует&nbsp;уравнение&nbsp;эллипсоида&nbsp;в&nbsp;читаемую&nbsp;строку.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A:&nbsp;Матрица&nbsp;квадратичной&nbsp;формы&nbsp;размера&nbsp;(n_dim,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;center:&nbsp;Центр&nbsp;эллипсоида&nbsp;размера&nbsp;(n_dim,)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Строковое&nbsp;представление&nbsp;уравнения<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;n_dim&nbsp;=&nbsp;len(center)<br>
&nbsp;&nbsp;&nbsp;&nbsp;coord_names&nbsp;=&nbsp;['x',&nbsp;'y',&nbsp;'z',&nbsp;'w']&nbsp;+&nbsp;[f'x_{i}'&nbsp;for&nbsp;i&nbsp;in&nbsp;range(4,&nbsp;n_dim)]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;terms&nbsp;=&nbsp;[]<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;range(n_dim):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ci&nbsp;=&nbsp;center[i]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coord&nbsp;=&nbsp;coord_names[i]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;abs(ci)&nbsp;&gt;&nbsp;1e-10:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;terms.append(f&quot;({coord}&nbsp;-&nbsp;{ci:.3g})&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;terms.append(coord)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;n_dim&nbsp;&lt;=&nbsp;3:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;f&quot;(x-c)ᵀ&nbsp;A&nbsp;(x-c)&nbsp;=&nbsp;1,&nbsp;где&nbsp;c&nbsp;=&nbsp;{center}&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;f&quot;Эллипсоид&nbsp;в&nbsp;R^{n_dim}&nbsp;с&nbsp;центром&nbsp;{center}&quot;<br>
<br>
<br>
def&nbsp;_gamma_half_integer(n):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Вычисляет&nbsp;Γ(n/2&nbsp;+&nbsp;1)&nbsp;для&nbsp;натуральных&nbsp;n.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Специализированная&nbsp;функция&nbsp;для&nbsp;вычисления&nbsp;гамма-функции&nbsp;в&nbsp;точках<br>
&nbsp;&nbsp;&nbsp;&nbsp;вида&nbsp;n/2&nbsp;+&nbsp;1,&nbsp;где&nbsp;n&nbsp;—&nbsp;натуральное&nbsp;число.&nbsp;Используется&nbsp;для&nbsp;формулы<br>
&nbsp;&nbsp;&nbsp;&nbsp;объёма&nbsp;n-мерной&nbsp;сферы/эллипсоида.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n:&nbsp;Натуральное&nbsp;число&nbsp;(размерность&nbsp;пространства)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Значение&nbsp;Γ(n/2&nbsp;+&nbsp;1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Notes:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Для&nbsp;чётных&nbsp;n:&nbsp;Γ(n/2&nbsp;+&nbsp;1)&nbsp;=&nbsp;(n/2)!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Для&nbsp;нечётных&nbsp;n:&nbsp;Γ(n/2&nbsp;+&nbsp;1)&nbsp;=&nbsp;Γ(0.5)&nbsp;*&nbsp;∏(k&nbsp;+&nbsp;0.5)&nbsp;для&nbsp;k=0..m,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;где&nbsp;m&nbsp;=&nbsp;(n-1)/2&nbsp;и&nbsp;Γ(0.5)&nbsp;=&nbsp;√π<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Примеры:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;n=2:&nbsp;Γ(2)&nbsp;=&nbsp;1!&nbsp;=&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;n=3:&nbsp;Γ(2.5)&nbsp;=&nbsp;1.5&nbsp;×&nbsp;0.5&nbsp;×&nbsp;√π&nbsp;≈&nbsp;1.329<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;n=4:&nbsp;Γ(3)&nbsp;=&nbsp;2!&nbsp;=&nbsp;2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;n&nbsp;%&nbsp;2&nbsp;==&nbsp;0:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;n&nbsp;чётное:&nbsp;Γ(k+1)&nbsp;=&nbsp;k!&nbsp;для&nbsp;k&nbsp;=&nbsp;n/2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;n&nbsp;//&nbsp;2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;float(math.factorial(k))<br>
&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;n&nbsp;нечётное:&nbsp;n&nbsp;=&nbsp;2m&nbsp;+&nbsp;1,&nbsp;n/2&nbsp;+&nbsp;1&nbsp;=&nbsp;m&nbsp;+&nbsp;1.5<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Γ(m&nbsp;+&nbsp;1.5)&nbsp;=&nbsp;Γ(0.5)&nbsp;*&nbsp;∏(k&nbsp;+&nbsp;0.5)&nbsp;для&nbsp;k&nbsp;=&nbsp;0..m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;где&nbsp;Γ(0.5)&nbsp;=&nbsp;sqrt(π)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;=&nbsp;(n&nbsp;-&nbsp;1)&nbsp;//&nbsp;2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gamma_val&nbsp;=&nbsp;numpy.sqrt(numpy.pi)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;k&nbsp;in&nbsp;range(m&nbsp;+&nbsp;1):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gamma_val&nbsp;*=&nbsp;(k&nbsp;+&nbsp;0.5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;gamma_val<br>
<br>
<br>
def&nbsp;ellipsoid_volume(radii):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Вычисляет&nbsp;объём&nbsp;эллипсоида&nbsp;по&nbsp;полуосям.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;radii:&nbsp;Полуоси&nbsp;эллипсоида&nbsp;размера&nbsp;(n_dim,)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Объём&nbsp;эллипсоида<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Notes:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;=&nbsp;(π^(n/2)&nbsp;/&nbsp;Γ(n/2&nbsp;+&nbsp;1))&nbsp;*&nbsp;∏rᵢ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Для&nbsp;малых&nbsp;размерностей:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;1D:&nbsp;2r&nbsp;(длина&nbsp;отрезка)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;2D:&nbsp;πab&nbsp;(площадь&nbsp;эллипса)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;3D:&nbsp;(4/3)πabc&nbsp;(объём&nbsp;эллипсоида)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;radii&nbsp;=&nbsp;numpy.asarray(radii)<br>
&nbsp;&nbsp;&nbsp;&nbsp;n_dim&nbsp;=&nbsp;len(radii)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Вычисляем&nbsp;Γ(n/2&nbsp;+&nbsp;1)&nbsp;для&nbsp;размерности&nbsp;n<br>
&nbsp;&nbsp;&nbsp;&nbsp;gamma_val&nbsp;=&nbsp;_gamma_half_integer(n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;V&nbsp;=&nbsp;(π^(n/2)&nbsp;/&nbsp;Γ(n/2&nbsp;+&nbsp;1))&nbsp;*&nbsp;∏rᵢ<br>
&nbsp;&nbsp;&nbsp;&nbsp;half_n&nbsp;=&nbsp;n_dim&nbsp;/&nbsp;2.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;volume&nbsp;=&nbsp;(numpy.pi&nbsp;**&nbsp;half_n&nbsp;/&nbsp;gamma_val)&nbsp;*&nbsp;numpy.prod(radii)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;volume<br>
<br>
<br>
def&nbsp;evaluate_ellipsoid(points,&nbsp;A,&nbsp;center):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Вычисляет&nbsp;значения&nbsp;квадратичной&nbsp;формы&nbsp;эллипсоида&nbsp;в&nbsp;точках.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Для&nbsp;эллипсоида&nbsp;(x-c)ᵀA(x-c)&nbsp;=&nbsp;1&nbsp;вычисляет&nbsp;(x-c)ᵀA(x-c)&nbsp;для&nbsp;каждой&nbsp;точки.<br>
&nbsp;&nbsp;&nbsp;&nbsp;Значения:<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&lt;&nbsp;1:&nbsp;точка&nbsp;внутри&nbsp;эллипсоида<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;=&nbsp;1:&nbsp;точка&nbsp;на&nbsp;поверхности<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&gt;&nbsp;1:&nbsp;точка&nbsp;снаружи<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;points:&nbsp;Массив&nbsp;точек&nbsp;размера&nbsp;(n_points,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A:&nbsp;Матрица&nbsp;квадратичной&nbsp;формы&nbsp;размера&nbsp;(n_dim,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;center:&nbsp;Центр&nbsp;эллипсоида&nbsp;размера&nbsp;(n_dim,)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Массив&nbsp;значений&nbsp;размера&nbsp;(n_points,)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;points&nbsp;=&nbsp;numpy.asarray(points,&nbsp;dtype=float)<br>
&nbsp;&nbsp;&nbsp;&nbsp;center&nbsp;=&nbsp;numpy.asarray(center,&nbsp;dtype=float)<br>
&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;=&nbsp;numpy.asarray(A,&nbsp;dtype=float)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Центрируем&nbsp;точки<br>
&nbsp;&nbsp;&nbsp;&nbsp;points_centered&nbsp;=&nbsp;points&nbsp;-&nbsp;center<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Вычисляем&nbsp;квадратичную&nbsp;форму:&nbsp;(x-c)ᵀA(x-c)<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Эффективно:&nbsp;sum((A&nbsp;@&nbsp;p)&nbsp;*&nbsp;p)&nbsp;для&nbsp;каждой&nbsp;точки<br>
&nbsp;&nbsp;&nbsp;&nbsp;values&nbsp;=&nbsp;numpy.sum((points_centered&nbsp;@&nbsp;A)&nbsp;*&nbsp;points_centered,&nbsp;axis=1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;values<br>
<br>
<br>
def&nbsp;ellipsoid_contains(points,&nbsp;A,&nbsp;center,&nbsp;tol=1e-10):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Проверяет,&nbsp;лежат&nbsp;ли&nbsp;точки&nbsp;внутри&nbsp;или&nbsp;на&nbsp;эллипсоиде.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;points:&nbsp;Массив&nbsp;точек&nbsp;размера&nbsp;(n_points,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A:&nbsp;Матрица&nbsp;квадратичной&nbsp;формы&nbsp;размера&nbsp;(n_dim,&nbsp;n_dim)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;center:&nbsp;Центр&nbsp;эллипсоида&nbsp;размера&nbsp;(n_dim,)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tol:&nbsp;Допуск&nbsp;для&nbsp;точек&nbsp;на&nbsp;границе<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Булев&nbsp;массив&nbsp;размера&nbsp;(n_points,):&nbsp;True&nbsp;если&nbsp;точка&nbsp;внутри/на&nbsp;эллипсоиде<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;values&nbsp;=&nbsp;evaluate_ellipsoid(points,&nbsp;A,&nbsp;center)<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;values&nbsp;&lt;=&nbsp;(1.0&nbsp;+&nbsp;tol)<br>
<br>
<!-- END SCAT CODE -->
</body>
</html>
