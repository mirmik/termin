<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/physics/run_physics_demo.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
&quot;&quot;&quot;Physics&nbsp;demo:&nbsp;drop&nbsp;cubes&nbsp;in&nbsp;the&nbsp;editor.&quot;&quot;&quot;<br>
<br>
import&nbsp;sys<br>
import&nbsp;numpy&nbsp;as&nbsp;np<br>
from&nbsp;PyQt6.QtGui&nbsp;import&nbsp;QPalette,&nbsp;QColor<br>
from&nbsp;PyQt6.QtWidgets&nbsp;import&nbsp;QApplication<br>
from&nbsp;PyQt6&nbsp;import&nbsp;QtCore<br>
<br>
from&nbsp;termin.geombase&nbsp;import&nbsp;Pose3<br>
from&nbsp;termin.geombase&nbsp;import&nbsp;GeneralPose3<br>
from&nbsp;termin.mesh.mesh&nbsp;import&nbsp;CubeMesh<br>
from&nbsp;termin.visualization.core.camera&nbsp;import&nbsp;PerspectiveCameraComponent,&nbsp;OrbitCameraController<br>
from&nbsp;termin.visualization.core.entity&nbsp;import&nbsp;Entity<br>
from&nbsp;termin.visualization.core.material&nbsp;import&nbsp;Material<br>
from&nbsp;termin.voxels.voxel_mesh&nbsp;import&nbsp;create_voxel_mesh<br>
from&nbsp;termin.visualization.core.scene&nbsp;import&nbsp;Scene<br>
from&nbsp;termin.visualization.core.world&nbsp;import&nbsp;VisualizationWorld<br>
from&nbsp;termin.visualization.platform.backends&nbsp;import&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;OpenGLGraphicsBackend,<br>
&nbsp;&nbsp;&nbsp;&nbsp;QtWindowBackend,<br>
&nbsp;&nbsp;&nbsp;&nbsp;set_default_graphics_backend,<br>
&nbsp;&nbsp;&nbsp;&nbsp;set_default_window_backend,<br>
)<br>
from&nbsp;termin.visualization.render.components&nbsp;import&nbsp;MeshRenderer<br>
from&nbsp;termin.visualization.render.components.light_component&nbsp;import&nbsp;LightComponent<br>
from&nbsp;termin.lighting&nbsp;import&nbsp;LightType,&nbsp;LightShadowParams<br>
<br>
from&nbsp;termin.physics&nbsp;import&nbsp;RigidBodyComponent,&nbsp;PhysicsWorldComponent<br>
<br>
<br>
def&nbsp;build_physics_scene(world):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Build&nbsp;a&nbsp;scene&nbsp;with&nbsp;physics&nbsp;objects.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene&nbsp;=&nbsp;Scene(name=&quot;physics_demo&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Materials<br>
&nbsp;&nbsp;&nbsp;&nbsp;red_material&nbsp;=&nbsp;Material(color=np.array([0.8,&nbsp;0.3,&nbsp;0.3,&nbsp;1.0],&nbsp;dtype=np.float32))<br>
&nbsp;&nbsp;&nbsp;&nbsp;blue_material&nbsp;=&nbsp;Material(color=np.array([0.3,&nbsp;0.3,&nbsp;0.8,&nbsp;1.0],&nbsp;dtype=np.float32))<br>
&nbsp;&nbsp;&nbsp;&nbsp;green_material&nbsp;=&nbsp;Material(color=np.array([0.3,&nbsp;0.8,&nbsp;0.3,&nbsp;1.0],&nbsp;dtype=np.float32))<br>
&nbsp;&nbsp;&nbsp;&nbsp;yellow_material&nbsp;=&nbsp;Material(color=np.array([0.8,&nbsp;0.8,&nbsp;0.3,&nbsp;1.0],&nbsp;dtype=np.float32))<br>
&nbsp;&nbsp;&nbsp;&nbsp;gray_material&nbsp;=&nbsp;Material(color=np.array([0.5,&nbsp;0.5,&nbsp;0.5,&nbsp;1.0],&nbsp;dtype=np.float32))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Meshes<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube_mesh&nbsp;=&nbsp;CubeMesh()<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube_tc&nbsp;=&nbsp;create_voxel_mesh(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertices=cube_mesh.vertices,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;triangles=cube_mesh.triangles,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertex_normals=cube_mesh.vertex_normals,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;cube&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Ground&nbsp;plane&nbsp;(visual&nbsp;only&nbsp;-&nbsp;physics&nbsp;uses&nbsp;world.ground_height)<br>
&nbsp;&nbsp;&nbsp;&nbsp;ground&nbsp;=&nbsp;Entity(pose=Pose3.identity(),&nbsp;name=&quot;ground&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;ground.add_component(MeshRenderer(cube_tc,&nbsp;gray_material))<br>
&nbsp;&nbsp;&nbsp;&nbsp;ground.transform.relocate(GeneralPose3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=np.array([0,&nbsp;0,&nbsp;-0.05]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scale=np.array([10.0,&nbsp;10.0,&nbsp;0.1])<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene.add(ground)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Falling&nbsp;cube&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube1&nbsp;=&nbsp;Entity(pose=Pose3.identity(),&nbsp;name=&quot;cube1&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube1.add_component(MeshRenderer(cube_tc,&nbsp;red_material))<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube1.transform.relocate(Pose3.identity().with_translation(np.array([0.0,&nbsp;0.0,&nbsp;3.0])))<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube1.add_component(RigidBodyComponent(mass=1.0,&nbsp;is_static=False))<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene.add(cube1)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Falling&nbsp;cube&nbsp;2&nbsp;(offset&nbsp;and&nbsp;tilted)<br>
&nbsp;&nbsp;&nbsp;&nbsp;import&nbsp;math<br>
&nbsp;&nbsp;&nbsp;&nbsp;angle&nbsp;=&nbsp;math.radians(30)<br>
&nbsp;&nbsp;&nbsp;&nbsp;quat&nbsp;=&nbsp;np.array([math.sin(angle/2),&nbsp;0,&nbsp;0,&nbsp;math.cos(angle/2)])<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube2&nbsp;=&nbsp;Entity(pose=Pose3.identity(),&nbsp;name=&quot;cube2&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube2.add_component(MeshRenderer(cube_tc,&nbsp;blue_material))<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube2.transform.relocate(Pose3(ang=quat,&nbsp;lin=np.array([2.0,&nbsp;0.0,&nbsp;4.0])))<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube2.add_component(RigidBodyComponent(mass=1.0,&nbsp;is_static=False))<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene.add(cube2)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Falling&nbsp;cube&nbsp;3&nbsp;(higher)<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube3&nbsp;=&nbsp;Entity(pose=Pose3.identity(),&nbsp;name=&quot;cube3&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube3.add_component(MeshRenderer(cube_tc,&nbsp;green_material))<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube3.transform.relocate(Pose3.identity().with_translation(np.array([-2.0,&nbsp;0.0,&nbsp;5.0])))<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube3.add_component(RigidBodyComponent(mass=1.0,&nbsp;is_static=False))<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene.add(cube3)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Falling&nbsp;cube&nbsp;4&nbsp;(will&nbsp;land&nbsp;on&nbsp;cube1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube4&nbsp;=&nbsp;Entity(pose=Pose3.identity(),&nbsp;name=&quot;cube4&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube4.add_component(MeshRenderer(cube_tc,&nbsp;yellow_material))<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube4.transform.relocate(Pose3.identity().with_translation(np.array([0.0,&nbsp;0.0,&nbsp;6.0])))<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube4.add_component(RigidBodyComponent(mass=1.0,&nbsp;is_static=False))<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene.add(cube4)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Physics&nbsp;world&nbsp;manager<br>
&nbsp;&nbsp;&nbsp;&nbsp;physics_entity&nbsp;=&nbsp;Entity(pose=Pose3.identity(),&nbsp;name=&quot;physics_world&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;physics_entity.add_component(PhysicsWorldComponent(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gravity=np.array([0,&nbsp;0,&nbsp;-9.81]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iterations=10,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;restitution=0.3,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;friction=0.5,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ground_height=0.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ground_enabled=True,<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene.add(physics_entity)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Light<br>
&nbsp;&nbsp;&nbsp;&nbsp;light_entity&nbsp;=&nbsp;Entity(pose=Pose3.identity(),&nbsp;name=&quot;directional_light&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;light_component&nbsp;=&nbsp;LightComponent(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;light_type=LightType.DIRECTIONAL,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color=(1.0,&nbsp;1.0,&nbsp;1.0),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intensity=1.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shadows=LightShadowParams(enabled=True,&nbsp;map_resolution=2048),<br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;light_entity.add_component(light_component)<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene.add(light_entity)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;world.add_scene(scene)<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;scene<br>
<br>
<br>
def&nbsp;apply_dark_palette(app:&nbsp;QApplication):<br>
&nbsp;&nbsp;&nbsp;&nbsp;app.setStyle(&quot;Fusion&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette&nbsp;=&nbsp;QPalette()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;bg&nbsp;=&nbsp;QColor(30,&nbsp;30,&nbsp;30)<br>
&nbsp;&nbsp;&nbsp;&nbsp;window&nbsp;=&nbsp;QColor(37,&nbsp;37,&nbsp;38)<br>
&nbsp;&nbsp;&nbsp;&nbsp;base&nbsp;=&nbsp;QColor(45,&nbsp;45,&nbsp;48)<br>
&nbsp;&nbsp;&nbsp;&nbsp;text&nbsp;=&nbsp;QColor(220,&nbsp;220,&nbsp;220)<br>
&nbsp;&nbsp;&nbsp;&nbsp;disabled_text&nbsp;=&nbsp;QColor(128,&nbsp;128,&nbsp;128)<br>
&nbsp;&nbsp;&nbsp;&nbsp;highlight&nbsp;=&nbsp;QColor(0,&nbsp;120,&nbsp;215)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette.setColor(QPalette.ColorRole.Window,&nbsp;window)<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette.setColor(QPalette.ColorRole.WindowText,&nbsp;text)<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette.setColor(QPalette.ColorRole.Base,&nbsp;base)<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette.setColor(QPalette.ColorRole.AlternateBase,&nbsp;bg)<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette.setColor(QPalette.ColorRole.ToolTipBase,&nbsp;base)<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette.setColor(QPalette.ColorRole.ToolTipText,&nbsp;text)<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette.setColor(QPalette.ColorRole.Text,&nbsp;text)<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette.setColor(QPalette.ColorRole.Button,&nbsp;window)<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette.setColor(QPalette.ColorRole.ButtonText,&nbsp;text)<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette.setColor(QPalette.ColorRole.BrightText,&nbsp;QColor(255,&nbsp;0,&nbsp;0))<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette.setColor(QPalette.ColorRole.Highlight,&nbsp;highlight)<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette.setColor(QPalette.ColorRole.HighlightedText,&nbsp;QColor(255,&nbsp;255,&nbsp;255))<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette.setColor(QPalette.ColorGroup.Disabled,&nbsp;QPalette.ColorRole.Text,&nbsp;disabled_text)<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette.setColor(QPalette.ColorGroup.Disabled,&nbsp;QPalette.ColorRole.ButtonText,&nbsp;disabled_text)<br>
&nbsp;&nbsp;&nbsp;&nbsp;palette.setColor(QPalette.ColorGroup.Disabled,&nbsp;QPalette.ColorRole.WindowText,&nbsp;disabled_text)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;app.setPalette(palette)<br>
<br>
<br>
def&nbsp;run_physics_demo():<br>
&nbsp;&nbsp;&nbsp;&nbsp;QApplication.setAttribute(QtCore.Qt.ApplicationAttribute.AA_ShareOpenGLContexts,&nbsp;True)<br>
&nbsp;&nbsp;&nbsp;&nbsp;app&nbsp;=&nbsp;QApplication(sys.argv)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;set_default_graphics_backend(OpenGLGraphicsBackend())<br>
&nbsp;&nbsp;&nbsp;&nbsp;set_default_window_backend(QtWindowBackend())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;world&nbsp;=&nbsp;VisualizationWorld()<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene&nbsp;=&nbsp;build_physics_scene(world)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;apply_dark_palette(app)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.editor.editor_window&nbsp;import&nbsp;EditorWindow<br>
&nbsp;&nbsp;&nbsp;&nbsp;win&nbsp;=&nbsp;EditorWindow(world,&nbsp;scene)<br>
&nbsp;&nbsp;&nbsp;&nbsp;win.show()<br>
&nbsp;&nbsp;&nbsp;&nbsp;app.exec()<br>
<br>
<br>
if&nbsp;__name__&nbsp;==&nbsp;&quot;__main__&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;run_physics_demo()<br>
<!-- END SCAT CODE -->
</body>
</html>
