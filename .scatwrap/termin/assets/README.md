<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/assets/README.md</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#&nbsp;Assets&nbsp;Architecture<br>
<br>
##&nbsp;Правило:&nbsp;Asset&nbsp;классы&nbsp;НЕ&nbsp;должны&nbsp;появляться&nbsp;в&nbsp;коде&nbsp;компонентов<br>
<br>
Asset&nbsp;классы&nbsp;занимаются&nbsp;только&nbsp;**элевацией**&nbsp;—&nbsp;загрузкой&nbsp;данных&nbsp;с&nbsp;диска&nbsp;и&nbsp;передачей&nbsp;их&nbsp;потребителям.<br>
<br>
###&nbsp;Архитектура<br>
<br>
```<br>
Диск&nbsp;(.png,&nbsp;.obj,&nbsp;.wav)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;↓<br>
&nbsp;&nbsp;&nbsp;&nbsp;Asset&nbsp;(загрузка,&nbsp;кэширование,&nbsp;hot-reload)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;↓<br>
&nbsp;&nbsp;&nbsp;&nbsp;Data&nbsp;(AudioClip,&nbsp;Mesh3,&nbsp;TcTexture)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;↓<br>
&nbsp;&nbsp;&nbsp;&nbsp;Handle&nbsp;(smart&nbsp;reference)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;↓<br>
&nbsp;&nbsp;&nbsp;&nbsp;Component&nbsp;(работает&nbsp;только&nbsp;с&nbsp;Data&nbsp;через&nbsp;Handle)<br>
```<br>
<br>
###&nbsp;Что&nbsp;делает&nbsp;Asset<br>
<br>
-&nbsp;Загружает&nbsp;файл&nbsp;с&nbsp;диска&nbsp;(lazy&nbsp;loading)<br>
-&nbsp;Кэширует&nbsp;данные<br>
-&nbsp;Поддерживает&nbsp;hot-reload<br>
-&nbsp;Хранит&nbsp;метаданные&nbsp;(uuid,&nbsp;source_path,&nbsp;version)<br>
-&nbsp;Создаёт&nbsp;и&nbsp;владеет&nbsp;объектом&nbsp;Data<br>
<br>
###&nbsp;Что&nbsp;делает&nbsp;Handle<br>
<br>
-&nbsp;Предоставляет&nbsp;доступ&nbsp;к&nbsp;Data&nbsp;(не&nbsp;к&nbsp;Asset!)<br>
-&nbsp;Сериализуется&nbsp;по&nbsp;uuid<br>
-&nbsp;Автоматически&nbsp;резолвится&nbsp;через&nbsp;ResourceManager<br>
<br>
###&nbsp;Что&nbsp;делает&nbsp;Component<br>
<br>
-&nbsp;Хранит&nbsp;Handle,&nbsp;не&nbsp;Asset<br>
-&nbsp;Получает&nbsp;Data&nbsp;через&nbsp;`handle.get()`<br>
-&nbsp;НЕ&nbsp;знает&nbsp;откуда&nbsp;пришли&nbsp;данные&nbsp;(файл,&nbsp;память,&nbsp;сеть)<br>
<br>
###&nbsp;Пример&nbsp;правильного&nbsp;кода<br>
<br>
```python<br>
#&nbsp;Компонент&nbsp;хранит&nbsp;Handle<br>
class&nbsp;AudioSource(Component):<br>
&nbsp;&nbsp;&nbsp;&nbsp;clip:&nbsp;AudioClipHandle&nbsp;&nbsp;#&nbsp;Handle,&nbsp;не&nbsp;Asset!<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;play(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;audio_clip&nbsp;=&nbsp;self.clip.get()&nbsp;&nbsp;#&nbsp;Получаем&nbsp;AudioClip&nbsp;(Data)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;audio_clip&nbsp;is&nbsp;not&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;engine.play(audio_clip.chunk)<br>
```<br>
<br>
###&nbsp;Пример&nbsp;неправильного&nbsp;кода<br>
<br>
```python<br>
#&nbsp;НЕПРАВИЛЬНО:&nbsp;компонент&nbsp;работает&nbsp;с&nbsp;Asset<br>
class&nbsp;AudioSource(Component):<br>
&nbsp;&nbsp;&nbsp;&nbsp;clip_asset:&nbsp;AudioClipAsset&nbsp;&nbsp;#&nbsp;Asset&nbsp;в&nbsp;компоненте&nbsp;—&nbsp;нарушение!<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;play(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.clip_asset.ensure_loaded()&nbsp;&nbsp;#&nbsp;Компонент&nbsp;знает&nbsp;о&nbsp;загрузке&nbsp;—&nbsp;плохо<br>
```<br>
<br>
###&nbsp;Почему&nbsp;это&nbsp;важно<br>
<br>
1.&nbsp;**Разделение&nbsp;ответственности**&nbsp;—&nbsp;Asset&nbsp;про&nbsp;загрузку,&nbsp;Component&nbsp;про&nbsp;логику<br>
2.&nbsp;**Тестируемость**&nbsp;—&nbsp;можно&nbsp;подменить&nbsp;данные&nbsp;без&nbsp;файловой&nbsp;системы<br>
3.&nbsp;**Сериализация**&nbsp;—&nbsp;Handle&nbsp;сериализуется&nbsp;в&nbsp;uuid,&nbsp;Asset&nbsp;нет<br>
4.&nbsp;**Hot-reload**&nbsp;—&nbsp;Asset&nbsp;может&nbsp;перезагрузиться,&nbsp;компонент&nbsp;не&nbsp;заметит<br>
<!-- END SCAT CODE -->
</body>
</html>
