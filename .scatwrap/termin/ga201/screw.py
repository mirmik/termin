<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/ga201/screw.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#!/usr/bin/env&nbsp;python3<br>
<br>
import&nbsp;math<br>
import&nbsp;numpy<br>
<br>
<br>
class&nbsp;Screw2:<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;m=0,&nbsp;v=numpy.array([0,&nbsp;0])):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._m&nbsp;=&nbsp;m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._v&nbsp;=&nbsp;numpy.array(v)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;isinstance(self._v,&nbsp;numpy.ndarray)&nbsp;and&nbsp;self._v.shape&nbsp;!=&nbsp;(2,):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;Exception(&quot;Vector&nbsp;must&nbsp;be&nbsp;numpy.ndarray&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;isinstance(self._m,&nbsp;(int,&nbsp;float)):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;Exception(&quot;Moment&nbsp;must&nbsp;be&nbsp;int&nbsp;or&nbsp;float&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;lin(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self._v<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;ang(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self._m<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;vector(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self._v<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;moment(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self._m<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;norm(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;math.sqrt(self._m&nbsp;*&nbsp;self._m&nbsp;+&nbsp;self._v.dot(self._v))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;set_vector(self,&nbsp;v):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._v&nbsp;=&nbsp;v<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;set_moment(self,&nbsp;m):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._m&nbsp;=&nbsp;m<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;as_array(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;numpy.array([self._m,&nbsp;*self._v])<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;kinematic_carry(self,&nbsp;motor):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;=&nbsp;motor.mul_screw(self)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;=&nbsp;a&nbsp;*&nbsp;motor.reverse()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;a.splash_to_screw()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;carry(self,&nbsp;motor):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&nbsp;carry(S,P)&nbsp;=&nbsp;PSP*&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.kinematic_carry(motor)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;inverse_kinematic_carry&nbsp;(self,&nbsp;motor):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;=&nbsp;motor.reverse().mul_screw(self)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;=&nbsp;a&nbsp;*&nbsp;motor<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;a.splash_to_screw()<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;inverse_carry(self,&nbsp;motor):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&nbsp;inverse_carry(S,P)&nbsp;=&nbsp;P*SP&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.inverse_kinematic_carry(motor)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;fulldot(self,&nbsp;other):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self._m&nbsp;*&nbsp;other._m&nbsp;+&nbsp;self._v.dot(other._v)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;force_carry(self,&nbsp;motor):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;angle&nbsp;=&nbsp;motor.factorize_rotation_angle()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;translation&nbsp;=&nbsp;motor.factorize_translation_vector()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotated_scr&nbsp;=&nbsp;self.rotate_by_angle(angle)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;=&nbsp;rotated_scr.moment()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;=&nbsp;rotated_scr.vector()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;translation<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;=&nbsp;-m<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;TODO:&nbsp;force&nbsp;carry&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_m&nbsp;=&nbsp;m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_v&nbsp;=&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;Screw2(m=new_m,&nbsp;v=new_v)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ret<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;inverted_kinematic_carry(self,&nbsp;motor):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.inverse_kinematic_carry(motor)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;kinematic_carry_vec(self,&nbsp;translation):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;=&nbsp;self._m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;=&nbsp;self._v<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;translation<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;=&nbsp;-m&nbsp;&nbsp;#&nbsp;(w+v)'=w+v-w*t&nbsp;:&nbsp;из&nbsp;уравнения&nbsp;(v+w)'=(1+t/2)(v+w)(1-t/2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;Screw2(m=m,&nbsp;v=v&nbsp;+&nbsp;numpy.array([<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-a&nbsp;*&nbsp;b[1],&nbsp;a&nbsp;*&nbsp;b[0]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ret<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;rotate_by_angle(self,&nbsp;angle):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;=&nbsp;self._m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;=&nbsp;self._v<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;math.sin(angle)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;math.cos(angle)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(m=m,&nbsp;v=numpy.array([<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c*v[0]&nbsp;-&nbsp;s*v[1],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s*v[0]&nbsp;+&nbsp;c*v[1]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;rotate_by(self,&nbsp;motor):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.rotate_by_angle(motor.angle())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;inverse_rotate_by(self,&nbsp;motor):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.rotate_by_angle(-motor.angle())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__str__(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;Screw2(%s,&nbsp;%s)&quot;&nbsp;%&nbsp;(self._m,&nbsp;self._v)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__mul__(self,&nbsp;s):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(v=self._v*s,&nbsp;m=self._m*s)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__truediv__(self,&nbsp;s):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(v=self._v/s,&nbsp;m=self._m/s)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__add__(self,&nbsp;oth):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(v=self._v+oth._v,&nbsp;m=self._m+oth._m)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__neg__(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(v=-self._v,&nbsp;m=-self._m)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__sub__(self,&nbsp;oth):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(v=self._v-oth._v,&nbsp;m=self._m-oth._m)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;toarray(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;numpy.array([self.moment(),&nbsp;*self.vector()])<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;@staticmethod<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;from_array(arr):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(m=arr[0],&nbsp;v=arr[1:])<br>
<br>
<br>
if&nbsp;__name__&nbsp;==&nbsp;&quot;__main__&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.ga201.motor&nbsp;import&nbsp;Motor2<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;scr&nbsp;=&nbsp;Screw2(m=0,&nbsp;v=[1,&nbsp;0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;mot&nbsp;=&nbsp;Motor2.rotation(math.pi/2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;print(scr.kinematic_carry(mot))<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;print(scr.inverted_kinematic_carry(mot))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;scr&nbsp;=&nbsp;Screw2(m=1,&nbsp;v=[0,&nbsp;0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;mot&nbsp;=&nbsp;Motor2.translation(1,&nbsp;0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;print(scr.kinematic_carry(mot))<br>
&nbsp;&nbsp;&nbsp;&nbsp;print(scr.inverted_kinematic_carry(mot))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;scr&nbsp;=&nbsp;Screw2(m=0,&nbsp;v=[1,&nbsp;0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;print(scr.rotate_by_angle(math.pi/2))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;scr&nbsp;=&nbsp;Screw2(m=1,&nbsp;v=[0,&nbsp;0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;print(scr.rotate_by_angle(math.pi/2))<br>
<!-- END SCAT CODE -->
</body>
</html>
