<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/navmesh/types.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
&quot;&quot;&quot;<br>
Базовые&nbsp;структуры&nbsp;данных&nbsp;для&nbsp;NavMesh.<br>
&quot;&quot;&quot;<br>
<br>
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
<br>
from&nbsp;dataclasses&nbsp;import&nbsp;dataclass,&nbsp;field<br>
from&nbsp;typing&nbsp;import&nbsp;Optional<br>
import&nbsp;numpy&nbsp;as&nbsp;np<br>
<br>
<br>
@dataclass<br>
class&nbsp;NavMeshConfig:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Конфигурация&nbsp;для&nbsp;построения&nbsp;NavMesh.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;max_slope_cos:&nbsp;float&nbsp;=&nbsp;0.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Косинус&nbsp;максимального&nbsp;угла&nbsp;наклона&nbsp;поверхности.&nbsp;0&nbsp;=&nbsp;без&nbsp;фильтрации.<br>
&nbsp;&nbsp;&nbsp;&nbsp;cos(45°)&nbsp;≈&nbsp;0.707,&nbsp;cos(60°)&nbsp;=&nbsp;0.5,&nbsp;cos(30°)&nbsp;≈&nbsp;0.866.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;agent_radius:&nbsp;float&nbsp;=&nbsp;0.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Радиус&nbsp;агента&nbsp;в&nbsp;мировых&nbsp;координатах.&nbsp;0&nbsp;=&nbsp;без&nbsp;эрозии.<br>
&nbsp;&nbsp;&nbsp;&nbsp;Воксели&nbsp;с&nbsp;distance&nbsp;&lt;&nbsp;agent_radius&nbsp;/&nbsp;cell_size&nbsp;отфильтровываются.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;normal_threshold:&nbsp;float&nbsp;=&nbsp;0.9<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Порог&nbsp;схожести&nbsp;нормалей&nbsp;(косинус&nbsp;угла).&nbsp;0.9&nbsp;≈&nbsp;25°,&nbsp;0.866&nbsp;≈&nbsp;30°.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;min_region_voxels:&nbsp;int&nbsp;=&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Минимальное&nbsp;количество&nbsp;вокселей&nbsp;в&nbsp;регионе.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;contour_epsilon:&nbsp;float&nbsp;=&nbsp;0.1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Порог&nbsp;для&nbsp;Douglas-Peucker&nbsp;упрощения&nbsp;контуров&nbsp;(в&nbsp;мировых&nbsp;координатах).&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;max_edge_length:&nbsp;float&nbsp;=&nbsp;0.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Макс.&nbsp;длина&nbsp;ребра&nbsp;треугольника.&nbsp;0&nbsp;=&nbsp;без&nbsp;ограничения.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;min_edge_length:&nbsp;float&nbsp;=&nbsp;0.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Мин.&nbsp;длина&nbsp;внутреннего&nbsp;ребра&nbsp;(edge&nbsp;collapse).&nbsp;0&nbsp;=&nbsp;без&nbsp;схлопывания.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;min_contour_edge_length:&nbsp;float&nbsp;=&nbsp;0.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Мин.&nbsp;длина&nbsp;ребра&nbsp;на&nbsp;контуре&nbsp;(edge&nbsp;collapse).&nbsp;0&nbsp;=&nbsp;без&nbsp;схлопывания.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;max_vertex_valence:&nbsp;int&nbsp;=&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Макс.&nbsp;количество&nbsp;треугольников&nbsp;на&nbsp;вершину.&nbsp;0&nbsp;=&nbsp;без&nbsp;ограничения.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;use_delaunay_flip:&nbsp;bool&nbsp;=&nbsp;True<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Применять&nbsp;Delaunay&nbsp;edge&nbsp;flipping&nbsp;для&nbsp;улучшения&nbsp;качества&nbsp;треугольников.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;use_valence_flip:&nbsp;bool&nbsp;=&nbsp;False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Применять&nbsp;edge&nbsp;flipping&nbsp;для&nbsp;уменьшения&nbsp;валентности&nbsp;вершин.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;use_angle_flip:&nbsp;bool&nbsp;=&nbsp;False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Применять&nbsp;edge&nbsp;flipping&nbsp;для&nbsp;максимизации&nbsp;минимального&nbsp;угла.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;use_cvt_smoothing:&nbsp;bool&nbsp;=&nbsp;False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Применять&nbsp;CVT&nbsp;(Centroidal&nbsp;Voronoi&nbsp;Tessellation)&nbsp;для&nbsp;оптимизации&nbsp;позиций&nbsp;вершин.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;use_edge_collapse:&nbsp;bool&nbsp;=&nbsp;False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Применять&nbsp;edge&nbsp;collapse&nbsp;для&nbsp;схлопывания&nbsp;коротких&nbsp;рёбер.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;use_second_pass:&nbsp;bool&nbsp;=&nbsp;False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Повторный&nbsp;проход&nbsp;flips&nbsp;+&nbsp;smoothing&nbsp;после&nbsp;edge&nbsp;collapse.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;use_watershed:&nbsp;bool&nbsp;=&nbsp;False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Разбивать&nbsp;большие&nbsp;регионы&nbsp;с&nbsp;помощью&nbsp;watershed.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;watershed_smoothing:&nbsp;int&nbsp;=&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Количество&nbsp;итераций&nbsp;сглаживания&nbsp;distance&nbsp;field&nbsp;для&nbsp;watershed.&quot;&quot;&quot;<br>
<br>
<br>
@dataclass<br>
class&nbsp;Portal:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Портал&nbsp;между&nbsp;двумя&nbsp;регионами&nbsp;NavMesh.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Представляет&nbsp;собой&nbsp;границу&nbsp;между&nbsp;соседними&nbsp;полигонами.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;region_a:&nbsp;int<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Индекс&nbsp;первого&nbsp;региона.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;region_b:&nbsp;int<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Индекс&nbsp;второго&nbsp;региона.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;voxels:&nbsp;list[tuple[int,&nbsp;int,&nbsp;int]]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Воксели,&nbsp;образующие&nbsp;портал.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;center:&nbsp;np.ndarray<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Центр&nbsp;портала&nbsp;в&nbsp;мировых&nbsp;координатах,&nbsp;shape&nbsp;(3,).&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;float<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Ширина&nbsp;портала&nbsp;(расстояние&nbsp;между&nbsp;крайними&nbsp;вокселями).&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;left:&nbsp;np.ndarray&nbsp;=&nbsp;field(default_factory=lambda:&nbsp;np.zeros(3,&nbsp;dtype=np.float32))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Левый&nbsp;конец&nbsp;портала&nbsp;в&nbsp;мировых&nbsp;координатах.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;right:&nbsp;np.ndarray&nbsp;=&nbsp;field(default_factory=lambda:&nbsp;np.zeros(3,&nbsp;dtype=np.float32))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Правый&nbsp;конец&nbsp;портала&nbsp;в&nbsp;мировых&nbsp;координатах.&quot;&quot;&quot;<br>
<br>
<br>
@dataclass<br>
class&nbsp;NavPolygon:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Полигон&nbsp;навигационной&nbsp;сетки.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Представляет&nbsp;собой&nbsp;плоскую&nbsp;область,&nbsp;по&nbsp;которой&nbsp;можно&nbsp;перемещаться.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;vertices:&nbsp;np.ndarray<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Вершины&nbsp;полигона&nbsp;в&nbsp;мировых&nbsp;координатах,&nbsp;shape&nbsp;(N,&nbsp;3).&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;triangles:&nbsp;np.ndarray<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Индексы&nbsp;треугольников,&nbsp;shape&nbsp;(M,&nbsp;3).&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;normal:&nbsp;np.ndarray<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Усреднённая&nbsp;нормаль&nbsp;полигона,&nbsp;shape&nbsp;(3,).&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;voxel_coords:&nbsp;list[tuple[int,&nbsp;int,&nbsp;int]]&nbsp;=&nbsp;field(default_factory=list)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Воксельные&nbsp;координаты,&nbsp;из&nbsp;которых&nbsp;построен&nbsp;полигон.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;neighbors:&nbsp;list[int]&nbsp;=&nbsp;field(default_factory=list)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Индексы&nbsp;соседних&nbsp;полигонов&nbsp;(заполняется&nbsp;позже).&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;outer_contour:&nbsp;Optional[list[int]]&nbsp;=&nbsp;None<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Внешний&nbsp;контур&nbsp;—&nbsp;упорядоченный&nbsp;список&nbsp;индексов&nbsp;вершин&nbsp;(CCW).&nbsp;None&nbsp;если&nbsp;не&nbsp;вычислен.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;holes:&nbsp;list[list[int]]&nbsp;=&nbsp;field(default_factory=list)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Дыры&nbsp;—&nbsp;список&nbsp;контуров,&nbsp;каждый&nbsp;контур&nbsp;—&nbsp;список&nbsp;индексов&nbsp;вершин&nbsp;(CW).&quot;&quot;&quot;<br>
<br>
<br>
@dataclass<br>
class&nbsp;NavMesh:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Навигационная&nbsp;сетка.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Набор&nbsp;полигонов&nbsp;с&nbsp;информацией&nbsp;о&nbsp;связности.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;polygons:&nbsp;list[NavPolygon]&nbsp;=&nbsp;field(default_factory=list)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Список&nbsp;полигонов.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;cell_size:&nbsp;float&nbsp;=&nbsp;0.25<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Размер&nbsp;вокселя,&nbsp;из&nbsp;которого&nbsp;построена&nbsp;сетка.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;origin:&nbsp;np.ndarray&nbsp;=&nbsp;field(default_factory=lambda:&nbsp;np.zeros(3,&nbsp;dtype=np.float32))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Начало&nbsp;координат&nbsp;воксельной&nbsp;сетки.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;str&nbsp;=&nbsp;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Имя&nbsp;навигационной&nbsp;сетки.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;source_path:&nbsp;str&nbsp;|&nbsp;None&nbsp;=&nbsp;None<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Путь&nbsp;к&nbsp;файлу-источнику.&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;polygon_count(self)&nbsp;-&gt;&nbsp;int:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Количество&nbsp;полигонов.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;len(self.polygons)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;triangle_count(self)&nbsp;-&gt;&nbsp;int:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Общее&nbsp;количество&nbsp;треугольников.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;sum(len(p.triangles)&nbsp;for&nbsp;p&nbsp;in&nbsp;self.polygons)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;vertex_count(self)&nbsp;-&gt;&nbsp;int:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Общее&nbsp;количество&nbsp;вершин.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;sum(len(p.vertices)&nbsp;for&nbsp;p&nbsp;in&nbsp;self.polygons)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Сериализация<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;direct_serialize(self)&nbsp;-&gt;&nbsp;dict:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Сериализует&nbsp;NavMesh&nbsp;в&nbsp;словарь.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Если&nbsp;source_path&nbsp;задан,&nbsp;возвращает&nbsp;ссылку&nbsp;на&nbsp;файл.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Иначе&nbsp;сериализует&nbsp;данные&nbsp;inline.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self.source_path&nbsp;is&nbsp;not&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;type&quot;:&nbsp;&quot;path&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;path&quot;:&nbsp;self.source_path,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;type&quot;:&nbsp;&quot;inline&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;name&quot;:&nbsp;self.name,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;cell_size&quot;:&nbsp;self.cell_size,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;origin&quot;:&nbsp;self.origin.tolist(),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;polygons&quot;:&nbsp;[<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;vertices&quot;:&nbsp;p.vertices.tolist(),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;triangles&quot;:&nbsp;p.triangles.tolist(),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;normal&quot;:&nbsp;p.normal.tolist(),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;neighbors&quot;:&nbsp;p.neighbors,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;p&nbsp;in&nbsp;self.polygons<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;@classmethod<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;direct_deserialize(cls,&nbsp;data:&nbsp;dict)&nbsp;-&gt;&nbsp;&quot;NavMesh&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Десериализует&nbsp;NavMesh&nbsp;из&nbsp;словаря.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;source_path&nbsp;=&nbsp;data.get(&quot;path&quot;)&nbsp;if&nbsp;data.get(&quot;type&quot;)&nbsp;==&nbsp;&quot;path&quot;&nbsp;else&nbsp;None<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;polygons&nbsp;=&nbsp;[]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;p_data&nbsp;in&nbsp;data.get(&quot;polygons&quot;,&nbsp;[]):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;polygon&nbsp;=&nbsp;NavPolygon(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertices=np.array(p_data[&quot;vertices&quot;],&nbsp;dtype=np.float32),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;triangles=np.array(p_data[&quot;triangles&quot;],&nbsp;dtype=np.int32),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;normal=np.array(p_data[&quot;normal&quot;],&nbsp;dtype=np.float32),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;neighbors=p_data.get(&quot;neighbors&quot;,&nbsp;[]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;polygons.append(polygon)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;cls(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;polygons=polygons,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cell_size=data.get(&quot;cell_size&quot;,&nbsp;0.25),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;origin=np.array(data.get(&quot;origin&quot;,&nbsp;[0,&nbsp;0,&nbsp;0]),&nbsp;dtype=np.float32),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=data.get(&quot;name&quot;,&nbsp;&quot;&quot;),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;source_path=source_path,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<!-- END SCAT CODE -->
</body>
</html>
