<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/fem/inertia3d.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#!/usr/bin/env&nbsp;python3<br>
&quot;&quot;&quot;<br>
Пространственная&nbsp;инерция&nbsp;в&nbsp;стиле&nbsp;Фезерстоуна.<br>
<br>
Инерция&nbsp;представлена&nbsp;как:<br>
-&nbsp;m:&nbsp;масса<br>
-&nbsp;I_diag:&nbsp;вектор&nbsp;главных&nbsp;моментов&nbsp;инерции&nbsp;(3&nbsp;компоненты)<br>
-&nbsp;frame:&nbsp;Pose3&nbsp;—&nbsp;система&nbsp;координат&nbsp;эллипсоида&nbsp;инерции&nbsp;относительно&nbsp;СК&nbsp;тела<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(lin&nbsp;=&nbsp;положение&nbsp;COM,&nbsp;ang&nbsp;=&nbsp;ориентация&nbsp;главных&nbsp;осей)<br>
&quot;&quot;&quot;<br>
<br>
import&nbsp;numpy&nbsp;as&nbsp;np<br>
from&nbsp;termin.geombase&nbsp;import&nbsp;Pose3<br>
from&nbsp;termin.geombase.screw&nbsp;import&nbsp;Screw3<br>
<br>
<br>
class&nbsp;SpatialInertia3D:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Пространственная&nbsp;инерция&nbsp;твёрдого&nbsp;тела.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Хранит:<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;m:&nbsp;масса<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;I_diag:&nbsp;главные&nbsp;моменты&nbsp;инерции&nbsp;(вектор&nbsp;из&nbsp;3&nbsp;компонент)<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;frame:&nbsp;Pose3&nbsp;—&nbsp;СК&nbsp;эллипсоида&nbsp;инерции&nbsp;(lin&nbsp;=&nbsp;COM,&nbsp;ang&nbsp;=&nbsp;ориентация&nbsp;главных&nbsp;осей)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Все&nbsp;операции&nbsp;(apply,&nbsp;solve)&nbsp;работают&nbsp;через&nbsp;преобразование&nbsp;в&nbsp;СК&nbsp;эллипсоида,<br>
&nbsp;&nbsp;&nbsp;&nbsp;где&nbsp;тензор&nbsp;инерции&nbsp;диагонален.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mass:&nbsp;float&nbsp;=&nbsp;0.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_diag:&nbsp;np.ndarray&nbsp;=&nbsp;None,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frame:&nbsp;Pose3&nbsp;=&nbsp;None,<br>
&nbsp;&nbsp;&nbsp;&nbsp;):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.m&nbsp;=&nbsp;float(mass)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;I_diag&nbsp;is&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.I_diag&nbsp;=&nbsp;np.zeros(3,&nbsp;dtype=np.float64)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.I_diag&nbsp;=&nbsp;np.asarray(I_diag,&nbsp;dtype=np.float64).reshape(3)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;frame&nbsp;is&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.frame&nbsp;=&nbsp;Pose3.identity()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.frame&nbsp;=&nbsp;frame<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;@staticmethod<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;from_matrix(mass:&nbsp;float,&nbsp;inertia:&nbsp;np.ndarray,&nbsp;com:&nbsp;np.ndarray&nbsp;=&nbsp;None)&nbsp;-&gt;&nbsp;&quot;SpatialInertia3D&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Создать&nbsp;SpatialInertia3D&nbsp;из&nbsp;матрицы&nbsp;инерции&nbsp;3x3.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Диагонализует&nbsp;матрицу&nbsp;для&nbsp;получения&nbsp;главных&nbsp;моментов&nbsp;и&nbsp;осей.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;com&nbsp;is&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com&nbsp;=&nbsp;np.zeros(3)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inertia&nbsp;=&nbsp;np.asarray(inertia,&nbsp;dtype=np.float64).reshape(3,&nbsp;3)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Диагонализация:&nbsp;I&nbsp;=&nbsp;R&nbsp;@&nbsp;diag(eigenvalues)&nbsp;@&nbsp;R.T<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eigenvalues,&nbsp;eigenvectors&nbsp;=&nbsp;np.linalg.eigh(inertia)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;eigenvectors&nbsp;—&nbsp;столбцы,&nbsp;это&nbsp;матрица&nbsp;поворота<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Убеждаемся&nbsp;что&nbsp;это&nbsp;правая&nbsp;СК&nbsp;(det&nbsp;=&nbsp;+1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;np.linalg.det(eigenvectors)&nbsp;&lt;&nbsp;0:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eigenvectors[:,&nbsp;0]&nbsp;*=&nbsp;-1<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Строим&nbsp;кватернион&nbsp;из&nbsp;матрицы&nbsp;поворота<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R&nbsp;=&nbsp;eigenvectors<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;trace&nbsp;=&nbsp;np.trace(R)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;trace&nbsp;&gt;&nbsp;0:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;0.5&nbsp;/&nbsp;np.sqrt(trace&nbsp;+&nbsp;1.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;0.25&nbsp;/&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;(R[2,&nbsp;1]&nbsp;-&nbsp;R[1,&nbsp;2])&nbsp;*&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;(R[0,&nbsp;2]&nbsp;-&nbsp;R[2,&nbsp;0])&nbsp;*&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;=&nbsp;(R[1,&nbsp;0]&nbsp;-&nbsp;R[0,&nbsp;1])&nbsp;*&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;R[0,&nbsp;0]&nbsp;&gt;&nbsp;R[1,&nbsp;1]&nbsp;and&nbsp;R[0,&nbsp;0]&nbsp;&gt;&nbsp;R[2,&nbsp;2]:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;2.0&nbsp;*&nbsp;np.sqrt(1.0&nbsp;+&nbsp;R[0,&nbsp;0]&nbsp;-&nbsp;R[1,&nbsp;1]&nbsp;-&nbsp;R[2,&nbsp;2])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;(R[2,&nbsp;1]&nbsp;-&nbsp;R[1,&nbsp;2])&nbsp;/&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;0.25&nbsp;*&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;(R[0,&nbsp;1]&nbsp;+&nbsp;R[1,&nbsp;0])&nbsp;/&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;=&nbsp;(R[0,&nbsp;2]&nbsp;+&nbsp;R[2,&nbsp;0])&nbsp;/&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;R[1,&nbsp;1]&nbsp;&gt;&nbsp;R[2,&nbsp;2]:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;2.0&nbsp;*&nbsp;np.sqrt(1.0&nbsp;+&nbsp;R[1,&nbsp;1]&nbsp;-&nbsp;R[0,&nbsp;0]&nbsp;-&nbsp;R[2,&nbsp;2])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;(R[0,&nbsp;2]&nbsp;-&nbsp;R[2,&nbsp;0])&nbsp;/&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;(R[0,&nbsp;1]&nbsp;+&nbsp;R[1,&nbsp;0])&nbsp;/&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;0.25&nbsp;*&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;=&nbsp;(R[1,&nbsp;2]&nbsp;+&nbsp;R[2,&nbsp;1])&nbsp;/&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;2.0&nbsp;*&nbsp;np.sqrt(1.0&nbsp;+&nbsp;R[2,&nbsp;2]&nbsp;-&nbsp;R[0,&nbsp;0]&nbsp;-&nbsp;R[1,&nbsp;1])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;(R[1,&nbsp;0]&nbsp;-&nbsp;R[0,&nbsp;1])&nbsp;/&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;(R[0,&nbsp;2]&nbsp;+&nbsp;R[2,&nbsp;0])&nbsp;/&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;(R[1,&nbsp;2]&nbsp;+&nbsp;R[2,&nbsp;1])&nbsp;/&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z&nbsp;=&nbsp;0.25&nbsp;*&nbsp;s<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quat&nbsp;=&nbsp;np.array([x,&nbsp;y,&nbsp;z,&nbsp;w],&nbsp;dtype=np.float64)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quat&nbsp;/=&nbsp;np.linalg.norm(quat)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;=&nbsp;Pose3(ang=quat,&nbsp;lin=np.asarray(com,&nbsp;dtype=np.float64))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;SpatialInertia3D(mass=mass,&nbsp;I_diag=eigenvalues,&nbsp;frame=frame)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Свойства&nbsp;для&nbsp;совместимости<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;@property<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;mass(self)&nbsp;-&gt;&nbsp;float:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.m<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;@property<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;c(self)&nbsp;-&gt;&nbsp;np.ndarray:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Центр&nbsp;масс&nbsp;(для&nbsp;совместимости).&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.frame.lin<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;@property<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;Ic(self)&nbsp;-&gt;&nbsp;np.ndarray:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Матрица&nbsp;инерции&nbsp;3x3&nbsp;(для&nbsp;совместимости).&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R&nbsp;=&nbsp;self.frame.rotation_matrix()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;R&nbsp;@&nbsp;np.diag(self.I_diag)&nbsp;@&nbsp;R.T<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Spatial&nbsp;inertia&nbsp;matrix&nbsp;6x6<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;to_matrix_vw_order(self)&nbsp;-&gt;&nbsp;np.ndarray:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Матрица&nbsp;пространственной&nbsp;инерции&nbsp;6x6&nbsp;в&nbsp;порядке&nbsp;[v,&nbsp;ω].<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Формат:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;m*I&nbsp;&nbsp;&nbsp;&nbsp;m*skew(c)^T&nbsp;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;m*skew(c)&nbsp;&nbsp;&nbsp;&nbsp;Ic&nbsp;&nbsp;&nbsp;&nbsp;]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;где&nbsp;skew(c)&nbsp;—&nbsp;кососимметричная&nbsp;матрица&nbsp;для&nbsp;c×.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;=&nbsp;self.m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;self.frame.lin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ic&nbsp;=&nbsp;self.Ic<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;skew(c)&nbsp;такая&nbsp;что&nbsp;skew(c)&nbsp;@&nbsp;x&nbsp;=&nbsp;c&nbsp;×&nbsp;x<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;skew(v):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;np.array([<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[0,&nbsp;-v[2],&nbsp;v[1]],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[v[2],&nbsp;0,&nbsp;-v[0]],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[-v[1],&nbsp;v[0],&nbsp;0]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],&nbsp;dtype=float)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S&nbsp;=&nbsp;skew(c)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;upper_left&nbsp;=&nbsp;m&nbsp;*&nbsp;np.eye(3)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;upper_right&nbsp;=&nbsp;m&nbsp;*&nbsp;S.T<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lower_left&nbsp;=&nbsp;m&nbsp;*&nbsp;S<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lower_right&nbsp;=&nbsp;Ic&nbsp;+&nbsp;m&nbsp;*&nbsp;(np.dot(c,&nbsp;c)&nbsp;*&nbsp;np.eye(3)&nbsp;-&nbsp;np.outer(c,&nbsp;c))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;np.block([<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[upper_left,&nbsp;upper_right],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[lower_left,&nbsp;lower_right]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Преобразования<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;rotated_by(self,&nbsp;pose:&nbsp;Pose3)&nbsp;-&gt;&nbsp;&quot;SpatialInertia3D&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Повернуть&nbsp;инерцию&nbsp;матрицей&nbsp;поворота&nbsp;из&nbsp;pose&nbsp;(без&nbsp;трансляции&nbsp;COM).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Поворачиваем&nbsp;frame&nbsp;эллипсоида<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_frame&nbsp;=&nbsp;Pose3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=(pose&nbsp;*&nbsp;Pose3(ang=self.frame.ang,&nbsp;lin=np.zeros(3))).ang,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=pose.rotate_point(self.frame.lin),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;SpatialInertia3D(mass=self.m,&nbsp;I_diag=self.I_diag.copy(),&nbsp;frame=new_frame)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;transform_by(self,&nbsp;pose:&nbsp;Pose3)&nbsp;-&gt;&nbsp;&quot;SpatialInertia3D&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Полное&nbsp;преобразование&nbsp;инерции&nbsp;(поворот&nbsp;+&nbsp;трансляция&nbsp;COM).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_frame&nbsp;=&nbsp;pose&nbsp;*&nbsp;self.frame<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;SpatialInertia3D(mass=self.m,&nbsp;I_diag=self.I_diag.copy(),&nbsp;frame=new_frame)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Применение&nbsp;инерции:&nbsp;I&nbsp;@&nbsp;twist&nbsp;-&gt;&nbsp;momentum<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;apply(self,&nbsp;twist:&nbsp;Screw3)&nbsp;-&gt;&nbsp;Screw3:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;@&nbsp;twist&nbsp;-&gt;&nbsp;momentum&nbsp;(wrench-like).<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;Переводим&nbsp;twist&nbsp;в&nbsp;СК&nbsp;эллипсоида<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;Умножаем&nbsp;на&nbsp;диагональную&nbsp;инерцию<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.&nbsp;Переводим&nbsp;обратно<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;В&nbsp;СК&nbsp;эллипсоида<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t_local&nbsp;=&nbsp;twist.inverse_transform_by(self.frame)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;h&nbsp;=&nbsp;I&nbsp;@&nbsp;v&nbsp;(диагональное&nbsp;умножение)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;h_lin&nbsp;=&nbsp;self.m&nbsp;*&nbsp;t_local.lin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;h_ang&nbsp;=&nbsp;self.I_diag&nbsp;*&nbsp;t_local.ang<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;h_local&nbsp;=&nbsp;Screw3(ang=h_ang,&nbsp;lin=h_lin)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Обратно&nbsp;в&nbsp;исходную&nbsp;СК<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;h_local.transform_by(self.frame)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__matmul__(self,&nbsp;twist:&nbsp;Screw3)&nbsp;-&gt;&nbsp;Screw3:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Operator&nbsp;@&nbsp;for&nbsp;I&nbsp;@&nbsp;twist.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.apply(twist)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Обратное&nbsp;применение:&nbsp;I⁻¹&nbsp;@&nbsp;wrench&nbsp;-&gt;&nbsp;twist<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;solve(self,&nbsp;wrench:&nbsp;Screw3)&nbsp;-&gt;&nbsp;Screw3:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I⁻¹&nbsp;@&nbsp;wrench&nbsp;-&gt;&nbsp;twist.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;Переводим&nbsp;wrench&nbsp;в&nbsp;СК&nbsp;эллипсоида<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;Делим&nbsp;на&nbsp;диагональную&nbsp;инерцию<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.&nbsp;Переводим&nbsp;обратно<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;В&nbsp;СК&nbsp;эллипсоида<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w_local&nbsp;=&nbsp;wrench.inverse_transform_by(self.frame)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;a&nbsp;=&nbsp;I⁻¹&nbsp;@&nbsp;f&nbsp;(диагональное&nbsp;деление)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a_lin&nbsp;=&nbsp;w_local.lin&nbsp;/&nbsp;self.m&nbsp;if&nbsp;self.m&nbsp;&gt;&nbsp;0&nbsp;else&nbsp;np.zeros(3)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a_ang&nbsp;=&nbsp;w_local.ang&nbsp;/&nbsp;self.I_diag<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a_local&nbsp;=&nbsp;Screw3(ang=a_ang,&nbsp;lin=a_lin)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Обратно&nbsp;в&nbsp;исходную&nbsp;СК<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;a_local.transform_by(self.frame)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Gravity&nbsp;wrench<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;gravity_wrench(self,&nbsp;g_local:&nbsp;np.ndarray)&nbsp;-&gt;&nbsp;Screw3:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Винт&nbsp;гравитации&nbsp;(F,&nbsp;τ)&nbsp;в&nbsp;локальной&nbsp;системе.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g_local&nbsp;—&nbsp;вектор&nbsp;гравитации&nbsp;в&nbsp;СК&nbsp;тела.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;self.frame.lin&nbsp;&nbsp;#&nbsp;COM<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F&nbsp;=&nbsp;self.m&nbsp;*&nbsp;g_local<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;τ&nbsp;=&nbsp;np.cross(c,&nbsp;F)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(ang=τ,&nbsp;lin=F)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Bias&nbsp;wrench<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;bias_wrench(self,&nbsp;velocity:&nbsp;Screw3)&nbsp;-&gt;&nbsp;Screw3:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Пространственный&nbsp;bias-винт:&nbsp;v&nbsp;×*&nbsp;(I&nbsp;@&nbsp;v).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;h&nbsp;=&nbsp;self.apply(velocity)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;velocity.cross_force(h)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Kinetic&nbsp;energy<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;kinetic_energy(self,&nbsp;twist:&nbsp;Screw3)&nbsp;-&gt;&nbsp;float:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Кинетическая&nbsp;энергия:&nbsp;0.5&nbsp;*&nbsp;v^T&nbsp;@&nbsp;I&nbsp;@&nbsp;v<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;h&nbsp;=&nbsp;self.apply(twist)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0.5&nbsp;*&nbsp;twist.dot(h)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Сложение&nbsp;инерций<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;----------------------------------------------------------------<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__add__(self,&nbsp;other:&nbsp;&quot;SpatialInertia3D&quot;)&nbsp;-&gt;&nbsp;&quot;SpatialInertia3D&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Сложение&nbsp;двух&nbsp;инерций.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Результат&nbsp;—&nbsp;новая&nbsp;инерция&nbsp;с&nbsp;общим&nbsp;COM&nbsp;и&nbsp;суммарным&nbsp;тензором.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;isinstance(other,&nbsp;SpatialInertia3D):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NotImplemented<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m1,&nbsp;m2&nbsp;=&nbsp;self.m,&nbsp;other.m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c1,&nbsp;c2&nbsp;=&nbsp;self.frame.lin,&nbsp;other.frame.lin<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;=&nbsp;m1&nbsp;+&nbsp;m2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;m&nbsp;==&nbsp;0.0:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;SpatialInertia3D(mass=0.0)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Новый&nbsp;COM<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;(m1&nbsp;*&nbsp;c1&nbsp;+&nbsp;m2&nbsp;*&nbsp;c2)&nbsp;/&nbsp;m<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Тензоры&nbsp;инерции&nbsp;относительно&nbsp;нового&nbsp;COM&nbsp;(теорема&nbsp;Штейнера)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d1&nbsp;=&nbsp;c1&nbsp;-&nbsp;c<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d2&nbsp;=&nbsp;c2&nbsp;-&nbsp;c<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I1&nbsp;=&nbsp;self.Ic&nbsp;+&nbsp;m1&nbsp;*&nbsp;(np.dot(d1,&nbsp;d1)&nbsp;*&nbsp;np.eye(3)&nbsp;-&nbsp;np.outer(d1,&nbsp;d1))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I2&nbsp;=&nbsp;other.Ic&nbsp;+&nbsp;m2&nbsp;*&nbsp;(np.dot(d2,&nbsp;d2)&nbsp;*&nbsp;np.eye(3)&nbsp;-&nbsp;np.outer(d2,&nbsp;d2))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_total&nbsp;=&nbsp;I1&nbsp;+&nbsp;I2<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;SpatialInertia3D.from_matrix(mass=m,&nbsp;inertia=I_total,&nbsp;com=c)<br>
<!-- END SCAT CODE -->
</body>
</html>
