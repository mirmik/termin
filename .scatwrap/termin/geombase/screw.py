<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/geombase/screw.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
import&nbsp;numpy<br>
import&nbsp;math<br>
from&nbsp;.pose3&nbsp;import&nbsp;Pose3<br>
<br>
def&nbsp;cross2d(scalar,&nbsp;vec):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;2D&nbsp;cross&nbsp;product:&nbsp;scalar&nbsp;×&nbsp;vector&nbsp;=&nbsp;[vy,&nbsp;-vx]&nbsp;*&nbsp;scalar&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;scalar&nbsp;*&nbsp;numpy.array([vec[1],&nbsp;-vec[0]])<br>
<br>
def&nbsp;cross2d_scalar(vec1,&nbsp;vec2):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;2D&nbsp;cross&nbsp;product&nbsp;returning&nbsp;scalar:&nbsp;vec1&nbsp;×&nbsp;vec2&nbsp;=&nbsp;v1x*v2y&nbsp;-&nbsp;v1y*v2x&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;vec1[0]*vec2[1]&nbsp;-&nbsp;vec1[1]*vec2[0]<br>
<br>
def&nbsp;cross2d_xz(vec,&nbsp;scalar):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;2D&nbsp;cross&nbsp;product&nbsp;for&nbsp;twist&nbsp;transformation:&nbsp;vector&nbsp;×&nbsp;scalar&nbsp;=&nbsp;[-sy,&nbsp;sx]&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;numpy.array([-scalar&nbsp;*&nbsp;vec[1],&nbsp;scalar&nbsp;*&nbsp;vec[0]])<br>
<br>
class&nbsp;Screw:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;A&nbsp;class&nbsp;representing&nbsp;a&nbsp;pair&nbsp;of&nbsp;vector&nbsp;and&nbsp;bivector&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;ang,&nbsp;lin):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.ang&nbsp;=&nbsp;ang&nbsp;&nbsp;#&nbsp;Bivector&nbsp;part<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.lin&nbsp;=&nbsp;lin&nbsp;&nbsp;#&nbsp;Vector&nbsp;part<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;isinstance(self.ang,&nbsp;numpy.ndarray):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;Exception(&quot;ang&nbsp;must&nbsp;be&nbsp;ndarray&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;isinstance(self.lin,&nbsp;numpy.ndarray):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;Exception(&quot;lin&nbsp;must&nbsp;be&nbsp;ndarray&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__repr__(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;f&quot;Screw(ang={self.ang},&nbsp;lin={self.lin})&quot;<br>
<br>
class&nbsp;Screw2(Screw):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;A&nbsp;2D&nbsp;Screw&nbsp;specialized&nbsp;for&nbsp;planar&nbsp;motions.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;ang:&nbsp;numpy.ndarray,&nbsp;lin:&nbsp;numpy.ndarray):<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;isinstance(ang,&nbsp;numpy.ndarray):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang&nbsp;=&nbsp;numpy.array(ang)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;#&nbsp;check&nbsp;shapes<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;if&nbsp;ang.shape&nbsp;!=&nbsp;(1,)&nbsp;and&nbsp;ang.shape&nbsp;!=&nbsp;():<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;Exception(&quot;ang&nbsp;must&nbsp;be&nbsp;a&nbsp;scalar&nbsp;or&nbsp;shape&nbsp;(1,)&nbsp;ndarray&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;if&nbsp;lin.shape&nbsp;!=&nbsp;(2,):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;Exception(f&quot;lin&nbsp;must&nbsp;be&nbsp;shape&nbsp;(2,)&nbsp;ndarray,&nbsp;got&nbsp;{lin.shape}&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang&nbsp;=&nbsp;ang.reshape(1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin&nbsp;=&nbsp;lin.reshape(2)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super().__init__(ang=ang,&nbsp;lin=lin)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;moment(self)&nbsp;-&gt;&nbsp;float:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Return&nbsp;the&nbsp;moment&nbsp;(bivector&nbsp;part)&nbsp;of&nbsp;the&nbsp;screw.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.ang.item()&nbsp;if&nbsp;self.ang.shape&nbsp;==&nbsp;()&nbsp;or&nbsp;self.ang.shape&nbsp;==&nbsp;(1,)&nbsp;else&nbsp;self.ang[0]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;vector(self)&nbsp;-&gt;&nbsp;numpy.ndarray:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Return&nbsp;the&nbsp;vector&nbsp;part&nbsp;of&nbsp;the&nbsp;screw.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.lin<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;kinematic_carry(self,&nbsp;arm:&nbsp;&quot;Vector2&quot;)&nbsp;-&gt;&nbsp;&quot;Screw2&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Twist&nbsp;transform.&nbsp;Carry&nbsp;the&nbsp;screw&nbsp;by&nbsp;arm.&nbsp;For&nbsp;pair&nbsp;of&nbsp;angular&nbsp;and&nbsp;linear&nbsp;speeds.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=self.lin&nbsp;+&nbsp;cross2d(self.moment(),&nbsp;arm),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=self.ang)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;force_carry(self,&nbsp;arm:&nbsp;&quot;Vector2&quot;)&nbsp;-&gt;&nbsp;&quot;Screw2&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Wrench&nbsp;transform.&nbsp;Carry&nbsp;the&nbsp;screw&nbsp;by&nbsp;arm.&nbsp;For&nbsp;pair&nbsp;of&nbsp;torques&nbsp;and&nbsp;forces.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=self.ang&nbsp;-&nbsp;numpy.array([cross2d_scalar(arm,&nbsp;self.lin)]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=self.lin)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;twist_carry(self,&nbsp;arm:&nbsp;&quot;Vector2&quot;)&nbsp;-&gt;&nbsp;&quot;Screw2&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Alias&nbsp;for&nbsp;kinematic_carry.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.kinematic_carry(arm)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;wrench_carry(self,&nbsp;arm:&nbsp;&quot;Vector2&quot;)&nbsp;-&gt;&nbsp;&quot;Screw2&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Alias&nbsp;for&nbsp;force_carry.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.force_carry(arm)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;transform_by(self,&nbsp;trans):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(ang=self.ang,&nbsp;lin=trans.transform_vector(self.lin))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;rotated_by(self,&nbsp;trans):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(ang=self.ang,&nbsp;lin=trans.rotate_vector(self.lin))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;inverse_transform_by(self,&nbsp;trans):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(ang=self.ang,&nbsp;lin=trans.inverse_transform_vector(self.lin))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;transform_as_twist_by(self,&nbsp;trans):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rlin&nbsp;=&nbsp;trans.transform_vector(self.lin)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=rlin&nbsp;+&nbsp;cross2d_xz(trans.lin,&nbsp;self.moment()),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=self.ang,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;inverse_transform_as_twist_by(self,&nbsp;trans):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=self.ang,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=trans.inverse_transform_vector(self.lin&nbsp;-&nbsp;cross2d_xz(trans.lin,&nbsp;self.moment()))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;transform_as_wrench_by(self,&nbsp;trans):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Transform&nbsp;wrench&nbsp;(moment&nbsp;+&nbsp;force)&nbsp;under&nbsp;SE(2)&nbsp;transform.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=self.ang&nbsp;+&nbsp;numpy.array([cross2d_scalar(trans.lin,&nbsp;self.lin)]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=trans.transform_vector(self.lin)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;inverse_transform_as_wrench_by(self,&nbsp;trans):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Inverse&nbsp;transform&nbsp;of&nbsp;a&nbsp;wrench&nbsp;under&nbsp;SE(2)&nbsp;transform.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=self.ang&nbsp;-&nbsp;numpy.array([cross2d_scalar(trans.lin,&nbsp;self.lin)]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=trans.inverse_transform_vector(self.lin)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__mul__(self,&nbsp;oth):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(self.ang&nbsp;*&nbsp;oth,&nbsp;self.lin&nbsp;*&nbsp;oth)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__add__(self,&nbsp;oth):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(self.ang&nbsp;+&nbsp;oth.ang,&nbsp;self.lin&nbsp;+&nbsp;oth.lin)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__sub__(self,&nbsp;oth):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(self.ang&nbsp;-&nbsp;oth.ang,&nbsp;self.lin&nbsp;-&nbsp;oth.lin)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;to_vector_vw_order(self)&nbsp;-&gt;&nbsp;numpy.ndarray:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Return&nbsp;the&nbsp;screw&nbsp;as&nbsp;a&nbsp;3x1&nbsp;array&nbsp;in&nbsp;[vx,&nbsp;vy,&nbsp;w]&nbsp;order.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;numpy.array([self.lin[0],&nbsp;self.lin[1],&nbsp;self.moment()],&nbsp;float)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;to_vector_wv_order(self)&nbsp;-&gt;&nbsp;numpy.ndarray:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Return&nbsp;the&nbsp;screw&nbsp;as&nbsp;a&nbsp;3x1&nbsp;array&nbsp;in&nbsp;[w,&nbsp;vx,&nbsp;vy]&nbsp;order.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;numpy.array([self.moment(),&nbsp;self.lin[0],&nbsp;self.lin[1]],&nbsp;float)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;from_vector_vw_order(vec:&nbsp;numpy.ndarray)&nbsp;-&gt;&nbsp;&quot;Screw2&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;a&nbsp;Screw2&nbsp;from&nbsp;a&nbsp;3x1&nbsp;array&nbsp;in&nbsp;[vx,&nbsp;vy,&nbsp;w]&nbsp;order.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;vec.shape&nbsp;!=&nbsp;(3,):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;Exception(&quot;Input&nbsp;vector&nbsp;must&nbsp;be&nbsp;of&nbsp;shape&nbsp;(3,)&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=numpy.array([vec[2]]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=numpy.array([vec[0],&nbsp;vec[1]])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;from_vector_wv_order(vec:&nbsp;numpy.ndarray)&nbsp;-&gt;&nbsp;&quot;Screw2&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;a&nbsp;Screw2&nbsp;from&nbsp;a&nbsp;3x1&nbsp;array&nbsp;in&nbsp;[w,&nbsp;vx,&nbsp;vy]&nbsp;order.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;vec.shape&nbsp;!=&nbsp;(3,):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;Exception(&quot;Input&nbsp;vector&nbsp;must&nbsp;be&nbsp;of&nbsp;shape&nbsp;(3,)&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw2(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=numpy.array([vec[0]]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=numpy.array([vec[1],&nbsp;vec[2]])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;to_pose(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Convert&nbsp;the&nbsp;screw&nbsp;to&nbsp;a&nbsp;Pose2&nbsp;representation&nbsp;(for&nbsp;small&nbsp;motions).&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Pose2(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=self.moment(),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=self.lin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
class&nbsp;Screw3(Screw):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;A&nbsp;3D&nbsp;Screw&nbsp;specialized&nbsp;for&nbsp;spatial&nbsp;motions.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;ang:&nbsp;numpy.ndarray&nbsp;=&nbsp;numpy.array([0,0,0]),&nbsp;lin:&nbsp;numpy.ndarray&nbsp;=&nbsp;numpy.array([0,0,0])):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super().__init__(ang=ang,&nbsp;lin=lin)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;moment(self)&nbsp;-&gt;&nbsp;numpy.ndarray:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Return&nbsp;the&nbsp;moment&nbsp;(bivector&nbsp;part)&nbsp;of&nbsp;the&nbsp;screw.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.ang<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;vector(self)&nbsp;-&gt;&nbsp;numpy.ndarray:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Return&nbsp;the&nbsp;vector&nbsp;part&nbsp;of&nbsp;the&nbsp;screw.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.lin<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;kinematic_carry(self,&nbsp;arm:&nbsp;&quot;Vector3&quot;)&nbsp;-&gt;&nbsp;&quot;Screw3&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Twist&nbsp;transform.&nbsp;Carry&nbsp;the&nbsp;screw&nbsp;by&nbsp;arm.&nbsp;For&nbsp;pair&nbsp;of&nbsp;angular&nbsp;and&nbsp;linear&nbsp;speeds.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=self.lin&nbsp;+&nbsp;numpy.cross(self.ang,&nbsp;arm),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=self.ang)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;force_carry(self,&nbsp;arm:&nbsp;&quot;Vector3&quot;)&nbsp;-&gt;&nbsp;&quot;Screw3&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Wrench&nbsp;transform.&nbsp;Carry&nbsp;the&nbsp;screw&nbsp;by&nbsp;arm.&nbsp;For&nbsp;pair&nbsp;of&nbsp;torques&nbsp;and&nbsp;forces.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=self.ang&nbsp;-&nbsp;numpy.cross(arm,&nbsp;self.lin),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=self.lin)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;twist_carry(self,&nbsp;arm:&nbsp;&quot;Vector3&quot;)&nbsp;-&gt;&nbsp;&quot;Screw3&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Alias&nbsp;for&nbsp;kinematic_carry.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.kinematic_carry(arm)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;wrench_carry(self,&nbsp;arm:&nbsp;&quot;Vector3&quot;)&nbsp;-&gt;&nbsp;&quot;Screw3&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Alias&nbsp;for&nbsp;force_carry.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.force_carry(arm)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;transform_by(self,&nbsp;trans):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=trans.transform_vector(self.ang),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=trans.transform_vector(self.lin)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;rotate_by(self,&nbsp;rot):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=rot.transform_vector(self.ang),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=rot.transform_vector(self.lin)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;inverse_rotate_by(self,&nbsp;rot):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=rot.inverse_transform_vector(self.ang),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=rot.inverse_transform_vector(self.lin)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;inverse_transform_by(self,&nbsp;trans):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=trans.inverse_transform_vector(self.ang),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=trans.inverse_transform_vector(self.lin)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;transform_as_twist_by(self,&nbsp;trans):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rang&nbsp;=&nbsp;trans.transform_vector(self.ang)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang&nbsp;=&nbsp;rang,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin&nbsp;=&nbsp;trans.transform_vector(self.lin)&nbsp;+&nbsp;numpy.cross(trans.lin,&nbsp;rang)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;inverse_transform_as_twist_by(self,&nbsp;trans):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang&nbsp;=&nbsp;trans.inverse_transform_vector(self.ang),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin&nbsp;=&nbsp;trans.inverse_transform_vector(self.lin&nbsp;-&nbsp;numpy.cross(trans.lin,&nbsp;self.ang))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;transform_as_wrench_by(self,&nbsp;trans):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Transform&nbsp;wrench&nbsp;(moment&nbsp;+&nbsp;force)&nbsp;under&nbsp;SE(3)&nbsp;transform.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;trans.lin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang&nbsp;=&nbsp;trans.transform_vector(self.ang&nbsp;+&nbsp;numpy.cross(p,&nbsp;self.lin)),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin&nbsp;=&nbsp;trans.transform_vector(self.lin)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;inverse_transform_as_wrench_by(self,&nbsp;trans):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Inverse&nbsp;transform&nbsp;of&nbsp;a&nbsp;wrench&nbsp;under&nbsp;SE(3)&nbsp;transform.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;trans.lin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang&nbsp;=&nbsp;trans.inverse_transform_vector(self.ang&nbsp;-&nbsp;numpy.cross(p,&nbsp;self.lin)),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin&nbsp;=&nbsp;trans.inverse_transform_vector(self.lin)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;as_pose3(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Convert&nbsp;the&nbsp;screw&nbsp;to&nbsp;a&nbsp;Pose3&nbsp;representation&nbsp;(for&nbsp;small&nbsp;motions).&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotangle&nbsp;=&nbsp;numpy.linalg.norm(self.ang)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;rotangle&nbsp;&lt;&nbsp;1e-8:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Pure&nbsp;translation<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Pose3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=numpy.array([0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;1.0]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=self.lin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;axis&nbsp;=&nbsp;self.ang&nbsp;/&nbsp;rotangle<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;half_angle&nbsp;=&nbsp;rotangle&nbsp;/&nbsp;2.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q&nbsp;=&nbsp;numpy.array([<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;axis[0]&nbsp;*&nbsp;math.sin(half_angle),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;axis[1]&nbsp;*&nbsp;math.sin(half_angle),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;axis[2]&nbsp;*&nbsp;math.sin(half_angle),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;math.cos(half_angle)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Pose3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=q,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=self.lin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__mul__(self,&nbsp;oth):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(self.ang&nbsp;*&nbsp;oth,&nbsp;self.lin&nbsp;*&nbsp;oth)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;to_vw_array(self)&nbsp;-&gt;&nbsp;numpy.ndarray:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Return&nbsp;the&nbsp;screw&nbsp;as&nbsp;a&nbsp;6x1&nbsp;array&nbsp;in&nbsp;[vx,&nbsp;vy,&nbsp;vz,&nbsp;wx,&nbsp;wy,&nbsp;wz]&nbsp;order.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;numpy.hstack([self.lin,&nbsp;self.ang])<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;to_wv_array(self)&nbsp;-&gt;&nbsp;numpy.ndarray:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Return&nbsp;the&nbsp;screw&nbsp;as&nbsp;a&nbsp;6x1&nbsp;array&nbsp;in&nbsp;[wx,&nbsp;wy,&nbsp;wz,&nbsp;vx,&nbsp;vy,&nbsp;vz]&nbsp;order.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;numpy.hstack([self.ang,&nbsp;self.lin])<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;from_vw_array(vec:&nbsp;numpy.ndarray)&nbsp;-&gt;&nbsp;&quot;Screw3&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;a&nbsp;Screw3&nbsp;from&nbsp;a&nbsp;6x1&nbsp;array&nbsp;in&nbsp;[vx,&nbsp;vy,&nbsp;vz,&nbsp;wx,&nbsp;wy,&nbsp;wz]&nbsp;order.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;vec.shape&nbsp;!=&nbsp;(6,):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;Exception(&quot;Input&nbsp;vector&nbsp;must&nbsp;be&nbsp;of&nbsp;shape&nbsp;(6,)&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=vec[3:6],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=vec[0:3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;from_wv_array(vec:&nbsp;numpy.ndarray)&nbsp;-&gt;&nbsp;&quot;Screw3&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;a&nbsp;Screw3&nbsp;from&nbsp;a&nbsp;6x1&nbsp;array&nbsp;in&nbsp;[wx,&nbsp;wy,&nbsp;wz,&nbsp;vx,&nbsp;vy,&nbsp;vz]&nbsp;order.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;vec.shape&nbsp;!=&nbsp;(6,):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;Exception(&quot;Input&nbsp;vector&nbsp;must&nbsp;be&nbsp;of&nbsp;shape&nbsp;(6,)&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=vec[0:3],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=vec[3:6]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;to_pose(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Convert&nbsp;the&nbsp;screw&nbsp;to&nbsp;a&nbsp;Pose3&nbsp;representation&nbsp;(for&nbsp;small&nbsp;motions).&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin&nbsp;=&nbsp;self.lin<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#exponential&nbsp;map&nbsp;for&nbsp;rotation<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theta&nbsp;=&nbsp;numpy.linalg.norm(self.ang)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;theta&nbsp;&lt;&nbsp;1e-8:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Pure&nbsp;translation<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Pose3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=numpy.array([0.0,&nbsp;0.0,&nbsp;0.0,&nbsp;1.0]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=lin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;axis&nbsp;=&nbsp;self.ang&nbsp;/&nbsp;theta<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;half_angle&nbsp;=&nbsp;theta&nbsp;/&nbsp;2.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q&nbsp;=&nbsp;numpy.array([<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;axis[0]&nbsp;*&nbsp;math.sin(half_angle),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;axis[1]&nbsp;*&nbsp;math.sin(half_angle),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;axis[2]&nbsp;*&nbsp;math.sin(half_angle),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;math.cos(half_angle)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Pose3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=q,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=lin<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;from_vector_vw_order(vec:&nbsp;numpy.ndarray)&nbsp;-&gt;&nbsp;&quot;Screw3&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;a&nbsp;Screw3&nbsp;from&nbsp;a&nbsp;6x1&nbsp;array&nbsp;in&nbsp;[vx,&nbsp;vy,&nbsp;vz,&nbsp;wx,&nbsp;wy,&nbsp;wz]&nbsp;order.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;vec.shape&nbsp;!=&nbsp;(6,):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;Exception(&quot;Input&nbsp;vector&nbsp;must&nbsp;be&nbsp;of&nbsp;shape&nbsp;(6,)&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=vec[3:6],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=vec[0:3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;from_vector_wv_order(vec:&nbsp;numpy.ndarray)&nbsp;-&gt;&nbsp;&quot;Screw3&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;a&nbsp;Screw3&nbsp;from&nbsp;a&nbsp;6x1&nbsp;array&nbsp;in&nbsp;[wx,&nbsp;wy,&nbsp;wz,&nbsp;vx,&nbsp;vy,&nbsp;vz]&nbsp;order.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;vec.shape&nbsp;!=&nbsp;(6,):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;Exception(&quot;Input&nbsp;vector&nbsp;must&nbsp;be&nbsp;of&nbsp;shape&nbsp;(6,)&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Screw3(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ang=vec[0:3],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lin=vec[3:6]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;to_vector_vw_order(self)&nbsp;-&gt;&nbsp;numpy.ndarray:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Return&nbsp;the&nbsp;screw&nbsp;as&nbsp;a&nbsp;6x1&nbsp;array&nbsp;in&nbsp;[vx,&nbsp;vy,&nbsp;vz,&nbsp;wx,&nbsp;wy,&nbsp;wz]&nbsp;order.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;numpy.array([self.lin[0],&nbsp;self.lin[1],&nbsp;self.lin[2],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.ang[0],&nbsp;self.ang[1],&nbsp;self.ang[2]],&nbsp;float)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;to_vector_wv_order(self)&nbsp;-&gt;&nbsp;numpy.ndarray:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Return&nbsp;the&nbsp;screw&nbsp;as&nbsp;a&nbsp;6x1&nbsp;array&nbsp;in&nbsp;[wx,&nbsp;wy,&nbsp;wz,&nbsp;vx,&nbsp;vy,&nbsp;vz]&nbsp;order.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;numpy.array([self.ang[0],&nbsp;self.ang[1],&nbsp;self.ang[2],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.lin[0],&nbsp;self.lin[1],&nbsp;self.lin[2]],&nbsp;float)<br>
<!-- END SCAT CODE -->
</body>
</html>
