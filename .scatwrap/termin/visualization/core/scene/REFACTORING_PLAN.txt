<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/visualization/core/scene/REFACTORING_PLAN.txt</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
Scene&nbsp;Refactoring&nbsp;Plan<br>
======================<br>
<br>
Completed:<br>
----------<br>
1.&nbsp;[DONE]&nbsp;Created&nbsp;scene/&nbsp;directory&nbsp;structure<br>
2.&nbsp;[DONE]&nbsp;Extracted&nbsp;SkyboxManager&nbsp;into&nbsp;skybox.py<br>
3.&nbsp;[DONE]&nbsp;Extracted&nbsp;LightingManager&nbsp;into&nbsp;lighting.py<br>
4.&nbsp;[DONE]&nbsp;Scene&nbsp;delegates&nbsp;to&nbsp;managers&nbsp;via&nbsp;properties&nbsp;for&nbsp;backward&nbsp;compatibility<br>
<br>
Remaining&nbsp;refactoring&nbsp;opportunities:<br>
------------------------------------<br>
<br>
1.&nbsp;RAYCAST&nbsp;SYSTEM&nbsp;(High&nbsp;priority)<br>
<br>
&nbsp;&nbsp;&nbsp;Current&nbsp;state:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;raycast()&nbsp;and&nbsp;closest_to_ray()&nbsp;methods&nbsp;directly&nbsp;iterate&nbsp;over&nbsp;self.colliders<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Tightly&nbsp;coupled&nbsp;to&nbsp;ColliderComponent<br>
<br>
&nbsp;&nbsp;&nbsp;Proposal:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Extract&nbsp;into&nbsp;RaycastSystem&nbsp;class&nbsp;in&nbsp;scene/raycast.py<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Could&nbsp;implement&nbsp;spatial&nbsp;partitioning&nbsp;(octree/BVH)&nbsp;for&nbsp;large&nbsp;scenes<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Scene&nbsp;delegates&nbsp;via&nbsp;self._raycast&nbsp;=&nbsp;RaycastSystem()<br>
<br>
&nbsp;&nbsp;&nbsp;Benefits:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Better&nbsp;separation&nbsp;of&nbsp;concerns<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Easier&nbsp;to&nbsp;optimize&nbsp;with&nbsp;spatial&nbsp;acceleration&nbsp;structures<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Testable&nbsp;in&nbsp;isolation<br>
<br>
2.&nbsp;ENTITY&nbsp;MANAGEMENT&nbsp;(Medium&nbsp;priority)<br>
<br>
&nbsp;&nbsp;&nbsp;Current&nbsp;state:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;add(),&nbsp;add_non_recurse(),&nbsp;remove()&nbsp;methods&nbsp;in&nbsp;Scene<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Priority-sorted&nbsp;insertion&nbsp;logic<br>
<br>
&nbsp;&nbsp;&nbsp;Proposal:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Extract&nbsp;into&nbsp;EntityRegistry&nbsp;class&nbsp;in&nbsp;scene/entity_registry.py<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Handle&nbsp;entity&nbsp;lifecycle,&nbsp;sorting,&nbsp;parent-child&nbsp;relations<br>
<br>
&nbsp;&nbsp;&nbsp;Benefits:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Scene&nbsp;becomes&nbsp;thinner&nbsp;coordinator<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Clear&nbsp;entity&nbsp;lifecycle&nbsp;management<br>
<br>
3.&nbsp;COMPONENT&nbsp;REGISTRATION&nbsp;(Medium&nbsp;priority)<br>
<br>
&nbsp;&nbsp;&nbsp;Current&nbsp;state:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;register_component()&nbsp;/&nbsp;unregister_component()&nbsp;with&nbsp;multiple&nbsp;isinstance&nbsp;checks<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Manual&nbsp;management&nbsp;of&nbsp;colliders,&nbsp;light_components,&nbsp;input_components,&nbsp;update_list<br>
<br>
&nbsp;&nbsp;&nbsp;Proposal:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Use&nbsp;observer/event&nbsp;pattern&nbsp;instead&nbsp;of&nbsp;isinstance&nbsp;checks<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Components&nbsp;register&nbsp;themselves&nbsp;via&nbsp;scene.register(self,&nbsp;capabilities=[...])<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Or&nbsp;use&nbsp;component&nbsp;type&nbsp;registry&nbsp;with&nbsp;auto-dispatch<br>
<br>
&nbsp;&nbsp;&nbsp;Benefits:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Adding&nbsp;new&nbsp;component&nbsp;types&nbsp;doesn't&nbsp;require&nbsp;modifying&nbsp;Scene<br>
&nbsp;&nbsp;&nbsp;-&nbsp;More&nbsp;extensible&nbsp;architecture<br>
<br>
4.&nbsp;UPDATE&nbsp;LOOP&nbsp;(Low&nbsp;priority)<br>
<br>
&nbsp;&nbsp;&nbsp;Current&nbsp;state:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;update()&nbsp;handles&nbsp;pending&nbsp;start()&nbsp;calls&nbsp;and&nbsp;iterates&nbsp;update_list<br>
<br>
&nbsp;&nbsp;&nbsp;Proposal:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Consider&nbsp;extracting&nbsp;into&nbsp;UpdateScheduler&nbsp;if&nbsp;more&nbsp;complex&nbsp;scheduling&nbsp;needed<br>
&nbsp;&nbsp;&nbsp;-&nbsp;For&nbsp;now,&nbsp;current&nbsp;implementation&nbsp;is&nbsp;simple&nbsp;and&nbsp;sufficient<br>
<br>
&nbsp;&nbsp;&nbsp;Notes:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Only&nbsp;extract&nbsp;if&nbsp;update&nbsp;ordering&nbsp;or&nbsp;priorities&nbsp;become&nbsp;complex<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Current&nbsp;implementation&nbsp;is&nbsp;clean&nbsp;enough<br>
<br>
5.&nbsp;INPUT&nbsp;DISPATCH&nbsp;(Low&nbsp;priority)<br>
<br>
&nbsp;&nbsp;&nbsp;Current&nbsp;state:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;dispatch_input()&nbsp;iterates&nbsp;_input_components<br>
<br>
&nbsp;&nbsp;&nbsp;Proposal:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Could&nbsp;extract&nbsp;into&nbsp;InputDispatcher&nbsp;if&nbsp;event&nbsp;routing&nbsp;becomes&nbsp;complex<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Current&nbsp;implementation&nbsp;is&nbsp;minimal&nbsp;and&nbsp;works<br>
<br>
&nbsp;&nbsp;&nbsp;Notes:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Leave&nbsp;as-is&nbsp;unless&nbsp;input&nbsp;handling&nbsp;grows&nbsp;significantly<br>
<br>
6.&nbsp;SERIALIZATION&nbsp;(Low&nbsp;priority)<br>
<br>
&nbsp;&nbsp;&nbsp;Current&nbsp;state:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;serialize()&nbsp;/&nbsp;deserialize()&nbsp;/&nbsp;load_from_data()&nbsp;in&nbsp;Scene<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Delegates&nbsp;to&nbsp;manager&nbsp;serialize/load_from_data<br>
<br>
&nbsp;&nbsp;&nbsp;Proposal:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Could&nbsp;extract&nbsp;into&nbsp;SceneSerializer&nbsp;for&nbsp;complex&nbsp;serialization&nbsp;needs<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Current&nbsp;delegation&nbsp;pattern&nbsp;is&nbsp;clean<br>
<br>
&nbsp;&nbsp;&nbsp;Notes:<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Already&nbsp;improved&nbsp;by&nbsp;delegating&nbsp;to&nbsp;SkyboxManager&nbsp;and&nbsp;LightingManager<br>
&nbsp;&nbsp;&nbsp;-&nbsp;Leave&nbsp;as-is&nbsp;unless&nbsp;format&nbsp;changes&nbsp;become&nbsp;frequent<br>
<br>
Architecture&nbsp;notes:<br>
-------------------<br>
Current&nbsp;refactoring&nbsp;follows&nbsp;&quot;composition&nbsp;over&nbsp;inheritance&quot;:<br>
-&nbsp;Scene&nbsp;is&nbsp;now&nbsp;a&nbsp;coordinator/facade&nbsp;that&nbsp;delegates&nbsp;to&nbsp;specialized&nbsp;managers<br>
-&nbsp;SkyboxManager&nbsp;and&nbsp;LightingManager&nbsp;are&nbsp;self-contained<br>
-&nbsp;Properties&nbsp;provide&nbsp;backward&nbsp;compatibility&nbsp;-&nbsp;existing&nbsp;code&nbsp;doesn't&nbsp;need&nbsp;changes<br>
-&nbsp;Future&nbsp;managers&nbsp;(RaycastSystem,&nbsp;EntityRegistry)&nbsp;should&nbsp;follow&nbsp;same&nbsp;pattern<br>
<br>
File&nbsp;structure:<br>
---------------<br>
scene/<br>
├──&nbsp;__init__.py&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Re-exports&nbsp;Scene,&nbsp;SkyboxManager,&nbsp;LightingManager<br>
├──&nbsp;_scene.py&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Main&nbsp;Scene&nbsp;class&nbsp;(coordinator)<br>
├──&nbsp;skybox.py&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;SkyboxManager<br>
├──&nbsp;lighting.py&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;LightingManager<br>
├──&nbsp;REFACTORING_PLAN.txt<br>
│<br>
│&nbsp;Future&nbsp;files&nbsp;(when&nbsp;implemented):<br>
├──&nbsp;raycast.py&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RaycastSystem&nbsp;(proposed)<br>
└──&nbsp;entity_registry.py&nbsp;&nbsp;#&nbsp;EntityRegistry&nbsp;(proposed)<br>
<!-- END SCAT CODE -->
</body>
</html>
