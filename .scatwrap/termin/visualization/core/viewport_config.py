<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/visualization/core/viewport_config.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
&quot;&quot;&quot;ViewportConfig&nbsp;-&nbsp;configuration&nbsp;for&nbsp;scene&nbsp;viewport&nbsp;mounting.&quot;&quot;&quot;<br>
<br>
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
<br>
from&nbsp;typing&nbsp;import&nbsp;Tuple<br>
<br>
#&nbsp;Re-export&nbsp;C++&nbsp;class<br>
from&nbsp;termin._native.scene&nbsp;import&nbsp;ViewportConfig<br>
<br>
__all__&nbsp;=&nbsp;[&quot;ViewportConfig&quot;,&nbsp;&quot;serialize_viewport_config&quot;,&nbsp;&quot;deserialize_viewport_config&quot;]<br>
<br>
<br>
def&nbsp;serialize_viewport_config(config:&nbsp;ViewportConfig)&nbsp;-&gt;&nbsp;dict:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Serialize&nbsp;ViewportConfig&nbsp;to&nbsp;dict.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;name&quot;:&nbsp;config.name,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;display_name&quot;:&nbsp;config.display_name,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;camera_uuid&quot;:&nbsp;config.camera_uuid,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;region&quot;:&nbsp;[config.region_x,&nbsp;config.region_y,&nbsp;config.region_w,&nbsp;config.region_h],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;depth&quot;:&nbsp;config.depth,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;input_mode&quot;:&nbsp;config.input_mode,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;block_input_in_editor&quot;:&nbsp;config.block_input_in_editor,<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;config.pipeline_uuid:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result[&quot;pipeline_uuid&quot;]&nbsp;=&nbsp;config.pipeline_uuid<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;config.pipeline_name:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result[&quot;pipeline_name&quot;]&nbsp;=&nbsp;config.pipeline_name<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Only&nbsp;serialize&nbsp;layer_mask&nbsp;if&nbsp;not&nbsp;all&nbsp;layers<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;config.layer_mask&nbsp;!=&nbsp;0xFFFFFFFFFFFFFFFF:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result[&quot;layer_mask&quot;]&nbsp;=&nbsp;hex(config.layer_mask)<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Only&nbsp;serialize&nbsp;enabled&nbsp;if&nbsp;False&nbsp;(to&nbsp;keep&nbsp;files&nbsp;clean)<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;config.enabled:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result[&quot;enabled&quot;]&nbsp;=&nbsp;config.enabled<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;result<br>
<br>
<br>
def&nbsp;deserialize_viewport_config(data:&nbsp;dict)&nbsp;-&gt;&nbsp;ViewportConfig:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Deserialize&nbsp;ViewportConfig&nbsp;from&nbsp;dict.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;region&nbsp;=&nbsp;data.get(&quot;region&quot;,&nbsp;[0.0,&nbsp;0.0,&nbsp;1.0,&nbsp;1.0])<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;pipeline_uuid&nbsp;=&nbsp;data.get(&quot;pipeline_uuid&quot;,&nbsp;&quot;&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;pipeline_name&nbsp;=&nbsp;data.get(&quot;pipeline_name&quot;,&nbsp;&quot;&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Backwards&nbsp;compatibility:&nbsp;convert&nbsp;old&nbsp;pipeline_name&nbsp;(asset&nbsp;name)&nbsp;to&nbsp;uuid<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;But&nbsp;preserve&nbsp;special&nbsp;names&nbsp;like&nbsp;&quot;(Editor)&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;pipeline_uuid&nbsp;and&nbsp;pipeline_name&nbsp;and&nbsp;not&nbsp;pipeline_name.startswith(&quot;(&quot;):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipeline_uuid&nbsp;=&nbsp;_get_pipeline_uuid_by_name(pipeline_name)&nbsp;or&nbsp;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipeline_name&nbsp;=&nbsp;&quot;&quot;&nbsp;&nbsp;#&nbsp;Clear&nbsp;old-style&nbsp;name&nbsp;after&nbsp;conversion<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Parse&nbsp;layer_mask&nbsp;(may&nbsp;be&nbsp;hex&nbsp;string&nbsp;or&nbsp;int)<br>
&nbsp;&nbsp;&nbsp;&nbsp;layer_mask_raw&nbsp;=&nbsp;data.get(&quot;layer_mask&quot;,&nbsp;0xFFFFFFFFFFFFFFFF)<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;isinstance(layer_mask_raw,&nbsp;str):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;layer_mask&nbsp;=&nbsp;int(layer_mask_raw,&nbsp;16)&nbsp;if&nbsp;layer_mask_raw.startswith(&quot;0x&quot;)&nbsp;else&nbsp;int(layer_mask_raw)<br>
&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;layer_mask&nbsp;=&nbsp;int(layer_mask_raw)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ViewportConfig(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=data.get(&quot;name&quot;,&nbsp;&quot;&quot;),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;display_name=data.get(&quot;display_name&quot;,&nbsp;&quot;Main&quot;),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;camera_uuid=data.get(&quot;camera_uuid&quot;,&nbsp;&quot;&quot;),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;region_x=float(region[0]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;region_y=float(region[1]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;region_w=float(region[2]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;region_h=float(region[3]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipeline_uuid=pipeline_uuid,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipeline_name=pipeline_name,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;depth=data.get(&quot;depth&quot;,&nbsp;0),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_mode=data.get(&quot;input_mode&quot;,&nbsp;&quot;simple&quot;),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;block_input_in_editor=data.get(&quot;block_input_in_editor&quot;,&nbsp;False),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;layer_mask=layer_mask,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enabled=data.get(&quot;enabled&quot;,&nbsp;True),<br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
<br>
def&nbsp;_get_pipeline_uuid_by_name(name:&nbsp;str)&nbsp;-&gt;&nbsp;str&nbsp;|&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Helper&nbsp;for&nbsp;backwards&nbsp;compatibility:&nbsp;get&nbsp;pipeline&nbsp;UUID&nbsp;by&nbsp;name.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;try:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.assets.resources&nbsp;import&nbsp;ResourceManager<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rm&nbsp;=&nbsp;ResourceManager.instance()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;asset&nbsp;=&nbsp;rm.get_pipeline_asset(name)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;asset&nbsp;is&nbsp;not&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;asset.uuid<br>
&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;Exception:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;None<br>
<!-- END SCAT CODE -->
</body>
</html>
