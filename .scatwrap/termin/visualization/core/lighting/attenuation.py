<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/visualization/core/lighting/attenuation.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
&quot;&quot;&quot;Классические&nbsp;кривые&nbsp;затухания&nbsp;для&nbsp;точечных&nbsp;и&nbsp;прожекторных&nbsp;источников.&quot;&quot;&quot;<br>
<br>
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
<br>
from&nbsp;dataclasses&nbsp;import&nbsp;dataclass<br>
<br>
<br>
@dataclass<br>
class&nbsp;AttenuationCoefficients:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Параметры&nbsp;полиномиального&nbsp;затухания&nbsp;``w(d)&nbsp;=&nbsp;1&nbsp;/&nbsp;(k_c&nbsp;+&nbsp;k_l&nbsp;d&nbsp;+&nbsp;k_q&nbsp;d^2)``.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Формула&nbsp;—&nbsp;классическая&nbsp;модель&nbsp;в&nbsp;стиле&nbsp;OpenGL.&nbsp;Для&nbsp;физически&nbsp;корректного<br>
&nbsp;&nbsp;&nbsp;&nbsp;обратного&nbsp;квадрата&nbsp;задаём&nbsp;``k_c&nbsp;=&nbsp;k_l&nbsp;=&nbsp;0``&nbsp;и&nbsp;``k_q&nbsp;=&nbsp;1``,&nbsp;тогда<br>
&nbsp;&nbsp;&nbsp;&nbsp;``w(d)&nbsp;=&nbsp;1&nbsp;/&nbsp;d^2``.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;constant:&nbsp;float&nbsp;=&nbsp;1.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;linear:&nbsp;float&nbsp;=&nbsp;0.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;quadratic:&nbsp;float&nbsp;=&nbsp;0.0<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;evaluate(self,&nbsp;distance:&nbsp;float)&nbsp;-&gt;&nbsp;float:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Вычислить&nbsp;вес&nbsp;затухания&nbsp;для&nbsp;заданной&nbsp;дистанции.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;=&nbsp;max(distance,&nbsp;0.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;denom&nbsp;=&nbsp;self.constant&nbsp;+&nbsp;self.linear&nbsp;*&nbsp;d&nbsp;+&nbsp;self.quadratic&nbsp;*&nbsp;d&nbsp;*&nbsp;d<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;denom&nbsp;&lt;=&nbsp;0.0:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1.0&nbsp;/&nbsp;denom<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;@classmethod<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;match_range(cls,&nbsp;falloff_range:&nbsp;float,&nbsp;cutoff:&nbsp;float&nbsp;=&nbsp;0.01)&nbsp;-&gt;&nbsp;&quot;AttenuationCoefficients&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Подобрать&nbsp;квадратичный&nbsp;коэффициент,&nbsp;чтобы&nbsp;``w(r)&nbsp;=&nbsp;cutoff``&nbsp;на&nbsp;дистанции&nbsp;``r``.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;При&nbsp;``k_c&nbsp;=&nbsp;1``&nbsp;и&nbsp;``k_l&nbsp;=&nbsp;0``&nbsp;уравнение<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;``cutoff&nbsp;=&nbsp;1&nbsp;/&nbsp;(1&nbsp;+&nbsp;k_q&nbsp;r^2)``&nbsp;даёт<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;``k_q&nbsp;=&nbsp;(1&nbsp;/&nbsp;cutoff&nbsp;-&nbsp;1)&nbsp;/&nbsp;r^2``.&nbsp;Удобно&nbsp;для&nbsp;«range»&nbsp;слайдеров.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;max(falloff_range,&nbsp;1e-6)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k_q&nbsp;=&nbsp;(1.0&nbsp;/&nbsp;cutoff&nbsp;-&nbsp;1.0)&nbsp;/&nbsp;(r&nbsp;*&nbsp;r)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;cls(constant=1.0,&nbsp;linear=0.0,&nbsp;quadratic=k_q)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;@classmethod<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;inverse_square(cls)&nbsp;-&gt;&nbsp;&quot;AttenuationCoefficients&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Физическое&nbsp;затухание&nbsp;``w(d)&nbsp;=&nbsp;1&nbsp;/&nbsp;d^2``.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;cls(constant=0.0,&nbsp;linear=0.0,&nbsp;quadratic=1.0)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;clamp_range(self,&nbsp;max_range:&nbsp;float,&nbsp;cutoff:&nbsp;float&nbsp;=&nbsp;0.01)&nbsp;-&gt;&nbsp;&quot;AttenuationCoefficients&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Вернуть&nbsp;коэффициенты,&nbsp;затухающие&nbsp;до&nbsp;``cutoff``&nbsp;на&nbsp;дистанции&nbsp;``max_range``.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.match_range(max_range,&nbsp;cutoff=cutoff)<br>
<!-- END SCAT CODE -->
</body>
</html>
