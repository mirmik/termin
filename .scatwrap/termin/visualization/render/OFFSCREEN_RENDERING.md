<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/visualization/render/OFFSCREEN_RENDERING.md</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#&nbsp;Offscreen-First&nbsp;Rendering&nbsp;Architecture<br>
<br>
##&nbsp;Overview<br>
<br>
The&nbsp;offscreen-first&nbsp;rendering&nbsp;model&nbsp;separates&nbsp;rendering&nbsp;into&nbsp;two&nbsp;phases:<br>
1.&nbsp;**Render&nbsp;Phase**:&nbsp;All&nbsp;viewports&nbsp;render&nbsp;to&nbsp;their&nbsp;`output_fbo`&nbsp;in&nbsp;a&nbsp;single&nbsp;GL&nbsp;context<br>
2.&nbsp;**Present&nbsp;Phase**:&nbsp;Output&nbsp;FBOs&nbsp;are&nbsp;blitted&nbsp;to&nbsp;displays&nbsp;and&nbsp;swapped<br>
<br>
##&nbsp;Benefits<br>
<br>
-&nbsp;Scene&nbsp;pipelines&nbsp;can&nbsp;span&nbsp;viewports&nbsp;on&nbsp;different&nbsp;displays<br>
-&nbsp;All&nbsp;GPU&nbsp;resources&nbsp;live&nbsp;in&nbsp;one&nbsp;context&nbsp;(no&nbsp;context_key&nbsp;complexity)<br>
-&nbsp;Displays&nbsp;are&nbsp;independent&nbsp;and&nbsp;symmetrical<br>
-&nbsp;Natural&nbsp;support&nbsp;for&nbsp;RenderTextures&nbsp;(every&nbsp;viewport&nbsp;has&nbsp;an&nbsp;output_fbo)<br>
-&nbsp;Easy&nbsp;to&nbsp;add:&nbsp;viewport-in-viewport,&nbsp;screenshots,&nbsp;headless&nbsp;rendering<br>
<br>
##&nbsp;Integration<br>
<br>
###&nbsp;Step&nbsp;1:&nbsp;Initialize&nbsp;RenderingManager<br>
<br>
```python<br>
from&nbsp;termin.visualization.render&nbsp;import&nbsp;RenderingManager<br>
<br>
#&nbsp;At&nbsp;application&nbsp;startup&nbsp;(before&nbsp;creating&nbsp;displays)<br>
manager&nbsp;=&nbsp;RenderingManager.instance()<br>
manager.initialize()&nbsp;&nbsp;#&nbsp;Creates&nbsp;OffscreenContext<br>
```<br>
<br>
###&nbsp;Step&nbsp;2:&nbsp;Configure&nbsp;SDLEmbeddedWindowBackend<br>
<br>
```python<br>
from&nbsp;termin.visualization.platform.backends.sdl_embedded&nbsp;import&nbsp;SDLEmbeddedWindowBackend<br>
<br>
#&nbsp;Create&nbsp;backend&nbsp;with&nbsp;shared&nbsp;context<br>
sdl_backend&nbsp;=&nbsp;SDLEmbeddedWindowBackend()<br>
sdl_backend.set_share_context(<br>
&nbsp;&nbsp;&nbsp;&nbsp;share_context=manager.offscreen_context.gl_context,<br>
&nbsp;&nbsp;&nbsp;&nbsp;make_current_fn=manager.offscreen_context.make_current,<br>
)<br>
sdl_backend.set_graphics(manager.graphics)<br>
```<br>
<br>
###&nbsp;Step&nbsp;3:&nbsp;Rendering&nbsp;Loop<br>
<br>
```python<br>
#&nbsp;In&nbsp;your&nbsp;render&nbsp;loop&nbsp;(e.g.,&nbsp;EditorWindow&nbsp;or&nbsp;game&nbsp;loop)<br>
def&nbsp;render_frame():<br>
&nbsp;&nbsp;&nbsp;&nbsp;manager&nbsp;=&nbsp;RenderingManager.instance()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;automatically&nbsp;uses&nbsp;offscreen&nbsp;rendering&nbsp;if&nbsp;initialize()&nbsp;was&nbsp;called<br>
&nbsp;&nbsp;&nbsp;&nbsp;manager.render_all()&nbsp;&nbsp;#&nbsp;render_all_offscreen()&nbsp;+&nbsp;present_all()<br>
```<br>
<br>
Or&nbsp;manually&nbsp;control&nbsp;the&nbsp;phases:<br>
<br>
```python<br>
def&nbsp;render_frame():<br>
&nbsp;&nbsp;&nbsp;&nbsp;manager&nbsp;=&nbsp;RenderingManager.instance()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Phase&nbsp;1:&nbsp;Render&nbsp;all&nbsp;viewports&nbsp;to&nbsp;output_fbos<br>
&nbsp;&nbsp;&nbsp;&nbsp;manager.render_all_offscreen()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Phase&nbsp;2:&nbsp;Blit&nbsp;to&nbsp;displays<br>
&nbsp;&nbsp;&nbsp;&nbsp;manager.present_all()<br>
```<br>
<br>
##&nbsp;Architecture&nbsp;Details<br>
<br>
###&nbsp;OffscreenContext<br>
<br>
Dedicated&nbsp;GL&nbsp;context&nbsp;for&nbsp;rendering.&nbsp;All&nbsp;GPU&nbsp;resources&nbsp;live&nbsp;here.<br>
<br>
```<br>
OffscreenContext<br>
├──&nbsp;gl_context:&nbsp;SDL&nbsp;GL&nbsp;context&nbsp;(hidden&nbsp;window)<br>
├──&nbsp;graphics:&nbsp;GraphicsBackend&nbsp;(OpenGL)<br>
└──&nbsp;context_key:&nbsp;0&nbsp;(constant,&nbsp;single&nbsp;context)<br>
```<br>
<br>
###&nbsp;ViewportRenderState<br>
<br>
Now&nbsp;includes&nbsp;`output_fbo`&nbsp;for&nbsp;final&nbsp;render&nbsp;result:<br>
<br>
```python<br>
@dataclass<br>
class&nbsp;ViewportRenderState:<br>
&nbsp;&nbsp;&nbsp;&nbsp;fbos:&nbsp;Dict[str,&nbsp;FramebufferHandle]&nbsp;&nbsp;#&nbsp;Intermediate&nbsp;FBOs<br>
&nbsp;&nbsp;&nbsp;&nbsp;shadow_map_arrays:&nbsp;Dict[str,&nbsp;ShadowMapArrayResource]<br>
&nbsp;&nbsp;&nbsp;&nbsp;output_fbo:&nbsp;Optional[FramebufferHandle]&nbsp;=&nbsp;None&nbsp;&nbsp;#&nbsp;Final&nbsp;result<br>
```<br>
<br>
###&nbsp;Render&nbsp;Flow<br>
<br>
```<br>
┌─────────────────────────────────────────────────────────────┐<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RENDER&nbsp;PHASE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;(OffscreenContext,&nbsp;single&nbsp;GL&nbsp;context)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
├─────────────────────────────────────────────────────────────┤<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;render_all_offscreen()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offscreen_context.make_current()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Scene&nbsp;pipelines&nbsp;(can&nbsp;span&nbsp;multiple&nbsp;displays)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;pipeline&nbsp;in&nbsp;scene_pipelines:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;viewport_contexts&nbsp;=&nbsp;collect_from_ALL_displays()&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;render_scene_pipeline_offscreen(...)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Unmanaged&nbsp;viewports&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;viewport&nbsp;in&nbsp;unmanaged_viewports:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;render_viewport_offscreen(viewport)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;Result:&nbsp;viewport.state.output_fbo&nbsp;contains&nbsp;rendered&nbsp;image&nbsp;&nbsp;│<br>
└─────────────────────────────────────────────────────────────┘<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;▼<br>
┌─────────────────────────────────────────────────────────────┐<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRESENT&nbsp;PHASE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(per-display,&nbsp;blit&nbsp;+&nbsp;swap)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
├─────────────────────────────────────────────────────────────┤<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;present_all()&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;display&nbsp;in&nbsp;displays:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;display.surface.make_current()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear(display_fbo)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;viewport&nbsp;in&nbsp;sorted_by_depth(display):&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blit(viewport.output_fbo&nbsp;→&nbsp;display_fbo,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;viewport.rect)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;display.surface.present()&nbsp;&nbsp;//&nbsp;swap&nbsp;buffers&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
│&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<br>
└─────────────────────────────────────────────────────────────┘<br>
```<br>
<br>
##&nbsp;Backwards&nbsp;Compatibility<br>
<br>
The&nbsp;system&nbsp;supports&nbsp;legacy&nbsp;per-display&nbsp;rendering:<br>
<br>
-&nbsp;If&nbsp;`manager.initialize()`&nbsp;is&nbsp;NOT&nbsp;called,&nbsp;`render_all()`&nbsp;uses&nbsp;legacy&nbsp;mode<br>
-&nbsp;Legacy&nbsp;mode:&nbsp;each&nbsp;display&nbsp;rendered&nbsp;separately&nbsp;with&nbsp;context&nbsp;switching<br>
-&nbsp;`_use_offscreen_rendering`&nbsp;flag&nbsp;controls&nbsp;which&nbsp;mode&nbsp;is&nbsp;used<br>
<br>
##&nbsp;Migration&nbsp;Path<br>
<br>
1.&nbsp;Call&nbsp;`manager.initialize()`&nbsp;at&nbsp;startup<br>
2.&nbsp;Configure&nbsp;SDLEmbeddedWindowBackend&nbsp;with&nbsp;shared&nbsp;context<br>
3.&nbsp;Existing&nbsp;code&nbsp;continues&nbsp;to&nbsp;work&nbsp;(render_all&nbsp;handles&nbsp;mode&nbsp;selection)<br>
4.&nbsp;Remove&nbsp;context_key&nbsp;usage&nbsp;over&nbsp;time&nbsp;(all&nbsp;resources&nbsp;use&nbsp;constant&nbsp;key&nbsp;0)<br>
<!-- END SCAT CODE -->
</body>
</html>
