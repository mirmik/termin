<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/visualization/render/materials/depth_material.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
<br>
from&nbsp;termin.visualization.core.material&nbsp;import&nbsp;Material<br>
from&nbsp;termin.visualization.render.shader&nbsp;import&nbsp;ShaderProgram<br>
<br>
DEPTH_VERT&nbsp;=&nbsp;&quot;&quot;&quot;<br>
#version&nbsp;330&nbsp;core<br>
<br>
layout(location&nbsp;=&nbsp;0)&nbsp;in&nbsp;vec3&nbsp;a_position;<br>
layout(location&nbsp;=&nbsp;1)&nbsp;in&nbsp;vec3&nbsp;a_normal;<br>
layout(location&nbsp;=&nbsp;2)&nbsp;in&nbsp;vec2&nbsp;a_texcoord;<br>
<br>
uniform&nbsp;mat4&nbsp;u_model;<br>
uniform&nbsp;mat4&nbsp;u_view;<br>
uniform&nbsp;mat4&nbsp;u_projection;<br>
<br>
uniform&nbsp;float&nbsp;u_near;<br>
uniform&nbsp;float&nbsp;u_far;<br>
<br>
out&nbsp;float&nbsp;v_linear_depth;<br>
<br>
void&nbsp;main()<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;world_pos&nbsp;=&nbsp;u_model&nbsp;*&nbsp;vec4(a_position,&nbsp;1.0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;view_pos&nbsp;&nbsp;=&nbsp;u_view&nbsp;*&nbsp;world_pos;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;z&nbsp;в&nbsp;системе&nbsp;камеры&nbsp;(камера&nbsp;смотрит&nbsp;вдоль&nbsp;-Z)<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;z&nbsp;=&nbsp;-view_pos.z;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;depth&nbsp;=&nbsp;(z&nbsp;-&nbsp;u_near)&nbsp;/&nbsp;(u_far&nbsp;-&nbsp;u_near);<br>
&nbsp;&nbsp;&nbsp;&nbsp;depth&nbsp;=&nbsp;clamp(depth,&nbsp;0.0,&nbsp;1.0);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;v_linear_depth&nbsp;=&nbsp;depth;<br>
&nbsp;&nbsp;&nbsp;&nbsp;gl_Position&nbsp;=&nbsp;u_projection&nbsp;*&nbsp;view_pos;<br>
}<br>
&quot;&quot;&quot;<br>
<br>
DEPTH_FRAG&nbsp;=&nbsp;&quot;&quot;&quot;<br>
#version&nbsp;330&nbsp;core<br>
<br>
in&nbsp;float&nbsp;v_linear_depth;<br>
out&nbsp;vec4&nbsp;FragColor;<br>
<br>
void&nbsp;main()<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;d&nbsp;=&nbsp;clamp(v_linear_depth,&nbsp;0.0,&nbsp;1.0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;FragColor&nbsp;=&nbsp;vec4(d,&nbsp;d,&nbsp;d,&nbsp;1.0);<br>
}<br>
&quot;&quot;&quot;<br>
<br>
<br>
class&nbsp;DepthMaterial(Material):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Простой&nbsp;материал,&nbsp;который&nbsp;пишет&nbsp;линейную&nbsp;глубину&nbsp;в&nbsp;канал&nbsp;цвета.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shader&nbsp;=&nbsp;ShaderProgram(DEPTH_VERT,&nbsp;DEPTH_FRAG)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super().__init__(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shader=shader,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uniforms={<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;u_near&quot;:&nbsp;0.1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;u_far&quot;:&nbsp;100.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;update_camera_planes(self,&nbsp;near_plane:&nbsp;float,&nbsp;far_plane:&nbsp;float):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.uniforms[&quot;u_near&quot;]&nbsp;=&nbsp;float(near_plane)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.uniforms[&quot;u_far&quot;]&nbsp;=&nbsp;float(far_plane)<br>
<!-- END SCAT CODE -->
</body>
</html>
