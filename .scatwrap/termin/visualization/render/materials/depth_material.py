<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/visualization/render/materials/depth_material.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
<br>
from&nbsp;termin._native.render&nbsp;import&nbsp;TcMaterial,&nbsp;TcRenderState<br>
<br>
DEPTH_VERT&nbsp;=&nbsp;&quot;&quot;&quot;<br>
#version&nbsp;330&nbsp;core<br>
<br>
layout(location&nbsp;=&nbsp;0)&nbsp;in&nbsp;vec3&nbsp;a_position;<br>
layout(location&nbsp;=&nbsp;1)&nbsp;in&nbsp;vec3&nbsp;a_normal;<br>
layout(location&nbsp;=&nbsp;2)&nbsp;in&nbsp;vec2&nbsp;a_texcoord;<br>
<br>
uniform&nbsp;mat4&nbsp;u_model;<br>
uniform&nbsp;mat4&nbsp;u_view;<br>
uniform&nbsp;mat4&nbsp;u_projection;<br>
uniform&nbsp;float&nbsp;u_near;<br>
uniform&nbsp;float&nbsp;u_far;<br>
<br>
out&nbsp;float&nbsp;v_linear_depth;<br>
<br>
void&nbsp;main()<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;world_pos&nbsp;=&nbsp;u_model&nbsp;*&nbsp;vec4(a_position,&nbsp;1.0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;view_pos&nbsp;&nbsp;=&nbsp;u_view&nbsp;*&nbsp;world_pos;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;y&nbsp;=&nbsp;view_pos.y;&nbsp;//&nbsp;forward&nbsp;=&nbsp;+Y&nbsp;in&nbsp;view&nbsp;space<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;depth&nbsp;=&nbsp;(y&nbsp;-&nbsp;u_near)&nbsp;/&nbsp;(u_far&nbsp;-&nbsp;u_near);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;v_linear_depth&nbsp;=&nbsp;depth;<br>
&nbsp;&nbsp;&nbsp;&nbsp;gl_Position&nbsp;=&nbsp;u_projection&nbsp;*&nbsp;view_pos;<br>
}<br>
&quot;&quot;&quot;<br>
<br>
DEPTH_FRAG&nbsp;=&nbsp;&quot;&quot;&quot;<br>
#version&nbsp;330&nbsp;core<br>
<br>
in&nbsp;float&nbsp;v_linear_depth;<br>
out&nbsp;vec4&nbsp;FragColor;<br>
<br>
void&nbsp;main()<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;d&nbsp;=&nbsp;clamp(v_linear_depth,&nbsp;0.0,&nbsp;1.0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;R16F&nbsp;format&nbsp;-&nbsp;only&nbsp;red&nbsp;channel&nbsp;is&nbsp;used<br>
&nbsp;&nbsp;&nbsp;&nbsp;FragColor&nbsp;=&nbsp;vec4(d,&nbsp;0.0,&nbsp;0.0,&nbsp;1.0);<br>
}<br>
&quot;&quot;&quot;<br>
<br>
<br>
def&nbsp;create_depth_material(<br>
&nbsp;&nbsp;&nbsp;&nbsp;near:&nbsp;float&nbsp;=&nbsp;0.1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;far:&nbsp;float&nbsp;=&nbsp;100.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;str&nbsp;=&nbsp;&quot;DepthMaterial&quot;,<br>
)&nbsp;-&gt;&nbsp;TcMaterial:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;a&nbsp;depth&nbsp;material&nbsp;that&nbsp;writes&nbsp;linear&nbsp;depth&nbsp;to&nbsp;color&nbsp;channel.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;mat&nbsp;=&nbsp;TcMaterial.create(name,&nbsp;&quot;&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;mat.shader_name&nbsp;=&nbsp;&quot;DepthShader&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;state&nbsp;=&nbsp;TcRenderState.opaque()<br>
&nbsp;&nbsp;&nbsp;&nbsp;phase&nbsp;=&nbsp;mat.add_phase_from_sources(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertex_source=DEPTH_VERT,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fragment_source=DEPTH_FRAG,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;geometry_source=&quot;&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shader_name=&quot;DepthShader&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;phase_mark=&quot;depth&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;priority=0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state=state,<br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;phase&nbsp;is&nbsp;not&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;phase.set_uniform_float(&quot;u_near&quot;,&nbsp;near)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;phase.set_uniform_float(&quot;u_far&quot;,&nbsp;far)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;mat<br>
<br>
<br>
class&nbsp;DepthMaterial(TcMaterial):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Простой&nbsp;материал,&nbsp;который&nbsp;пишет&nbsp;линейную&nbsp;глубину&nbsp;в&nbsp;канал&nbsp;цвета.<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns&nbsp;TcMaterial.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__new__(cls)&nbsp;-&gt;&nbsp;TcMaterial:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;create_depth_material()<br>
<!-- END SCAT CODE -->
</body>
</html>
