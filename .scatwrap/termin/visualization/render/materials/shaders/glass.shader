<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/visualization/render/materials/shaders/glass.shader</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
@program&nbsp;Glass<br>
<br>
@phase&nbsp;opaque<br>
@priority&nbsp;0<br>
@glDepthTest&nbsp;true<br>
@glDepthMask&nbsp;true<br>
@glCull&nbsp;true<br>
@glBlend&nbsp;false<br>
<br>
@property&nbsp;Color&nbsp;u_color&nbsp;=&nbsp;Color(0.1,&nbsp;0.3,&nbsp;0.8,&nbsp;1.0)<br>
@property&nbsp;Float&nbsp;u_opacity&nbsp;=&nbsp;0.3&nbsp;range(0.0,&nbsp;1.0)<br>
<br>
@stage&nbsp;vertex<br>
#version&nbsp;330&nbsp;core<br>
<br>
layout(location&nbsp;=&nbsp;0)&nbsp;in&nbsp;vec3&nbsp;a_position;<br>
layout(location&nbsp;=&nbsp;1)&nbsp;in&nbsp;vec3&nbsp;a_normal;<br>
<br>
uniform&nbsp;mat4&nbsp;u_model;<br>
uniform&nbsp;mat4&nbsp;u_view;<br>
uniform&nbsp;mat4&nbsp;u_projection;<br>
<br>
out&nbsp;vec3&nbsp;v_normal;<br>
out&nbsp;vec3&nbsp;v_world_pos;<br>
out&nbsp;vec3&nbsp;v_view_pos;<br>
<br>
void&nbsp;main()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;world&nbsp;=&nbsp;u_model&nbsp;*&nbsp;vec4(a_position,&nbsp;1.0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;v_world_pos&nbsp;=&nbsp;world.xyz;<br>
&nbsp;&nbsp;&nbsp;&nbsp;v_normal&nbsp;=&nbsp;mat3(transpose(inverse(u_model)))&nbsp;*&nbsp;a_normal;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;view_pos&nbsp;=&nbsp;u_view&nbsp;*&nbsp;world;<br>
&nbsp;&nbsp;&nbsp;&nbsp;v_view_pos&nbsp;=&nbsp;view_pos.xyz;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;gl_Position&nbsp;=&nbsp;u_projection&nbsp;*&nbsp;view_pos;<br>
}<br>
@endstage<br>
<br>
@stage&nbsp;fragment<br>
#version&nbsp;330&nbsp;core<br>
<br>
in&nbsp;vec3&nbsp;v_normal;<br>
in&nbsp;vec3&nbsp;v_world_pos;<br>
in&nbsp;vec3&nbsp;v_view_pos;<br>
<br>
uniform&nbsp;vec4&nbsp;u_color;<br>
uniform&nbsp;float&nbsp;u_opacity;<br>
<br>
out&nbsp;vec4&nbsp;FragColor;<br>
<br>
void&nbsp;main()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;N&nbsp;=&nbsp;normalize(v_normal);<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;V&nbsp;=&nbsp;normalize(-v_view_pos);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Fresnel&nbsp;effect<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;fresnel&nbsp;=&nbsp;pow(1.0&nbsp;-&nbsp;max(dot(N,&nbsp;V),&nbsp;0.0),&nbsp;3.0);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;lightDir&nbsp;=&nbsp;normalize(vec3(1.0,&nbsp;1.0,&nbsp;1.0));<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;diffuse&nbsp;=&nbsp;max(dot(N,&nbsp;lightDir),&nbsp;0.0)&nbsp;*&nbsp;0.5&nbsp;+&nbsp;0.5;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;color&nbsp;=&nbsp;u_color.rgb&nbsp;*&nbsp;diffuse;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Opaque&nbsp;pass&nbsp;renders&nbsp;only&nbsp;where&nbsp;mostly&nbsp;opaque<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;alpha&nbsp;=&nbsp;u_opacity&nbsp;+&nbsp;fresnel&nbsp;*&nbsp;0.5;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(alpha&nbsp;&lt;&nbsp;0.9)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discard;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;FragColor&nbsp;=&nbsp;vec4(color,&nbsp;1.0);<br>
}<br>
@endstage<br>
<br>
@endphase<br>
<br>
@phase&nbsp;transparent<br>
@priority&nbsp;1000<br>
@glDepthTest&nbsp;true<br>
@glDepthMask&nbsp;false<br>
@glCull&nbsp;false<br>
@glBlend&nbsp;true<br>
<br>
@property&nbsp;Color&nbsp;u_color&nbsp;=&nbsp;Color(0.1,&nbsp;0.3,&nbsp;0.8,&nbsp;1.0)<br>
@property&nbsp;Float&nbsp;u_opacity&nbsp;=&nbsp;0.3&nbsp;range(0.0,&nbsp;1.0)<br>
<br>
@stage&nbsp;vertex<br>
#version&nbsp;330&nbsp;core<br>
<br>
layout(location&nbsp;=&nbsp;0)&nbsp;in&nbsp;vec3&nbsp;a_position;<br>
layout(location&nbsp;=&nbsp;1)&nbsp;in&nbsp;vec3&nbsp;a_normal;<br>
<br>
uniform&nbsp;mat4&nbsp;u_model;<br>
uniform&nbsp;mat4&nbsp;u_view;<br>
uniform&nbsp;mat4&nbsp;u_projection;<br>
<br>
out&nbsp;vec3&nbsp;v_normal;<br>
out&nbsp;vec3&nbsp;v_world_pos;<br>
out&nbsp;vec3&nbsp;v_view_pos;<br>
<br>
void&nbsp;main()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;world&nbsp;=&nbsp;u_model&nbsp;*&nbsp;vec4(a_position,&nbsp;1.0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;v_world_pos&nbsp;=&nbsp;world.xyz;<br>
&nbsp;&nbsp;&nbsp;&nbsp;v_normal&nbsp;=&nbsp;mat3(transpose(inverse(u_model)))&nbsp;*&nbsp;a_normal;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;view_pos&nbsp;=&nbsp;u_view&nbsp;*&nbsp;world;<br>
&nbsp;&nbsp;&nbsp;&nbsp;v_view_pos&nbsp;=&nbsp;view_pos.xyz;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;gl_Position&nbsp;=&nbsp;u_projection&nbsp;*&nbsp;view_pos;<br>
}<br>
@endstage<br>
<br>
@stage&nbsp;fragment<br>
#version&nbsp;330&nbsp;core<br>
<br>
in&nbsp;vec3&nbsp;v_normal;<br>
in&nbsp;vec3&nbsp;v_world_pos;<br>
in&nbsp;vec3&nbsp;v_view_pos;<br>
<br>
uniform&nbsp;vec4&nbsp;u_color;<br>
uniform&nbsp;float&nbsp;u_opacity;<br>
<br>
out&nbsp;vec4&nbsp;FragColor;<br>
<br>
void&nbsp;main()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;N&nbsp;=&nbsp;normalize(v_normal);<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;V&nbsp;=&nbsp;normalize(-v_view_pos);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Fresnel&nbsp;effect&nbsp;-&nbsp;more&nbsp;reflective&nbsp;at&nbsp;grazing&nbsp;angles<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;fresnel&nbsp;=&nbsp;pow(1.0&nbsp;-&nbsp;max(dot(N,&nbsp;V),&nbsp;0.0),&nbsp;3.0);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;lightDir&nbsp;=&nbsp;normalize(vec3(1.0,&nbsp;1.0,&nbsp;1.0));<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;diffuse&nbsp;=&nbsp;max(dot(N,&nbsp;lightDir),&nbsp;0.0)&nbsp;*&nbsp;0.5&nbsp;+&nbsp;0.5;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Specular&nbsp;highlight<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;H&nbsp;=&nbsp;normalize(lightDir&nbsp;+&nbsp;V);<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;spec&nbsp;=&nbsp;pow(max(dot(N,&nbsp;H),&nbsp;0.0),&nbsp;64.0);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;color&nbsp;=&nbsp;u_color.rgb&nbsp;*&nbsp;diffuse&nbsp;+&nbsp;vec3(1.0)&nbsp;*&nbsp;spec&nbsp;*&nbsp;0.5;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;alpha&nbsp;=&nbsp;u_opacity&nbsp;+&nbsp;fresnel&nbsp;*&nbsp;0.5;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Transparent&nbsp;pass&nbsp;renders&nbsp;semi-transparent&nbsp;parts<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(alpha&nbsp;&gt;=&nbsp;0.9)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discard;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;FragColor&nbsp;=&nbsp;vec4(color,&nbsp;alpha);<br>
}<br>
@endstage<br>
<br>
@endphase<br>
<!-- END SCAT CODE -->
</body>
</html>
