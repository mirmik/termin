<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/visualization/render/materials/unknown_material.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
&quot;&quot;&quot;<br>
Unknown/Missing&nbsp;Material&nbsp;-&nbsp;fallback&nbsp;for&nbsp;missing&nbsp;shaders&nbsp;and&nbsp;materials.<br>
<br>
Used&nbsp;when:<br>
-&nbsp;Shader&nbsp;file&nbsp;not&nbsp;found<br>
-&nbsp;Material&nbsp;class&nbsp;not&nbsp;found<br>
-&nbsp;Deserialization&nbsp;failed<br>
<br>
Provides&nbsp;visual&nbsp;feedback&nbsp;(magenta&nbsp;color).<br>
&quot;&quot;&quot;<br>
<br>
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
<br>
from&nbsp;termin._native.render&nbsp;import&nbsp;TcMaterial,&nbsp;TcRenderState<br>
<br>
<br>
UNKNOWN_VERT&nbsp;=&nbsp;&quot;&quot;&quot;#version&nbsp;330&nbsp;core<br>
<br>
layout(location&nbsp;=&nbsp;0)&nbsp;in&nbsp;vec3&nbsp;a_position;<br>
layout(location&nbsp;=&nbsp;1)&nbsp;in&nbsp;vec3&nbsp;a_normal;<br>
<br>
uniform&nbsp;mat4&nbsp;u_model;<br>
uniform&nbsp;mat4&nbsp;u_view;<br>
uniform&nbsp;mat4&nbsp;u_projection;<br>
<br>
out&nbsp;vec3&nbsp;v_normal;<br>
out&nbsp;vec3&nbsp;v_world_pos;<br>
<br>
void&nbsp;main()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;world&nbsp;=&nbsp;u_model&nbsp;*&nbsp;vec4(a_position,&nbsp;1.0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;v_world_pos&nbsp;=&nbsp;world.xyz;<br>
&nbsp;&nbsp;&nbsp;&nbsp;v_normal&nbsp;=&nbsp;mat3(transpose(inverse(u_model)))&nbsp;*&nbsp;a_normal;<br>
&nbsp;&nbsp;&nbsp;&nbsp;gl_Position&nbsp;=&nbsp;u_projection&nbsp;*&nbsp;u_view&nbsp;*&nbsp;world;<br>
}<br>
&quot;&quot;&quot;<br>
<br>
UNKNOWN_FRAG&nbsp;=&nbsp;&quot;&quot;&quot;#version&nbsp;330&nbsp;core<br>
<br>
in&nbsp;vec3&nbsp;v_normal;<br>
in&nbsp;vec3&nbsp;v_world_pos;<br>
<br>
uniform&nbsp;vec3&nbsp;u_camera_position;<br>
<br>
out&nbsp;vec4&nbsp;FragColor;<br>
<br>
void&nbsp;main()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;N&nbsp;=&nbsp;normalize(v_normal);<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;V&nbsp;=&nbsp;normalize(u_camera_position&nbsp;-&nbsp;v_world_pos);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Simple&nbsp;hemisphere&nbsp;lighting<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;up&nbsp;=&nbsp;dot(N,&nbsp;vec3(0.0,&nbsp;0.0,&nbsp;1.0))&nbsp;*&nbsp;0.5&nbsp;+&nbsp;0.5;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Magenta&nbsp;base&nbsp;color&nbsp;(standard&nbsp;&quot;missing&nbsp;texture&quot;&nbsp;color)<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;base_color&nbsp;=&nbsp;vec3(1.0,&nbsp;0.0,&nbsp;1.0);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Fresnel&nbsp;rim&nbsp;for&nbsp;visibility<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;fresnel&nbsp;=&nbsp;pow(1.0&nbsp;-&nbsp;max(dot(N,&nbsp;V),&nbsp;0.0),&nbsp;3.0);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;color&nbsp;=&nbsp;base_color&nbsp;*&nbsp;(0.3&nbsp;+&nbsp;0.7&nbsp;*&nbsp;up)&nbsp;+&nbsp;vec3(1.0)&nbsp;*&nbsp;fresnel&nbsp;*&nbsp;0.3;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;FragColor&nbsp;=&nbsp;vec4(color,&nbsp;1.0);<br>
}<br>
&quot;&quot;&quot;<br>
<br>
def&nbsp;create_unknown_material(<br>
&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;str&nbsp;=&nbsp;&quot;UnknownMaterial&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;error_message:&nbsp;str&nbsp;|&nbsp;None&nbsp;=&nbsp;None,<br>
)&nbsp;-&gt;&nbsp;TcMaterial:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;an&nbsp;unknown/missing&nbsp;material&nbsp;(bright&nbsp;magenta).<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;Material&nbsp;name&nbsp;(can&nbsp;include&nbsp;error&nbsp;info).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_message:&nbsp;Optional&nbsp;error&nbsp;message&nbsp;to&nbsp;store&nbsp;in&nbsp;name.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TcMaterial&nbsp;that&nbsp;renders&nbsp;as&nbsp;magenta.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Include&nbsp;error&nbsp;in&nbsp;name&nbsp;for&nbsp;debugging<br>
&nbsp;&nbsp;&nbsp;&nbsp;mat_name&nbsp;=&nbsp;name<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;error_message:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mat_name&nbsp;=&nbsp;f&quot;{name}:&nbsp;{error_message[:50]}&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;mat&nbsp;=&nbsp;TcMaterial.create(mat_name,&nbsp;&quot;&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;mat.shader_name&nbsp;=&nbsp;&quot;UnknownShader&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;state&nbsp;=&nbsp;TcRenderState.opaque()<br>
&nbsp;&nbsp;&nbsp;&nbsp;phase&nbsp;=&nbsp;mat.add_phase_from_sources(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertex_source=UNKNOWN_VERT,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fragment_source=UNKNOWN_FRAG,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;geometry_source=&quot;&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shader_name=&quot;UnknownShader&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;phase_mark=&quot;opaque&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;priority=0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state=state,<br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;phase&nbsp;is&nbsp;not&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Magenta&nbsp;color<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;phase.set_color(1.0,&nbsp;0.0,&nbsp;1.0,&nbsp;1.0)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;mat<br>
<br>
<br>
#&nbsp;Legacy&nbsp;function&nbsp;alias<br>
def&nbsp;get_unknown_shader():<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Deprecated:&nbsp;Use&nbsp;create_unknown_material()&nbsp;instead.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;NotImplementedError(&quot;get_unknown_shader()&nbsp;is&nbsp;deprecated.&nbsp;Use&nbsp;create_unknown_material()&nbsp;instead.&quot;)<br>
<br>
<br>
class&nbsp;UnknownMaterial(TcMaterial):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Fallback&nbsp;material&nbsp;for&nbsp;missing/broken&nbsp;shaders&nbsp;and&nbsp;materials.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Renders&nbsp;as&nbsp;bright&nbsp;magenta&nbsp;(standard&nbsp;&quot;missing&quot;&nbsp;color).<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns&nbsp;TcMaterial.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__new__(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cls,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;original_shader:&nbsp;str&nbsp;|&nbsp;None&nbsp;=&nbsp;None,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;original_material:&nbsp;str&nbsp;|&nbsp;None&nbsp;=&nbsp;None,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;original_data:&nbsp;dict&nbsp;|&nbsp;None&nbsp;=&nbsp;None,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_message:&nbsp;str&nbsp;|&nbsp;None&nbsp;=&nbsp;None,<br>
&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;-&gt;&nbsp;TcMaterial:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Build&nbsp;error&nbsp;message&nbsp;for&nbsp;debugging<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg&nbsp;=&nbsp;error_message<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;msg:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;original_shader:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg&nbsp;=&nbsp;f&quot;Missing&nbsp;shader:&nbsp;{original_shader}&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;original_material:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg&nbsp;=&nbsp;f&quot;Missing&nbsp;material:&nbsp;{original_material}&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;create_unknown_material(error_message=msg)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;@classmethod<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;for_missing_shader(cls,&nbsp;shader_name:&nbsp;str)&nbsp;-&gt;&nbsp;TcMaterial:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;UnknownMaterial&nbsp;for&nbsp;a&nbsp;missing&nbsp;shader.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;create_unknown_material(error_message=f&quot;Missing&nbsp;shader:&nbsp;{shader_name}&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;@classmethod<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;for_missing_material(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cls,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;material_name:&nbsp;str,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;original_data:&nbsp;dict&nbsp;|&nbsp;None&nbsp;=&nbsp;None,<br>
&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;-&gt;&nbsp;TcMaterial:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;UnknownMaterial&nbsp;for&nbsp;a&nbsp;missing&nbsp;material&nbsp;class.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;create_unknown_material(error_message=f&quot;Missing&nbsp;material:&nbsp;{material_name}&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;@classmethod<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;for_error(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cls,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error:&nbsp;Exception,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;original_data:&nbsp;dict&nbsp;|&nbsp;None&nbsp;=&nbsp;None,<br>
&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;-&gt;&nbsp;TcMaterial:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;UnknownMaterial&nbsp;for&nbsp;a&nbsp;deserialization&nbsp;error.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;create_unknown_material(error_message=str(error))<br>
<!-- END SCAT CODE -->
</body>
</html>
