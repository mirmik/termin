<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/visualization/render/state.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
&quot;&quot;&quot;<br>
ViewportRenderState&nbsp;—&nbsp;контейнер&nbsp;состояния&nbsp;рендеринга&nbsp;для&nbsp;view.<br>
<br>
Хранит:<br>
-&nbsp;pipeline:&nbsp;RenderPipeline&nbsp;(как&nbsp;рендерим)<br>
-&nbsp;fbos:&nbsp;пул&nbsp;FBO&nbsp;для&nbsp;ресурсов&nbsp;framegraph<br>
<br>
Это&nbsp;позволяет&nbsp;отделить&nbsp;&quot;что&nbsp;рендерим&quot;&nbsp;(RenderView)&nbsp;от&nbsp;&quot;как&nbsp;рендерим&quot;&nbsp;(ViewportRenderState).<br>
Один&nbsp;RenderView&nbsp;может&nbsp;быть&nbsp;отрендерен&nbsp;разными&nbsp;pipeline.<br>
&quot;&quot;&quot;<br>
<br>
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
<br>
from&nbsp;dataclasses&nbsp;import&nbsp;dataclass,&nbsp;field<br>
from&nbsp;typing&nbsp;import&nbsp;TYPE_CHECKING,&nbsp;Dict,&nbsp;Optional<br>
<br>
if&nbsp;TYPE_CHECKING:<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.visualization.render.framegraph&nbsp;import&nbsp;RenderPipeline<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.visualization.platform.backends.base&nbsp;import&nbsp;FramebufferHandle<br>
<br>
<br>
@dataclass<br>
class&nbsp;ViewportRenderState:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Состояние&nbsp;рендеринга&nbsp;для&nbsp;RenderView.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Связывает&nbsp;RenderView&nbsp;с&nbsp;конкретным&nbsp;pipeline&nbsp;и&nbsp;управляет&nbsp;FBO&nbsp;пулом.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Атрибуты:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipeline:&nbsp;Конвейер&nbsp;рендеринга&nbsp;(список&nbsp;пассов,&nbsp;спецификации&nbsp;очистки).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fbos:&nbsp;Словарь&nbsp;{resource_name&nbsp;-&gt;&nbsp;FramebufferHandle}&nbsp;для&nbsp;framegraph.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;pipeline:&nbsp;Optional[&quot;RenderPipeline&quot;]&nbsp;=&nbsp;None<br>
&nbsp;&nbsp;&nbsp;&nbsp;fbos:&nbsp;Dict[str,&nbsp;&quot;FramebufferHandle&quot;]&nbsp;=&nbsp;field(default_factory=dict)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;get_fbo(self,&nbsp;name:&nbsp;str)&nbsp;-&gt;&nbsp;Optional[&quot;FramebufferHandle&quot;]:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Возвращает&nbsp;FBO&nbsp;по&nbsp;имени&nbsp;ресурса.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Параметры:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;Имя&nbsp;ресурса&nbsp;framegraph.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Возвращает:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FramebufferHandle&nbsp;или&nbsp;None.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.fbos.get(name)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;set_fbo(self,&nbsp;name:&nbsp;str,&nbsp;fbo:&nbsp;&quot;FramebufferHandle&quot;)&nbsp;-&gt;&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Устанавливает&nbsp;FBO&nbsp;для&nbsp;ресурса.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Параметры:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;Имя&nbsp;ресурса&nbsp;framegraph.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fbo:&nbsp;Хэндл&nbsp;фреймбуфера.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.fbos[name]&nbsp;=&nbsp;fbo<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;clear_fbos(self)&nbsp;-&gt;&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Удаляет&nbsp;все&nbsp;FBO&nbsp;из&nbsp;пула.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Вызывает&nbsp;delete()&nbsp;для&nbsp;каждого&nbsp;FBO&nbsp;перед&nbsp;удалением&nbsp;из&nbsp;словаря.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;fbo&nbsp;in&nbsp;self.fbos.values():<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;fbo&nbsp;is&nbsp;not&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fbo.delete()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.fbos.clear()<br>
<!-- END SCAT CODE -->
</body>
</html>
