<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/visualization/render/framegraph/resource.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
&quot;&quot;&quot;<br>
Иерархия&nbsp;ресурсов&nbsp;framegraph.<br>
<br>
FrameGraphResource&nbsp;—&nbsp;базовый&nbsp;класс&nbsp;для&nbsp;всех&nbsp;ресурсов&nbsp;конвейера.<br>
Ресурсы&nbsp;передаются&nbsp;между&nbsp;пассами&nbsp;через&nbsp;reads/writes.<br>
<br>
Типы&nbsp;ресурсов:<br>
-&nbsp;SingleFBO:&nbsp;обёртка&nbsp;над&nbsp;одним&nbsp;framebuffer'ом<br>
-&nbsp;ShadowMapArray:&nbsp;массив&nbsp;shadow&nbsp;maps&nbsp;для&nbsp;освещения<br>
<br>
Алиасы&nbsp;(inplace):<br>
&nbsp;&nbsp;&nbsp;&nbsp;При&nbsp;inplace-операции&nbsp;ресурс&nbsp;читается&nbsp;и&nbsp;пишется&nbsp;одновременно.<br>
&nbsp;&nbsp;&nbsp;&nbsp;Для&nbsp;этого&nbsp;используется&nbsp;пара&nbsp;алиасов&nbsp;(read_name,&nbsp;write_name),<br>
&nbsp;&nbsp;&nbsp;&nbsp;которые&nbsp;ссылаются&nbsp;на&nbsp;один&nbsp;и&nbsp;тот&nbsp;же&nbsp;физический&nbsp;ресурс.<br>
&quot;&quot;&quot;<br>
<br>
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
<br>
from&nbsp;abc&nbsp;import&nbsp;ABC,&nbsp;abstractmethod<br>
from&nbsp;dataclasses&nbsp;import&nbsp;dataclass<br>
from&nbsp;typing&nbsp;import&nbsp;TYPE_CHECKING,&nbsp;Tuple<br>
<br>
from&nbsp;termin._native.render&nbsp;import&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;ShadowMapArrayEntry,<br>
&nbsp;&nbsp;&nbsp;&nbsp;ShadowMapArrayResource,<br>
)<br>
<br>
if&nbsp;TYPE_CHECKING:<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.visualization.platform.backends.base&nbsp;import&nbsp;FramebufferHandle,&nbsp;GPUTextureHandle<br>
<br>
__all__&nbsp;=&nbsp;[<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;FrameGraphResource&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;SingleFBO&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;ShadowMapArrayEntry&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;ShadowMapArrayResource&quot;,<br>
]<br>
<br>
<br>
class&nbsp;FrameGraphResource(ABC):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Базовый&nbsp;класс&nbsp;для&nbsp;ресурсов&nbsp;framegraph.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Каждый&nbsp;ресурс&nbsp;имеет&nbsp;тип&nbsp;(resource_type),&nbsp;по&nbsp;которому<br>
&nbsp;&nbsp;&nbsp;&nbsp;RenderEngine&nbsp;определяет,&nbsp;как&nbsp;с&nbsp;ним&nbsp;работать.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;@property<br>
&nbsp;&nbsp;&nbsp;&nbsp;@abstractmethod<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;resource_type(self)&nbsp;-&gt;&nbsp;str:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Тип&nbsp;ресурса&nbsp;для&nbsp;идентификации&nbsp;в&nbsp;pipeline.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
<br>
<br>
@dataclass<br>
class&nbsp;SingleFBO(FrameGraphResource):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Обёртка&nbsp;над&nbsp;одним&nbsp;framebuffer'ом.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Это&nbsp;стандартный&nbsp;тип&nbsp;ресурса&nbsp;для&nbsp;большинства&nbsp;пассов:<br>
&nbsp;&nbsp;&nbsp;&nbsp;color&nbsp;pass,&nbsp;depth&nbsp;pass,&nbsp;id&nbsp;pass&nbsp;и&nbsp;т.д.<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Атрибуты:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fbo:&nbsp;handle&nbsp;на&nbsp;framebuffer<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size:&nbsp;размер&nbsp;(width,&nbsp;height)&nbsp;или&nbsp;None&nbsp;для&nbsp;автоматического<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;fbo:&nbsp;&quot;FramebufferHandle&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;size:&nbsp;Tuple[int,&nbsp;int]&nbsp;|&nbsp;None&nbsp;=&nbsp;None<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;@property<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;resource_type(self)&nbsp;-&gt;&nbsp;str:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;fbo&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;color_texture(self)&nbsp;-&gt;&nbsp;&quot;GPUTextureHandle&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Возвращает&nbsp;color&nbsp;attachment&nbsp;как&nbsp;текстуру.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.fbo.color_texture()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;depth_texture(self)&nbsp;-&gt;&nbsp;&quot;GPUTextureHandle&nbsp;|&nbsp;None&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Возвращает&nbsp;depth&nbsp;attachment&nbsp;как&nbsp;текстуру&nbsp;(если&nbsp;есть).&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.fbo.depth_texture()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;resize(self,&nbsp;size:&nbsp;Tuple[int,&nbsp;int])&nbsp;-&gt;&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Изменяет&nbsp;размер&nbsp;framebuffer'а.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.fbo.resize(size)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.size&nbsp;=&nbsp;size<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;get_size(self)&nbsp;-&gt;&nbsp;Tuple[int,&nbsp;int]:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Возвращает&nbsp;текущий&nbsp;размер.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self.size&nbsp;is&nbsp;not&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.size<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.fbo.get_size()<br>
<br>
<br>
<!-- END SCAT CODE -->
</body>
</html>
