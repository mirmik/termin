<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/visualization/animation/clip_io.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#&nbsp;termin/visualization/animation/clip_io.py<br>
&quot;&quot;&quot;I/O&nbsp;functions&nbsp;for&nbsp;TcAnimationClip&nbsp;(.tanim&nbsp;files).&quot;&quot;&quot;<br>
<br>
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
<br>
import&nbsp;json<br>
from&nbsp;pathlib&nbsp;import&nbsp;Path<br>
from&nbsp;typing&nbsp;import&nbsp;TYPE_CHECKING<br>
<br>
if&nbsp;TYPE_CHECKING:<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;._animation_native&nbsp;import&nbsp;TcAnimationClip<br>
<br>
<br>
def&nbsp;save_animation_clip(clip:&nbsp;&quot;TcAnimationClip&quot;,&nbsp;path:&nbsp;str&nbsp;|&nbsp;Path)&nbsp;-&gt;&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Save&nbsp;TcAnimationClip&nbsp;to&nbsp;.tanim&nbsp;file&nbsp;(JSON&nbsp;format).<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clip:&nbsp;TcAnimationClip&nbsp;to&nbsp;save<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path:&nbsp;Path&nbsp;to&nbsp;output&nbsp;file<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;=&nbsp;Path(path)<br>
&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;clip.serialize()<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Convert&nbsp;nanobind&nbsp;dict&nbsp;to&nbsp;Python&nbsp;dict<br>
&nbsp;&nbsp;&nbsp;&nbsp;py_data&nbsp;=&nbsp;dict(data)<br>
&nbsp;&nbsp;&nbsp;&nbsp;path.write_text(json.dumps(py_data,&nbsp;indent=2,&nbsp;ensure_ascii=False),&nbsp;encoding=&quot;utf-8&quot;)<br>
<br>
<br>
def&nbsp;load_animation_clip(path:&nbsp;str&nbsp;|&nbsp;Path)&nbsp;-&gt;&nbsp;&quot;TcAnimationClip&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Load&nbsp;TcAnimationClip&nbsp;from&nbsp;.tanim&nbsp;file.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path:&nbsp;Path&nbsp;to&nbsp;.tanim&nbsp;file<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Loaded&nbsp;TcAnimationClip<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;._animation_native&nbsp;import&nbsp;TcAnimationClip<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;=&nbsp;Path(path)<br>
&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;json.loads(path.read_text(encoding=&quot;utf-8&quot;))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Try&nbsp;to&nbsp;find&nbsp;by&nbsp;UUID&nbsp;first<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&quot;uuid&quot;&nbsp;in&nbsp;data:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clip&nbsp;=&nbsp;TcAnimationClip.from_uuid(data[&quot;uuid&quot;])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;clip.is_valid:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;clip<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Create&nbsp;new&nbsp;clip&nbsp;if&nbsp;not&nbsp;found<br>
&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;=&nbsp;data.get(&quot;name&quot;,&nbsp;&quot;&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;uuid&nbsp;=&nbsp;data.get(&quot;uuid&quot;,&nbsp;&quot;&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;clip&nbsp;=&nbsp;TcAnimationClip.create(name,&nbsp;uuid)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Load&nbsp;channel&nbsp;data&nbsp;if&nbsp;present<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&quot;channels&quot;&nbsp;in&nbsp;data:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clip.set_channels(data[&quot;channels&quot;])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&quot;tps&quot;&nbsp;in&nbsp;data:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clip.set_tps(data[&quot;tps&quot;])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&quot;loop&quot;&nbsp;in&nbsp;data:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clip.set_loop(data[&quot;loop&quot;])<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;clip<br>
<br>
<br>
def&nbsp;parse_animation_content(content:&nbsp;str)&nbsp;-&gt;&nbsp;&quot;TcAnimationClip&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Parse&nbsp;TcAnimationClip&nbsp;from&nbsp;JSON&nbsp;content&nbsp;string.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;content:&nbsp;JSON&nbsp;content&nbsp;of&nbsp;.tanim&nbsp;file<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Parsed&nbsp;TcAnimationClip<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;._animation_native&nbsp;import&nbsp;TcAnimationClip<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;json.loads(content)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&quot;uuid&quot;&nbsp;in&nbsp;data:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clip&nbsp;=&nbsp;TcAnimationClip.from_uuid(data[&quot;uuid&quot;])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;clip.is_valid:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;clip<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;=&nbsp;data.get(&quot;name&quot;,&nbsp;&quot;&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;uuid&nbsp;=&nbsp;data.get(&quot;uuid&quot;,&nbsp;&quot;&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;clip&nbsp;=&nbsp;TcAnimationClip.create(name,&nbsp;uuid)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&quot;channels&quot;&nbsp;in&nbsp;data:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clip.set_channels(data[&quot;channels&quot;])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&quot;tps&quot;&nbsp;in&nbsp;data:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clip.set_tps(data[&quot;tps&quot;])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&quot;loop&quot;&nbsp;in&nbsp;data:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clip.set_loop(data[&quot;loop&quot;])<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;clip<br>
<br>
<br>
__all__&nbsp;=&nbsp;[&quot;save_animation_clip&quot;,&nbsp;&quot;load_animation_clip&quot;,&nbsp;&quot;parse_animation_content&quot;]<br>
<!-- END SCAT CODE -->
</body>
</html>
