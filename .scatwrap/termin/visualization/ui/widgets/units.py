<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/visualization/ui/widgets/units.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
&quot;&quot;&quot;Unit&nbsp;system&nbsp;for&nbsp;UI&nbsp;layout:&nbsp;pixels&nbsp;and&nbsp;NDC&nbsp;(normalized&nbsp;device&nbsp;coordinates).&quot;&quot;&quot;<br>
<br>
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
from&nbsp;dataclasses&nbsp;import&nbsp;dataclass<br>
from&nbsp;enum&nbsp;import&nbsp;Enum<br>
<br>
<br>
class&nbsp;Unit(Enum):<br>
&nbsp;&nbsp;&nbsp;&nbsp;PX&nbsp;=&nbsp;&quot;px&quot;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;pixels<br>
&nbsp;&nbsp;&nbsp;&nbsp;NDC&nbsp;=&nbsp;&quot;ndc&quot;&nbsp;&nbsp;#&nbsp;normalized&nbsp;0..1<br>
<br>
<br>
@dataclass<br>
class&nbsp;Value:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;A&nbsp;value&nbsp;with&nbsp;unit&nbsp;(pixels&nbsp;or&nbsp;NDC).&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;amount:&nbsp;float<br>
&nbsp;&nbsp;&nbsp;&nbsp;unit:&nbsp;Unit&nbsp;=&nbsp;Unit.PX<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;to_pixels(self,&nbsp;reference:&nbsp;float)&nbsp;-&gt;&nbsp;float:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Convert&nbsp;to&nbsp;pixels&nbsp;given&nbsp;reference&nbsp;size&nbsp;(viewport&nbsp;width&nbsp;or&nbsp;height).&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self.unit&nbsp;==&nbsp;Unit.PX:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.amount<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:&nbsp;&nbsp;#&nbsp;NDC<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.amount&nbsp;*&nbsp;reference<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;to_ndc(self,&nbsp;reference:&nbsp;float)&nbsp;-&gt;&nbsp;float:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Convert&nbsp;to&nbsp;NDC&nbsp;given&nbsp;reference&nbsp;size.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self.unit&nbsp;==&nbsp;Unit.NDC:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.amount<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:&nbsp;&nbsp;#&nbsp;PX<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.amount&nbsp;/&nbsp;reference&nbsp;if&nbsp;reference&nbsp;&gt;&nbsp;0&nbsp;else&nbsp;0<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;@staticmethod<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;parse(v)&nbsp;-&gt;&nbsp;Value:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Parse&nbsp;value&nbsp;from&nbsp;various&nbsp;formats:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;100&nbsp;or&nbsp;100.0&nbsp;-&gt;&nbsp;100px<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&quot;100&quot;&nbsp;or&nbsp;&quot;100px&quot;&nbsp;-&gt;&nbsp;100px<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&quot;0.5ndc&quot;&nbsp;or&nbsp;&quot;50%&quot;&nbsp;-&gt;&nbsp;0.5ndc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;isinstance(v,&nbsp;Value):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;v<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;isinstance(v,&nbsp;(int,&nbsp;float)):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Value(float(v),&nbsp;Unit.PX)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;isinstance(v,&nbsp;str):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;=&nbsp;v.strip().lower()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;v.endswith(&quot;px&quot;):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Value(float(v[:-2]),&nbsp;Unit.PX)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;v.endswith(&quot;ndc&quot;):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Value(float(v[:-3]),&nbsp;Unit.NDC)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;v.endswith(&quot;%&quot;):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Value(float(v[:-1])&nbsp;/&nbsp;100.0,&nbsp;Unit.NDC)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;bare&nbsp;number&nbsp;-&gt;&nbsp;pixels<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Value(float(v),&nbsp;Unit.PX)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ValueError(f&quot;Cannot&nbsp;parse&nbsp;value:&nbsp;{v}&quot;)<br>
<br>
<br>
def&nbsp;px(amount:&nbsp;float)&nbsp;-&gt;&nbsp;Value:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Shortcut&nbsp;for&nbsp;pixel&nbsp;value.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Value(amount,&nbsp;Unit.PX)<br>
<br>
<br>
def&nbsp;ndc(amount:&nbsp;float)&nbsp;-&gt;&nbsp;Value:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Shortcut&nbsp;for&nbsp;NDC&nbsp;value.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Value(amount,&nbsp;Unit.NDC)<br>
<br>
<br>
def&nbsp;pct(amount:&nbsp;float)&nbsp;-&gt;&nbsp;Value:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Shortcut&nbsp;for&nbsp;percentage&nbsp;(converted&nbsp;to&nbsp;NDC).&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Value(amount&nbsp;/&nbsp;100.0,&nbsp;Unit.NDC)<br>
<!-- END SCAT CODE -->
</body>
</html>
