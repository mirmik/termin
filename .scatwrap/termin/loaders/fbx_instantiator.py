<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/loaders/fbx_instantiator.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
&quot;&quot;&quot;FBX&nbsp;instantiator&nbsp;-&nbsp;creates&nbsp;Entity&nbsp;hierarchy&nbsp;from&nbsp;FBX&nbsp;files.&quot;&quot;&quot;<br>
<br>
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
<br>
from&nbsp;pathlib&nbsp;import&nbsp;Path<br>
from&nbsp;typing&nbsp;import&nbsp;Dict,&nbsp;List<br>
<br>
import&nbsp;numpy&nbsp;as&nbsp;np<br>
<br>
from&nbsp;termin.geombase&nbsp;import&nbsp;Pose3<br>
from&nbsp;termin.geombase&nbsp;import&nbsp;GeneralPose3<br>
from&nbsp;termin.mesh.mesh&nbsp;import&nbsp;Mesh3<br>
from&nbsp;termin.mesh&nbsp;import&nbsp;TcMesh<br>
from&nbsp;termin.visualization.core.entity&nbsp;import&nbsp;Entity<br>
from&nbsp;termin.visualization.render.components.mesh_renderer&nbsp;import&nbsp;MeshRenderer<br>
from&nbsp;termin.visualization.render.materials.default_material&nbsp;import&nbsp;DefaultMaterial<br>
<br>
try:<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.loaders.fbx_loader&nbsp;import&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;load_fbx_file,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FBXSceneData,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FBXNodeData,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FBXMeshData,<br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;FBX_AVAILABLE&nbsp;=&nbsp;True<br>
except&nbsp;ImportError:<br>
&nbsp;&nbsp;&nbsp;&nbsp;FBX_AVAILABLE&nbsp;=&nbsp;False<br>
<br>
<br>
def&nbsp;_matrix_to_pose(matrix:&nbsp;np.ndarray)&nbsp;-&gt;&nbsp;Pose3:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Convert&nbsp;4x4&nbsp;transformation&nbsp;matrix&nbsp;to&nbsp;Pose3.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;scipy.spatial.transform&nbsp;import&nbsp;Rotation<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;translation&nbsp;=&nbsp;matrix[:3,&nbsp;3].copy()<br>
&nbsp;&nbsp;&nbsp;&nbsp;rotation_matrix&nbsp;=&nbsp;matrix[:3,&nbsp;:3].copy()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Extract&nbsp;scale&nbsp;from&nbsp;rotation&nbsp;matrix<br>
&nbsp;&nbsp;&nbsp;&nbsp;scale_x&nbsp;=&nbsp;np.linalg.norm(rotation_matrix[:,&nbsp;0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;scale_y&nbsp;=&nbsp;np.linalg.norm(rotation_matrix[:,&nbsp;1])<br>
&nbsp;&nbsp;&nbsp;&nbsp;scale_z&nbsp;=&nbsp;np.linalg.norm(rotation_matrix[:,&nbsp;2])<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Normalize&nbsp;to&nbsp;get&nbsp;pure&nbsp;rotation<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;scale_x&nbsp;&gt;&nbsp;1e-6:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotation_matrix[:,&nbsp;0]&nbsp;/=&nbsp;scale_x<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;scale_y&nbsp;&gt;&nbsp;1e-6:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotation_matrix[:,&nbsp;1]&nbsp;/=&nbsp;scale_y<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;scale_z&nbsp;&gt;&nbsp;1e-6:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotation_matrix[:,&nbsp;2]&nbsp;/=&nbsp;scale_z<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Convert&nbsp;rotation&nbsp;matrix&nbsp;to&nbsp;quaternion<br>
&nbsp;&nbsp;&nbsp;&nbsp;rot&nbsp;=&nbsp;Rotation.from_matrix(rotation_matrix)<br>
&nbsp;&nbsp;&nbsp;&nbsp;quat&nbsp;=&nbsp;rot.as_quat()&nbsp;&nbsp;#&nbsp;[x,&nbsp;y,&nbsp;z,&nbsp;w]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Pose3(lin=translation,&nbsp;ang=quat)<br>
<br>
<br>
def&nbsp;_extract_scale(matrix:&nbsp;np.ndarray)&nbsp;-&gt;&nbsp;np.ndarray:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Extract&nbsp;scale&nbsp;from&nbsp;4x4&nbsp;transformation&nbsp;matrix.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;scale_x&nbsp;=&nbsp;np.linalg.norm(matrix[:3,&nbsp;0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;scale_y&nbsp;=&nbsp;np.linalg.norm(matrix[:3,&nbsp;1])<br>
&nbsp;&nbsp;&nbsp;&nbsp;scale_z&nbsp;=&nbsp;np.linalg.norm(matrix[:3,&nbsp;2])<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;np.array([scale_x,&nbsp;scale_y,&nbsp;scale_z],&nbsp;dtype=np.float32)<br>
<br>
<br>
def&nbsp;_fbx_mesh_to_tc_mesh(fbx_mesh:&nbsp;FBXMeshData)&nbsp;-&gt;&nbsp;TcMesh:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Convert&nbsp;FBXMeshData&nbsp;to&nbsp;TcMesh.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.voxels.voxel_mesh&nbsp;import&nbsp;create_voxel_mesh<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;vertices&nbsp;=&nbsp;fbx_mesh.vertices.astype(np.float32)<br>
&nbsp;&nbsp;&nbsp;&nbsp;indices&nbsp;=&nbsp;fbx_mesh.indices.reshape(-1,&nbsp;3)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;fbx_mesh.normals&nbsp;is&nbsp;not&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;normals&nbsp;=&nbsp;fbx_mesh.normals.astype(np.float32)<br>
&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Compute&nbsp;normals<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mesh&nbsp;=&nbsp;Mesh3(name=fbx_mesh.name,&nbsp;vertices=vertices,&nbsp;triangles=indices)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mesh.compute_vertex_normals()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;normals&nbsp;=&nbsp;mesh.vertex_normals.astype(np.float32)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;uvs&nbsp;=&nbsp;fbx_mesh.uvs.astype(np.float32)&nbsp;if&nbsp;fbx_mesh.uvs&nbsp;is&nbsp;not&nbsp;None&nbsp;else&nbsp;None<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;create_voxel_mesh(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertices=vertices,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;triangles=indices,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertex_normals=normals,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvs=uvs,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=fbx_mesh.name,<br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
<br>
def&nbsp;_create_entity_from_node(<br>
&nbsp;&nbsp;&nbsp;&nbsp;node:&nbsp;FBXNodeData,<br>
&nbsp;&nbsp;&nbsp;&nbsp;fbx_meshes:&nbsp;List[FBXMeshData],<br>
&nbsp;&nbsp;&nbsp;&nbsp;tc_meshes:&nbsp;Dict[int,&nbsp;TcMesh],<br>
&nbsp;&nbsp;&nbsp;&nbsp;default_material:&nbsp;DefaultMaterial,<br>
)&nbsp;-&gt;&nbsp;Entity:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Recursively&nbsp;create&nbsp;Entity&nbsp;hierarchy&nbsp;from&nbsp;FBXNodeData.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Extract&nbsp;pose&nbsp;and&nbsp;scale&nbsp;from&nbsp;transform&nbsp;matrix<br>
&nbsp;&nbsp;&nbsp;&nbsp;pose&nbsp;=&nbsp;_matrix_to_pose(node.transform)&nbsp;if&nbsp;node.transform&nbsp;is&nbsp;not&nbsp;None&nbsp;else&nbsp;Pose3.identity()<br>
&nbsp;&nbsp;&nbsp;&nbsp;scale&nbsp;=&nbsp;_extract_scale(node.transform)&nbsp;if&nbsp;node.transform&nbsp;is&nbsp;not&nbsp;None&nbsp;else&nbsp;np.array([1.0,&nbsp;1.0,&nbsp;1.0])<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Create&nbsp;GeneralPose3&nbsp;with&nbsp;scale<br>
&nbsp;&nbsp;&nbsp;&nbsp;general_pose&nbsp;=&nbsp;GeneralPose3(lin=pose.lin,&nbsp;ang=pose.ang,&nbsp;scale=scale)<br>
&nbsp;&nbsp;&nbsp;&nbsp;entity&nbsp;=&nbsp;Entity(pose=general_pose,&nbsp;name=node.name)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Add&nbsp;MeshRenderer&nbsp;for&nbsp;each&nbsp;mesh&nbsp;attached&nbsp;to&nbsp;this&nbsp;node<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;mesh_idx&nbsp;in&nbsp;node.mesh_indices:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;mesh_idx&nbsp;&lt;&nbsp;len(fbx_meshes):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Get&nbsp;or&nbsp;create&nbsp;TcMesh<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;mesh_idx&nbsp;not&nbsp;in&nbsp;tc_meshes:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc_meshes[mesh_idx]&nbsp;=&nbsp;_fbx_mesh_to_tc_mesh(fbx_meshes[mesh_idx])<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc_mesh&nbsp;=&nbsp;tc_meshes[mesh_idx]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renderer&nbsp;=&nbsp;MeshRenderer(mesh=tc_mesh,&nbsp;material=default_material)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entity.add_component(renderer)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Recursively&nbsp;create&nbsp;children<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;child_node&nbsp;in&nbsp;node.children:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;child_entity&nbsp;=&nbsp;_create_entity_from_node(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;child_node,&nbsp;fbx_meshes,&nbsp;tc_meshes,&nbsp;default_material<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entity.transform.add_child(child_entity.transform)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;entity<br>
<br>
<br>
def&nbsp;instantiate_fbx(path:&nbsp;Path,&nbsp;name:&nbsp;str&nbsp;=&nbsp;None)&nbsp;-&gt;&nbsp;Entity:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Load&nbsp;FBX&nbsp;file&nbsp;and&nbsp;create&nbsp;Entity&nbsp;hierarchy.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path:&nbsp;Path&nbsp;to&nbsp;the&nbsp;FBX&nbsp;file.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;Optional&nbsp;name&nbsp;for&nbsp;the&nbsp;root&nbsp;entity.&nbsp;Defaults&nbsp;to&nbsp;filename&nbsp;without&nbsp;extension.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Root&nbsp;Entity&nbsp;containing&nbsp;the&nbsp;FBX&nbsp;hierarchy&nbsp;with&nbsp;MeshRenderers.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Raises:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ImportError:&nbsp;If&nbsp;ufbx&nbsp;library&nbsp;is&nbsp;not&nbsp;installed.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;FBX_AVAILABLE:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ImportError(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;FBX&nbsp;loading&nbsp;requires&nbsp;'ufbx'&nbsp;library.\n&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Install&nbsp;with:&nbsp;pip&nbsp;install&nbsp;ufbx\n&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Note:&nbsp;ufbx&nbsp;requires&nbsp;Python&nbsp;3.10-3.12&nbsp;and&nbsp;C&nbsp;compiler&nbsp;for&nbsp;building.&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene_data&nbsp;=&nbsp;load_fbx_file(str(path))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;name&nbsp;is&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;=&nbsp;path.stem<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Shared&nbsp;material&nbsp;for&nbsp;all&nbsp;meshes<br>
&nbsp;&nbsp;&nbsp;&nbsp;default_material&nbsp;=&nbsp;DefaultMaterial(color=(0.8,&nbsp;0.8,&nbsp;0.8,&nbsp;1.0))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Cache&nbsp;for&nbsp;TcMeshes&nbsp;(shared&nbsp;between&nbsp;nodes&nbsp;referencing&nbsp;same&nbsp;mesh)<br>
&nbsp;&nbsp;&nbsp;&nbsp;tc_meshes:&nbsp;Dict[int,&nbsp;TcMesh]&nbsp;=&nbsp;{}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;scene_data.root&nbsp;is&nbsp;not&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Create&nbsp;hierarchy&nbsp;from&nbsp;FBX&nbsp;node&nbsp;tree<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root_entity&nbsp;=&nbsp;_create_entity_from_node(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scene_data.root,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scene_data.meshes,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc_meshes,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_material,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root_entity.name&nbsp;=&nbsp;name<br>
&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;No&nbsp;hierarchy&nbsp;-&nbsp;create&nbsp;flat&nbsp;structure<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root_entity&nbsp;=&nbsp;Entity(pose=Pose3.identity(),&nbsp;name=name)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i,&nbsp;fbx_mesh&nbsp;in&nbsp;enumerate(scene_data.meshes):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc_mesh&nbsp;=&nbsp;_fbx_mesh_to_tc_mesh(fbx_mesh)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tc_meshes[i]&nbsp;=&nbsp;tc_mesh<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mesh_entity&nbsp;=&nbsp;Entity(pose=Pose3.identity(),&nbsp;name=fbx_mesh.name)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;renderer&nbsp;=&nbsp;MeshRenderer(mesh=tc_mesh,&nbsp;material=default_material)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mesh_entity.add_component(renderer)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root_entity.transform.add_child(mesh_entity.transform)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;root_entity<br>
<!-- END SCAT CODE -->
</body>
</html>
