<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/loaders/glb_extractor.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#&nbsp;termin/loaders/glb_extractor.py<br>
&quot;&quot;&quot;GLB&nbsp;extractor&nbsp;-&nbsp;extracts&nbsp;meshes,&nbsp;textures&nbsp;and&nbsp;animations&nbsp;from&nbsp;GLB&nbsp;files.&quot;&quot;&quot;<br>
<br>
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
<br>
from&nbsp;pathlib&nbsp;import&nbsp;Path<br>
from&nbsp;typing&nbsp;import&nbsp;List,&nbsp;Tuple<br>
<br>
import&nbsp;numpy&nbsp;as&nbsp;np<br>
<br>
from&nbsp;termin._native&nbsp;import&nbsp;log<br>
from&nbsp;termin.loaders.glb_loader&nbsp;import&nbsp;load_glb_file,&nbsp;GLBMeshData<br>
<br>
<br>
def&nbsp;save_mesh_as_obj(mesh:&nbsp;GLBMeshData,&nbsp;output_path:&nbsp;Path)&nbsp;-&gt;&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Save&nbsp;mesh&nbsp;data&nbsp;as&nbsp;OBJ&nbsp;file.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;lines&nbsp;=&nbsp;[]<br>
&nbsp;&nbsp;&nbsp;&nbsp;lines.append(f&quot;#&nbsp;Extracted&nbsp;from&nbsp;GLB:&nbsp;{mesh.name}&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;lines.append(f&quot;#&nbsp;Vertices:&nbsp;{len(mesh.vertices)}&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;lines.append(&quot;&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Vertices<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;v&nbsp;in&nbsp;mesh.vertices:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines.append(f&quot;v&nbsp;{v[0]:.6f}&nbsp;{v[1]:.6f}&nbsp;{v[2]:.6f}&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;lines.append(&quot;&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;UVs<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;mesh.uvs&nbsp;is&nbsp;not&nbsp;None&nbsp;and&nbsp;len(mesh.uvs)&nbsp;&gt;&nbsp;0:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;uv&nbsp;in&nbsp;mesh.uvs:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines.append(f&quot;vt&nbsp;{uv[0]:.6f}&nbsp;{uv[1]:.6f}&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines.append(&quot;&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Normals<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;mesh.normals&nbsp;is&nbsp;not&nbsp;None&nbsp;and&nbsp;len(mesh.normals)&nbsp;&gt;&nbsp;0:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;n&nbsp;in&nbsp;mesh.normals:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines.append(f&quot;vn&nbsp;{n[0]:.6f}&nbsp;{n[1]:.6f}&nbsp;{n[2]:.6f}&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines.append(&quot;&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Faces<br>
&nbsp;&nbsp;&nbsp;&nbsp;num_triangles&nbsp;=&nbsp;len(mesh.vertices)&nbsp;//&nbsp;3<br>
&nbsp;&nbsp;&nbsp;&nbsp;has_uvs&nbsp;=&nbsp;mesh.uvs&nbsp;is&nbsp;not&nbsp;None&nbsp;and&nbsp;len(mesh.uvs)&nbsp;&gt;&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;has_normals&nbsp;=&nbsp;mesh.normals&nbsp;is&nbsp;not&nbsp;None&nbsp;and&nbsp;len(mesh.normals)&nbsp;&gt;&nbsp;0<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;range(num_triangles):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base&nbsp;=&nbsp;i&nbsp;*&nbsp;3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i1,&nbsp;i2,&nbsp;i3&nbsp;=&nbsp;base&nbsp;+&nbsp;1,&nbsp;base&nbsp;+&nbsp;2,&nbsp;base&nbsp;+&nbsp;3<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;has_uvs&nbsp;and&nbsp;has_normals:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines.append(f&quot;f&nbsp;{i1}/{i1}/{i1}&nbsp;{i2}/{i2}/{i2}&nbsp;{i3}/{i3}/{i3}&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;has_uvs:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines.append(f&quot;f&nbsp;{i1}/{i1}&nbsp;{i2}/{i2}&nbsp;{i3}/{i3}&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;has_normals:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines.append(f&quot;f&nbsp;{i1}//{i1}&nbsp;{i2}//{i2}&nbsp;{i3}//{i3}&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines.append(f&quot;f&nbsp;{i1}&nbsp;{i2}&nbsp;{i3}&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;output_path.write_text(&quot;\n&quot;.join(lines),&nbsp;encoding=&quot;utf-8&quot;)<br>
<br>
<br>
def&nbsp;extract_glb(glb_path:&nbsp;Path,&nbsp;output_dir:&nbsp;Path&nbsp;=&nbsp;None)&nbsp;-&gt;&nbsp;Tuple[Path,&nbsp;List[Path]]:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Extract&nbsp;meshes,&nbsp;textures&nbsp;and&nbsp;animations&nbsp;from&nbsp;GLB&nbsp;file.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;glb_path:&nbsp;Path&nbsp;to&nbsp;the&nbsp;GLB&nbsp;file<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_dir:&nbsp;Directory&nbsp;to&nbsp;extract&nbsp;to.&nbsp;If&nbsp;None,&nbsp;creates&nbsp;directory<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next&nbsp;to&nbsp;GLB&nbsp;with&nbsp;same&nbsp;name.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tuple&nbsp;of&nbsp;(output_directory,&nbsp;list_of_created_files)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;glb_path&nbsp;=&nbsp;Path(glb_path)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;output_dir&nbsp;is&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_dir&nbsp;=&nbsp;glb_path.parent&nbsp;/&nbsp;glb_path.stem<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;output_dir.mkdir(parents=True,&nbsp;exist_ok=True)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Load&nbsp;GLB<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene_data&nbsp;=&nbsp;load_glb_file(str(glb_path))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;created_files&nbsp;=&nbsp;[]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Extract&nbsp;meshes<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;mesh&nbsp;in&nbsp;scene_data.meshes:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;safe_name&nbsp;=&nbsp;&quot;&quot;.join(c&nbsp;if&nbsp;c.isalnum()&nbsp;or&nbsp;c&nbsp;in&nbsp;&quot;-_&quot;&nbsp;else&nbsp;&quot;_&quot;&nbsp;for&nbsp;c&nbsp;in&nbsp;mesh.name)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;safe_name:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;safe_name&nbsp;=&nbsp;f&quot;mesh_{len(created_files)}&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obj_path&nbsp;=&nbsp;output_dir&nbsp;/&nbsp;f&quot;{safe_name}.obj&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;save_mesh_as_obj(mesh,&nbsp;obj_path)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;created_files.append(obj_path)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(f&quot;[GLB&nbsp;Extract]&nbsp;Saved&nbsp;mesh:&nbsp;{obj_path.name}&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Extract&nbsp;textures<br>
&nbsp;&nbsp;&nbsp;&nbsp;textures_dir&nbsp;=&nbsp;None<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i,&nbsp;tex&nbsp;in&nbsp;enumerate(scene_data.textures):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;textures_dir&nbsp;is&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;textures_dir&nbsp;=&nbsp;output_dir&nbsp;/&nbsp;&quot;textures&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;textures_dir.mkdir(exist_ok=True)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Determine&nbsp;extension&nbsp;from&nbsp;mime&nbsp;type<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ext&nbsp;=&nbsp;&quot;.png&quot;&nbsp;if&nbsp;&quot;png&quot;&nbsp;in&nbsp;tex.mime_type&nbsp;else&nbsp;&quot;.jpg&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;safe_name&nbsp;=&nbsp;&quot;&quot;.join(c&nbsp;if&nbsp;c.isalnum()&nbsp;or&nbsp;c&nbsp;in&nbsp;&quot;-_&quot;&nbsp;else&nbsp;&quot;_&quot;&nbsp;for&nbsp;c&nbsp;in&nbsp;tex.name)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;safe_name:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;safe_name&nbsp;=&nbsp;f&quot;texture_{i}&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tex_path&nbsp;=&nbsp;textures_dir&nbsp;/&nbsp;f&quot;{safe_name}{ext}&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tex_path.write_bytes(tex.data)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;created_files.append(tex_path)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(f&quot;[GLB&nbsp;Extract]&nbsp;Saved&nbsp;texture:&nbsp;{tex_path.name}&nbsp;({len(tex.data)}&nbsp;bytes)&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Save&nbsp;material&nbsp;info<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;scene_data.materials:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mat_info_path&nbsp;=&nbsp;output_dir&nbsp;/&nbsp;&quot;_materials.txt&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines&nbsp;=&nbsp;[&quot;#&nbsp;Materials&nbsp;from&nbsp;GLB&quot;,&nbsp;&quot;&quot;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;mat&nbsp;in&nbsp;scene_data.materials:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines.append(f&quot;Material:&nbsp;{mat.name}&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;mat.base_color&nbsp;is&nbsp;not&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;mat.base_color<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines.append(f&quot;&nbsp;&nbsp;Base&nbsp;Color:&nbsp;({c[0]:.3f},&nbsp;{c[1]:.3f},&nbsp;{c[2]:.3f},&nbsp;{c[3]:.3f})&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;mat.base_color_texture&nbsp;is&nbsp;not&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines.append(f&quot;&nbsp;&nbsp;Texture&nbsp;Index:&nbsp;{mat.base_color_texture}&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines.append(&quot;&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mat_info_path.write_text(&quot;\n&quot;.join(lines),&nbsp;encoding=&quot;utf-8&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;created_files.append(mat_info_path)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(f&quot;[GLB&nbsp;Extract]&nbsp;Saved&nbsp;materials&nbsp;info:&nbsp;{mat_info_path.name}&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;log.info(f&quot;[GLB&nbsp;Extract]&nbsp;Extracted&nbsp;{len(scene_data.meshes)}&nbsp;meshes,&nbsp;{len(scene_data.textures)}&nbsp;textures&nbsp;to&nbsp;{output_dir}&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Extract&nbsp;animations<br>
&nbsp;&nbsp;&nbsp;&nbsp;anim_files&nbsp;=&nbsp;extract_animations(glb_path,&nbsp;output_dir,&nbsp;scene_data)<br>
&nbsp;&nbsp;&nbsp;&nbsp;created_files.extend(anim_files)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;output_dir,&nbsp;created_files<br>
<br>
<br>
def&nbsp;extract_animations(<br>
&nbsp;&nbsp;&nbsp;&nbsp;glb_path:&nbsp;Path,<br>
&nbsp;&nbsp;&nbsp;&nbsp;output_dir:&nbsp;Path&nbsp;=&nbsp;None,<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene_data=None,<br>
)&nbsp;-&gt;&nbsp;List[Path]:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Extract&nbsp;animations&nbsp;from&nbsp;GLB&nbsp;file&nbsp;into&nbsp;.tanim&nbsp;files.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;glb_path:&nbsp;Path&nbsp;to&nbsp;the&nbsp;GLB&nbsp;file<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_dir:&nbsp;Directory&nbsp;to&nbsp;extract&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scene_data:&nbsp;Pre-loaded&nbsp;GLBSceneData&nbsp;(optional)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&nbsp;of&nbsp;created&nbsp;animation&nbsp;files<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.visualization.animation.clip&nbsp;import&nbsp;clip_from_glb<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.visualization.animation.clip_io&nbsp;import&nbsp;save_animation_clip<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;glb_path&nbsp;=&nbsp;Path(glb_path)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;output_dir&nbsp;is&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output_dir&nbsp;=&nbsp;glb_path.parent&nbsp;/&nbsp;glb_path.stem<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;output_dir.mkdir(parents=True,&nbsp;exist_ok=True)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;scene_data&nbsp;is&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scene_data&nbsp;=&nbsp;load_glb_file(str(glb_path))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;created_files&nbsp;=&nbsp;[]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;glb_anim&nbsp;in&nbsp;scene_data.animations:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clip&nbsp;=&nbsp;clip_from_glb(glb_anim)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;safe_name&nbsp;=&nbsp;&quot;&quot;.join(c&nbsp;if&nbsp;c.isalnum()&nbsp;or&nbsp;c&nbsp;in&nbsp;&quot;-_&quot;&nbsp;else&nbsp;&quot;_&quot;&nbsp;for&nbsp;c&nbsp;in&nbsp;clip.name)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;safe_name:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;safe_name&nbsp;=&nbsp;f&quot;animation_{len(created_files)}&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anim_path&nbsp;=&nbsp;output_dir&nbsp;/&nbsp;f&quot;{safe_name}.tanim&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;save_animation_clip(clip,&nbsp;anim_path)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;created_files.append(anim_path)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(f&quot;[GLB&nbsp;Extract]&nbsp;Saved&nbsp;animation:&nbsp;{anim_path.name}&nbsp;({clip.duration:.2f}s,&nbsp;{len(clip.channels)}&nbsp;channels)&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;created_files:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(f&quot;[GLB&nbsp;Extract]&nbsp;Extracted&nbsp;{len(created_files)}&nbsp;animation(s)&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;created_files<br>
<!-- END SCAT CODE -->
</body>
</html>
