<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/voxels/visualization.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
&quot;&quot;&quot;<br>
VoxelVisualizer&nbsp;—&nbsp;визуализация&nbsp;воксельной&nbsp;сетки&nbsp;в&nbsp;редакторе.<br>
&quot;&quot;&quot;<br>
<br>
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
<br>
from&nbsp;typing&nbsp;import&nbsp;TYPE_CHECKING,&nbsp;Optional<br>
import&nbsp;numpy&nbsp;as&nbsp;np<br>
<br>
from&nbsp;termin.mesh&nbsp;import&nbsp;TcMesh<br>
from&nbsp;termin.visualization.core.material&nbsp;import&nbsp;Material<br>
from&nbsp;termin.visualization.render.components&nbsp;import&nbsp;MeshRenderer<br>
<br>
if&nbsp;TYPE_CHECKING:<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.visualization.core.entity&nbsp;import&nbsp;Entity<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.voxels.grid&nbsp;import&nbsp;VoxelGrid<br>
<br>
<br>
#&nbsp;Вершины&nbsp;единичного&nbsp;куба&nbsp;(центрирован&nbsp;в&nbsp;origin)<br>
_CUBE_VERTICES&nbsp;=&nbsp;np.array([<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Front&nbsp;face<br>
&nbsp;&nbsp;&nbsp;&nbsp;[-0.5,&nbsp;-0.5,&nbsp;&nbsp;0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;0.5,&nbsp;-0.5,&nbsp;&nbsp;0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;0.5,&nbsp;&nbsp;0.5,&nbsp;&nbsp;0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[-0.5,&nbsp;&nbsp;0.5,&nbsp;&nbsp;0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Back&nbsp;face<br>
&nbsp;&nbsp;&nbsp;&nbsp;[-0.5,&nbsp;-0.5,&nbsp;-0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[-0.5,&nbsp;&nbsp;0.5,&nbsp;-0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;0.5,&nbsp;&nbsp;0.5,&nbsp;-0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;0.5,&nbsp;-0.5,&nbsp;-0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Top&nbsp;face<br>
&nbsp;&nbsp;&nbsp;&nbsp;[-0.5,&nbsp;&nbsp;0.5,&nbsp;-0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[-0.5,&nbsp;&nbsp;0.5,&nbsp;&nbsp;0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;0.5,&nbsp;&nbsp;0.5,&nbsp;&nbsp;0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;0.5,&nbsp;&nbsp;0.5,&nbsp;-0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Bottom&nbsp;face<br>
&nbsp;&nbsp;&nbsp;&nbsp;[-0.5,&nbsp;-0.5,&nbsp;-0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;0.5,&nbsp;-0.5,&nbsp;-0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;0.5,&nbsp;-0.5,&nbsp;&nbsp;0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[-0.5,&nbsp;-0.5,&nbsp;&nbsp;0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Right&nbsp;face<br>
&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;0.5,&nbsp;-0.5,&nbsp;-0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;0.5,&nbsp;&nbsp;0.5,&nbsp;-0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;0.5,&nbsp;&nbsp;0.5,&nbsp;&nbsp;0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;0.5,&nbsp;-0.5,&nbsp;&nbsp;0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Left&nbsp;face<br>
&nbsp;&nbsp;&nbsp;&nbsp;[-0.5,&nbsp;-0.5,&nbsp;-0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[-0.5,&nbsp;-0.5,&nbsp;&nbsp;0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[-0.5,&nbsp;&nbsp;0.5,&nbsp;&nbsp;0.5],<br>
&nbsp;&nbsp;&nbsp;&nbsp;[-0.5,&nbsp;&nbsp;0.5,&nbsp;-0.5],<br>
],&nbsp;dtype=np.float32)<br>
<br>
_CUBE_TRIANGLES&nbsp;=&nbsp;np.array([<br>
&nbsp;&nbsp;&nbsp;&nbsp;[0,&nbsp;1,&nbsp;2],&nbsp;[0,&nbsp;2,&nbsp;3],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;front<br>
&nbsp;&nbsp;&nbsp;&nbsp;[4,&nbsp;5,&nbsp;6],&nbsp;[4,&nbsp;6,&nbsp;7],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;back<br>
&nbsp;&nbsp;&nbsp;&nbsp;[8,&nbsp;9,&nbsp;10],&nbsp;[8,&nbsp;10,&nbsp;11],&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;top<br>
&nbsp;&nbsp;&nbsp;&nbsp;[12,&nbsp;13,&nbsp;14],&nbsp;[12,&nbsp;14,&nbsp;15],&nbsp;#&nbsp;bottom<br>
&nbsp;&nbsp;&nbsp;&nbsp;[16,&nbsp;17,&nbsp;18],&nbsp;[16,&nbsp;18,&nbsp;19],&nbsp;#&nbsp;right<br>
&nbsp;&nbsp;&nbsp;&nbsp;[20,&nbsp;21,&nbsp;22],&nbsp;[20,&nbsp;22,&nbsp;23],&nbsp;#&nbsp;left<br>
],&nbsp;dtype=np.int32)<br>
<br>
_CUBE_NORMALS&nbsp;=&nbsp;np.array([<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Front<br>
&nbsp;&nbsp;&nbsp;&nbsp;[0,&nbsp;0,&nbsp;1],&nbsp;[0,&nbsp;0,&nbsp;1],&nbsp;[0,&nbsp;0,&nbsp;1],&nbsp;[0,&nbsp;0,&nbsp;1],<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Back<br>
&nbsp;&nbsp;&nbsp;&nbsp;[0,&nbsp;0,&nbsp;-1],&nbsp;[0,&nbsp;0,&nbsp;-1],&nbsp;[0,&nbsp;0,&nbsp;-1],&nbsp;[0,&nbsp;0,&nbsp;-1],<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Top<br>
&nbsp;&nbsp;&nbsp;&nbsp;[0,&nbsp;1,&nbsp;0],&nbsp;[0,&nbsp;1,&nbsp;0],&nbsp;[0,&nbsp;1,&nbsp;0],&nbsp;[0,&nbsp;1,&nbsp;0],<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Bottom<br>
&nbsp;&nbsp;&nbsp;&nbsp;[0,&nbsp;-1,&nbsp;0],&nbsp;[0,&nbsp;-1,&nbsp;0],&nbsp;[0,&nbsp;-1,&nbsp;0],&nbsp;[0,&nbsp;-1,&nbsp;0],<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Right<br>
&nbsp;&nbsp;&nbsp;&nbsp;[1,&nbsp;0,&nbsp;0],&nbsp;[1,&nbsp;0,&nbsp;0],&nbsp;[1,&nbsp;0,&nbsp;0],&nbsp;[1,&nbsp;0,&nbsp;0],<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Left<br>
&nbsp;&nbsp;&nbsp;&nbsp;[-1,&nbsp;0,&nbsp;0],&nbsp;[-1,&nbsp;0,&nbsp;0],&nbsp;[-1,&nbsp;0,&nbsp;0],&nbsp;[-1,&nbsp;0,&nbsp;0],<br>
],&nbsp;dtype=np.float32)<br>
<br>
VERTS_PER_CUBE&nbsp;=&nbsp;24<br>
TRIS_PER_CUBE&nbsp;=&nbsp;12<br>
CUBE_SCALE&nbsp;=&nbsp;0.85&nbsp;&nbsp;#&nbsp;Размер&nbsp;кубика&nbsp;относительно&nbsp;ячейки&nbsp;(для&nbsp;видимости&nbsp;сетки)<br>
<br>
<br>
class&nbsp;VoxelVisualizer:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Визуализатор&nbsp;воксельной&nbsp;сетки.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Создаёт&nbsp;merged&nbsp;mesh&nbsp;из&nbsp;всех&nbsp;непустых&nbsp;вокселей&nbsp;и&nbsp;добавляет<br>
&nbsp;&nbsp;&nbsp;&nbsp;MeshRenderer&nbsp;к&nbsp;parent&nbsp;entity.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Цвета&nbsp;для&nbsp;разных&nbsp;типов&nbsp;вокселей<br>
&nbsp;&nbsp;&nbsp;&nbsp;TYPE_COLORS&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;(0.2,&nbsp;0.6,&nbsp;1.0,&nbsp;0.7),&nbsp;&nbsp;&nbsp;#&nbsp;Синий&nbsp;—&nbsp;обычный<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:&nbsp;(0.2,&nbsp;1.0,&nbsp;0.3,&nbsp;0.7),&nbsp;&nbsp;&nbsp;#&nbsp;Зелёный&nbsp;—&nbsp;поверхностный<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:&nbsp;(1.0,&nbsp;0.3,&nbsp;0.2,&nbsp;0.7),&nbsp;&nbsp;&nbsp;#&nbsp;Красный&nbsp;—&nbsp;внутренний<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;DEFAULT_COLOR&nbsp;=&nbsp;(0.5,&nbsp;0.5,&nbsp;0.5,&nbsp;0.7)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;grid:&nbsp;&quot;VoxelGrid&quot;,&nbsp;parent_entity:&nbsp;&quot;Entity&quot;)&nbsp;-&gt;&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._grid&nbsp;=&nbsp;grid<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._parent&nbsp;=&nbsp;parent_entity<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._mesh:&nbsp;Optional[TcMesh]&nbsp;=&nbsp;None<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._renderer:&nbsp;Optional[MeshRenderer]&nbsp;=&nbsp;None<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._material&nbsp;=&nbsp;Material(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color=(0.2,&nbsp;0.6,&nbsp;1.0,&nbsp;0.7),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;phase_mark=&quot;editor&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;rebuild(self)&nbsp;-&gt;&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Перестроить&nbsp;меш&nbsp;визуализации.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._cleanup_renderer()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;voxel_count&nbsp;=&nbsp;self._grid.voxel_count<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;voxel_count&nbsp;==&nbsp;0:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Ограничение&nbsp;для&nbsp;производительности<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_voxels&nbsp;=&nbsp;100_000<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;voxel_count&nbsp;&gt;&nbsp;max_voxels:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(f&quot;VoxelVisualizer:&nbsp;too&nbsp;many&nbsp;voxels&nbsp;({voxel_count}),&nbsp;showing&nbsp;first&nbsp;{max_voxels}&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;voxel_count&nbsp;=&nbsp;max_voxels<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Выделяем&nbsp;массивы<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertices&nbsp;=&nbsp;np.zeros((voxel_count&nbsp;*&nbsp;VERTS_PER_CUBE,&nbsp;3),&nbsp;dtype=np.float32)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;triangles&nbsp;=&nbsp;np.zeros((voxel_count&nbsp;*&nbsp;TRIS_PER_CUBE,&nbsp;3),&nbsp;dtype=np.int32)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;normals&nbsp;=&nbsp;np.zeros((voxel_count&nbsp;*&nbsp;VERTS_PER_CUBE,&nbsp;3),&nbsp;dtype=np.float32)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cell_size&nbsp;=&nbsp;self._grid.cell_size<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;=&nbsp;0<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;vx,&nbsp;vy,&nbsp;vz,&nbsp;vtype&nbsp;in&nbsp;self._grid.iter_non_empty():<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;idx&nbsp;&gt;=&nbsp;max_voxels:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Мировая&nbsp;позиция&nbsp;центра&nbsp;вокселя<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;center&nbsp;=&nbsp;self._grid.voxel_to_world(vx,&nbsp;vy,&nbsp;vz)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Смещаем&nbsp;и&nbsp;масштабируем&nbsp;вершины&nbsp;куба<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v_start&nbsp;=&nbsp;idx&nbsp;*&nbsp;VERTS_PER_CUBE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v_end&nbsp;=&nbsp;v_start&nbsp;+&nbsp;VERTS_PER_CUBE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertices[v_start:v_end]&nbsp;=&nbsp;_CUBE_VERTICES&nbsp;*&nbsp;(cell_size&nbsp;*&nbsp;CUBE_SCALE)&nbsp;+&nbsp;center<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;normals[v_start:v_end]&nbsp;=&nbsp;_CUBE_NORMALS<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Смещаем&nbsp;индексы&nbsp;треугольников<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t_start&nbsp;=&nbsp;idx&nbsp;*&nbsp;TRIS_PER_CUBE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t_end&nbsp;=&nbsp;t_start&nbsp;+&nbsp;TRIS_PER_CUBE<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;triangles[t_start:t_end]&nbsp;=&nbsp;_CUBE_TRIANGLES&nbsp;+&nbsp;v_start<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idx&nbsp;+=&nbsp;1<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Обрезаем&nbsp;если&nbsp;меньше&nbsp;max_voxels<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;idx&nbsp;&lt;&nbsp;max_voxels:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertices&nbsp;=&nbsp;vertices[:idx&nbsp;*&nbsp;VERTS_PER_CUBE]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;triangles&nbsp;=&nbsp;triangles[:idx&nbsp;*&nbsp;TRIS_PER_CUBE]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;normals&nbsp;=&nbsp;normals[:idx&nbsp;*&nbsp;VERTS_PER_CUBE]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.voxels.voxel_mesh&nbsp;import&nbsp;create_voxel_mesh<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._mesh&nbsp;=&nbsp;create_voxel_mesh(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertices=vertices,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;triangles=triangles,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vertex_normals=normals,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;voxel_grid_vis&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._renderer&nbsp;=&nbsp;MeshRenderer(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._mesh,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._material,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast_shadow=False,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._parent.add_component(self._renderer)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;cleanup(self)&nbsp;-&gt;&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Удалить&nbsp;визуализацию.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._cleanup_renderer()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;_cleanup_renderer(self)&nbsp;-&gt;&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Удалить&nbsp;текущий&nbsp;renderer&nbsp;если&nbsp;есть.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self._renderer&nbsp;is&nbsp;not&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._parent.remove_component(self._renderer)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._renderer&nbsp;=&nbsp;None<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._mesh&nbsp;=&nbsp;None<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;set_color(self,&nbsp;color:&nbsp;tuple[float,&nbsp;float,&nbsp;float,&nbsp;float])&nbsp;-&gt;&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Установить&nbsp;цвет&nbsp;визуализации.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._material&nbsp;=&nbsp;Material(color=color,&nbsp;phase_mark=&quot;editor&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self._renderer&nbsp;is&nbsp;not&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._renderer.material&nbsp;=&nbsp;self._material<br>
<!-- END SCAT CODE -->
</body>
</html>
