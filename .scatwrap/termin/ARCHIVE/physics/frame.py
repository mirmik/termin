<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/ARCHIVE/physics/frame.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
import&nbsp;numpy&nbsp;as&nbsp;np<br>
from&nbsp;termin.physics.screw_commutator&nbsp;import&nbsp;ScrewCommutator<br>
from&nbsp;termin.ga201.screw&nbsp;import&nbsp;Screw2<br>
from&nbsp;termin.physics.pose_object&nbsp;import&nbsp;ReferencedPoseObject,&nbsp;PoseObject<br>
<br>
class&nbsp;Frame:<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;pose_object,&nbsp;screws):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._pose_object&nbsp;=&nbsp;pose_object<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._screw_commutator&nbsp;=&nbsp;ScrewCommutator(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_senses=screws,&nbsp;pose_object=self._pose_object)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;screw_commutator(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self._screw_commutator<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;commutator(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self._screw_commutator<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;derivative_by_frame(self,&nbsp;other):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.screw_commutator().derivative(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;other.screw_commutator())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;def&nbsp;global_derivative_by_frame(self,&nbsp;other):<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.screw_commutator().derivative(<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;other.screw_commutator())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;position(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self._pose_object.position()<br>
<br>
class&nbsp;MultiFrame(Frame):<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._frames&nbsp;=&nbsp;[]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;add_frame(self,&nbsp;frame):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._frames.append(frame)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;derivative_by_frame(self,&nbsp;other):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list_of_derivatives&nbsp;=&nbsp;[]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;frame&nbsp;in&nbsp;self._frames:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;der&nbsp;=&nbsp;frame.derivative_by_frame(other).matrix<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list_of_derivatives.append(der)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#print(der)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;np.concatenate(list_of_derivatives,&nbsp;axis=0)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;outkernel_operator_by_frame(self,&nbsp;frame):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;derivative&nbsp;=&nbsp;self.derivative_by_frame(frame)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;derivative&nbsp;@&nbsp;np.linalg.pinv(derivative)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;kernel_operator_by_frame(self,&nbsp;frame):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outkernel&nbsp;=&nbsp;self.outkernel_operator_by_frame(frame)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;np.eye(outkernel.shape[0])&nbsp;-&nbsp;outkernel<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
class&nbsp;ReferencedFrame(Frame):<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;linked_body,&nbsp;position_in_body,&nbsp;senses):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._parent&nbsp;=&nbsp;linked_body<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pose_object&nbsp;=&nbsp;ReferencedPoseObject(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent=linked_body._pose_object,&nbsp;pose=position_in_body)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super().__init__(pose_object=pose_object,&nbsp;screws=senses)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;current_position(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.position()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;right_velocity(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent_right_velocity&nbsp;=&nbsp;self._parent.right_velocity()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carried&nbsp;=&nbsp;parent_right_velocity.kinematic_carry(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._pose_object.relative_position())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;carried<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;right_velocity_global(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right_velocity&nbsp;=&nbsp;self.right_velocity()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotated&nbsp;=&nbsp;right_velocity.rotate_by(self.position())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;rotated<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;right_acceleration(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent_right_acceleration&nbsp;=&nbsp;self._parent.right_acceleration()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carried&nbsp;=&nbsp;parent_right_acceleration.kinematic_carry(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._pose_object.relative_position())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;carried<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;right_acceleration_global(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right_acceleration&nbsp;=&nbsp;self.right_acceleration()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotated&nbsp;=&nbsp;right_acceleration.rotate_by(self.position())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;rotated<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<!-- END SCAT CODE -->
</body>
</html>
