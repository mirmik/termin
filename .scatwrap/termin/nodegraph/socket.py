<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/nodegraph/socket.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
&quot;&quot;&quot;NodeSocket&nbsp;-&nbsp;connection&nbsp;points&nbsp;on&nbsp;nodes.&quot;&quot;&quot;<br>
<br>
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
<br>
from&nbsp;typing&nbsp;import&nbsp;TYPE_CHECKING,&nbsp;Optional,&nbsp;List<br>
<br>
from&nbsp;PyQt6.QtGui&nbsp;import&nbsp;QColor<br>
<br>
if&nbsp;TYPE_CHECKING:<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.nodegraph.node&nbsp;import&nbsp;GraphNode<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.nodegraph.connection&nbsp;import&nbsp;NodeConnection<br>
<br>
<br>
class&nbsp;NodeSocket:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;connection&nbsp;point&nbsp;on&nbsp;a&nbsp;node.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Sockets&nbsp;can&nbsp;be&nbsp;inputs&nbsp;(left&nbsp;side)&nbsp;or&nbsp;outputs&nbsp;(right&nbsp;side).<br>
&nbsp;&nbsp;&nbsp;&nbsp;Each&nbsp;socket&nbsp;has&nbsp;a&nbsp;data&nbsp;type&nbsp;that&nbsp;determines&nbsp;compatible&nbsp;connections.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Socket&nbsp;type&nbsp;colors<br>
&nbsp;&nbsp;&nbsp;&nbsp;TYPE_COLORS&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;fbo&quot;:&nbsp;QColor(100,&nbsp;180,&nbsp;100),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Green&nbsp;-&nbsp;framebuffer<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;texture&quot;:&nbsp;QColor(180,&nbsp;150,&nbsp;100),&nbsp;&nbsp;&nbsp;#&nbsp;Orange&nbsp;-&nbsp;texture<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;shadow&quot;:&nbsp;QColor(80,&nbsp;80,&nbsp;120),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Purple&nbsp;-&nbsp;shadow&nbsp;maps<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;any&quot;:&nbsp;QColor(150,&nbsp;150,&nbsp;150),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Gray&nbsp;-&nbsp;any&nbsp;type<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;flow&quot;:&nbsp;QColor(200,&nbsp;200,&nbsp;200),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;White&nbsp;-&nbsp;execution&nbsp;flow<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;str,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;socket_type:&nbsp;str&nbsp;=&nbsp;&quot;any&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multi:&nbsp;bool&nbsp;=&nbsp;False,<br>
&nbsp;&nbsp;&nbsp;&nbsp;):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;Display&nbsp;name&nbsp;of&nbsp;the&nbsp;socket<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;socket_type:&nbsp;Data&nbsp;type&nbsp;(&quot;fbo&quot;,&nbsp;&quot;texture&quot;,&nbsp;&quot;shadow&quot;,&nbsp;&quot;any&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multi:&nbsp;Whether&nbsp;multiple&nbsp;connections&nbsp;are&nbsp;allowed<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.name&nbsp;=&nbsp;name<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.socket_type&nbsp;=&nbsp;socket_type<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.multi&nbsp;=&nbsp;multi<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Set&nbsp;by&nbsp;parent&nbsp;node<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.node:&nbsp;Optional[GraphNode]&nbsp;=&nbsp;None<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.is_input:&nbsp;bool&nbsp;=&nbsp;True<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.index:&nbsp;int&nbsp;=&nbsp;0<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Connections<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.connections:&nbsp;List[NodeConnection]&nbsp;=&nbsp;[]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;@property<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;color(self)&nbsp;-&gt;&nbsp;QColor:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Get&nbsp;socket&nbsp;color&nbsp;based&nbsp;on&nbsp;type.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.TYPE_COLORS.get(self.socket_type,&nbsp;self.TYPE_COLORS[&quot;any&quot;])<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;can_connect_to(self,&nbsp;other:&nbsp;&quot;NodeSocket&quot;)&nbsp;-&gt;&nbsp;bool:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Check&nbsp;if&nbsp;this&nbsp;socket&nbsp;can&nbsp;connect&nbsp;to&nbsp;another.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Can't&nbsp;connect&nbsp;to&nbsp;same&nbsp;node<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self.node&nbsp;is&nbsp;other.node:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;False<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Can't&nbsp;connect&nbsp;input&nbsp;to&nbsp;input&nbsp;or&nbsp;output&nbsp;to&nbsp;output<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self.is_input&nbsp;==&nbsp;other.is_input:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;False<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Check&nbsp;type&nbsp;compatibility<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self.socket_type&nbsp;==&nbsp;&quot;any&quot;&nbsp;or&nbsp;other.socket_type&nbsp;==&nbsp;&quot;any&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;True<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.socket_type&nbsp;==&nbsp;other.socket_type<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;add_connection(self,&nbsp;connection:&nbsp;&quot;NodeConnection&quot;)&nbsp;-&gt;&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Add&nbsp;a&nbsp;connection&nbsp;to&nbsp;this&nbsp;socket.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Output&nbsp;sockets&nbsp;always&nbsp;allow&nbsp;multiple&nbsp;connections&nbsp;(fan-out)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Input&nbsp;sockets&nbsp;respect&nbsp;the&nbsp;multi&nbsp;flag&nbsp;(fan-in)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;self.is_input&nbsp;and&nbsp;not&nbsp;self.multi:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Remove&nbsp;existing&nbsp;connections&nbsp;for&nbsp;single-connection&nbsp;input&nbsp;sockets<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;conn&nbsp;in&nbsp;self.connections[:]:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn.remove()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.connections.append(connection)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;remove_connection(self,&nbsp;connection:&nbsp;&quot;NodeConnection&quot;)&nbsp;-&gt;&nbsp;None:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Remove&nbsp;a&nbsp;connection&nbsp;from&nbsp;this&nbsp;socket.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;connection&nbsp;in&nbsp;self.connections:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.connections.remove(connection)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;is_connected(self)&nbsp;-&gt;&nbsp;bool:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Check&nbsp;if&nbsp;socket&nbsp;has&nbsp;any&nbsp;connections.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;len(self.connections)&nbsp;&gt;&nbsp;0<br>
<!-- END SCAT CODE -->
</body>
</html>
