<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>termin/nodegraph/nodes.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
&quot;&quot;&quot;Node&nbsp;factory&nbsp;and&nbsp;predefined&nbsp;node&nbsp;types.&quot;&quot;&quot;<br>
<br>
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
<br>
from&nbsp;typing&nbsp;import&nbsp;List<br>
<br>
from&nbsp;termin.nodegraph.node&nbsp;import&nbsp;GraphNode,&nbsp;NodeParam<br>
from&nbsp;termin.nodegraph.socket&nbsp;import&nbsp;NodeSocket<br>
from&nbsp;termin.nodegraph.pass_registry&nbsp;import&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;create_params_from_pass,<br>
&nbsp;&nbsp;&nbsp;&nbsp;get_pass_categories,<br>
&nbsp;&nbsp;&nbsp;&nbsp;get_pass_sockets,<br>
&nbsp;&nbsp;&nbsp;&nbsp;get_pass_inplace_pairs,<br>
)<br>
<br>
<br>
#&nbsp;Maps&nbsp;node&nbsp;title&nbsp;to&nbsp;pass&nbsp;class&nbsp;name&nbsp;(when&nbsp;they&nbsp;differ)<br>
TITLE_TO_PASS_CLASS&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;SkyboxPass&quot;:&nbsp;&quot;SkyBoxPass&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;PostProcess&quot;:&nbsp;&quot;PostProcessPass&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;Present&quot;:&nbsp;&quot;PresentToScreenPass&quot;,<br>
}<br>
<br>
<br>
def&nbsp;_get_pass_class_name(title:&nbsp;str)&nbsp;-&gt;&nbsp;str:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Get&nbsp;pass&nbsp;class&nbsp;name&nbsp;from&nbsp;node&nbsp;title.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TITLE_TO_PASS_CLASS.get(title,&nbsp;title)<br>
<br>
<br>
def&nbsp;_get_dynamic_params(pass_class_name:&nbsp;str)&nbsp;-&gt;&nbsp;List[NodeParam]:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Try&nbsp;to&nbsp;get&nbsp;parameters&nbsp;dynamically&nbsp;from&nbsp;the&nbsp;pass&nbsp;class's&nbsp;inspect_fields.<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns&nbsp;empty&nbsp;list&nbsp;if&nbsp;class&nbsp;not&nbsp;found&nbsp;or&nbsp;no&nbsp;inspect_fields.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;create_params_from_pass(pass_class_name)<br>
<br>
<br>
def&nbsp;create_node(node_type:&nbsp;str,&nbsp;title:&nbsp;str)&nbsp;-&gt;&nbsp;GraphNode:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Factory&nbsp;function&nbsp;to&nbsp;create&nbsp;nodes&nbsp;by&nbsp;type.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;node_type&nbsp;==&nbsp;&quot;resource&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;create_resource_node(title)<br>
&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;node_type&nbsp;==&nbsp;&quot;pass&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;create_pass_node(title)<br>
&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;node_type&nbsp;==&nbsp;&quot;effect&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;create_effect_node(title)<br>
&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;node_type&nbsp;==&nbsp;&quot;viewport&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;create_viewport_node(title)<br>
&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;GraphNode(title,&nbsp;node_type)<br>
<br>
<br>
def&nbsp;create_resource_node(title:&nbsp;str)&nbsp;-&gt;&nbsp;GraphNode:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;a&nbsp;resource&nbsp;node&nbsp;(FBO&nbsp;or&nbsp;Shadow&nbsp;Maps).&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;title&nbsp;==&nbsp;&quot;Shadow&nbsp;Maps&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;_create_shadow_maps_node()<br>
&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;_create_fbo_node(title)<br>
<br>
<br>
def&nbsp;_create_shadow_maps_node()&nbsp;-&gt;&nbsp;GraphNode:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;a&nbsp;Shadow&nbsp;Maps&nbsp;resource&nbsp;node.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;node&nbsp;=&nbsp;GraphNode(&quot;Shadow&nbsp;Maps&quot;,&nbsp;&quot;resource&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_output(NodeSocket(&quot;shadow&quot;,&nbsp;&quot;shadow&quot;))<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.data[&quot;resource_type&quot;]&nbsp;=&nbsp;&quot;shadow_map_array&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.data[&quot;resource_name&quot;]&nbsp;=&nbsp;&quot;shadow_maps&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;node<br>
<br>
<br>
def&nbsp;_create_fbo_node(title:&nbsp;str&nbsp;=&nbsp;&quot;FBO&quot;)&nbsp;-&gt;&nbsp;GraphNode:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;an&nbsp;FBO&nbsp;resource&nbsp;node&nbsp;with&nbsp;configurable&nbsp;parameters.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;node&nbsp;=&nbsp;GraphNode(title,&nbsp;&quot;resource&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Single&nbsp;FBO&nbsp;output<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_output(NodeSocket(&quot;fbo&quot;,&nbsp;&quot;fbo&quot;))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.data[&quot;resource_type&quot;]&nbsp;=&nbsp;&quot;fbo&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Format&nbsp;parameter<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;format&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;Format&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;choice&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=&quot;rgba8&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choices=[&quot;rgba8&quot;,&nbsp;&quot;rgba16f&quot;,&nbsp;&quot;rgba32f&quot;,&nbsp;&quot;r16f&quot;,&nbsp;&quot;r32f&quot;],<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;MSAA&nbsp;samples<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;samples&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;MSAA&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;choice&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=&quot;1&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choices=[&quot;1&quot;,&nbsp;&quot;2&quot;,&nbsp;&quot;4&quot;,&nbsp;&quot;8&quot;],<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Texture&nbsp;filter&nbsp;mode<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;filter&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;Filter&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;choice&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=&quot;linear&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choices=[&quot;linear&quot;,&nbsp;&quot;nearest&quot;],<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Size&nbsp;mode:&nbsp;viewport&nbsp;(use&nbsp;viewport&nbsp;size&nbsp;*&nbsp;scale)&nbsp;or&nbsp;fixed<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;size_mode&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;Size&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;choice&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=&quot;viewport&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choices=[&quot;viewport&quot;,&nbsp;&quot;fixed&quot;],<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Scale&nbsp;for&nbsp;viewport&nbsp;mode&nbsp;(0.25,&nbsp;0.5,&nbsp;1.0,&nbsp;2.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;scale&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;Scale&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;choice&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=&quot;1.0&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choices=[&quot;0.25&quot;,&nbsp;&quot;0.5&quot;,&nbsp;&quot;1.0&quot;,&nbsp;&quot;2.0&quot;],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;visible_when={&quot;size_mode&quot;:&nbsp;&quot;viewport&quot;},<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Fixed&nbsp;width&nbsp;(for&nbsp;fixed&nbsp;mode)<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;width&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;Width&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;int&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=1024,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_val=1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_val=65536,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;visible_when={&quot;size_mode&quot;:&nbsp;&quot;fixed&quot;},<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Fixed&nbsp;height&nbsp;(for&nbsp;fixed&nbsp;mode)<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;height&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;Height&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;int&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=1024,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_val=1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_val=65536,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;visible_when={&quot;size_mode&quot;:&nbsp;&quot;fixed&quot;},<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Color&nbsp;buffer<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;has_color&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;Color&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;bool&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=True,<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Depth&nbsp;buffer<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;has_depth&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;Depth&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;bool&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=True,<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Clear&nbsp;color&nbsp;flag<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;clear_color&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;Clear&nbsp;Color&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;bool&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=False,<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Clear&nbsp;color&nbsp;RGBA&nbsp;values<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;clear_color_r&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;R&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;float&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=0.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_val=0.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_val=1.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;visible_when={&quot;clear_color&quot;:&nbsp;True},<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;clear_color_g&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;G&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;float&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=0.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_val=0.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_val=1.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;visible_when={&quot;clear_color&quot;:&nbsp;True},<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;clear_color_b&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;B&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;float&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=0.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_val=0.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_val=1.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;visible_when={&quot;clear_color&quot;:&nbsp;True},<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;clear_color_a&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;A&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;float&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=1.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_val=0.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_val=1.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;visible_when={&quot;clear_color&quot;:&nbsp;True},<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Clear&nbsp;depth&nbsp;flag<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;clear_depth&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;Clear&nbsp;Depth&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;bool&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=False,<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Clear&nbsp;depth&nbsp;value<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(NodeParam(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=&quot;clear_depth_value&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=&quot;Depth&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param_type=&quot;float&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default=1.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min_val=0.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_val=1.0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;visible_when={&quot;clear_depth&quot;:&nbsp;True},<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;node<br>
<br>
<br>
def&nbsp;create_pass_node(title:&nbsp;str)&nbsp;-&gt;&nbsp;GraphNode:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;a&nbsp;render&nbsp;pass&nbsp;node.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;node&nbsp;=&nbsp;GraphNode(title,&nbsp;&quot;pass&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;pass_class_name&nbsp;=&nbsp;_get_pass_class_name(title)<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.data[&quot;pass_class&quot;]&nbsp;=&nbsp;pass_class_name<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Get&nbsp;sockets&nbsp;and&nbsp;inplace&nbsp;pairs&nbsp;from&nbsp;pass&nbsp;class<br>
&nbsp;&nbsp;&nbsp;&nbsp;inputs,&nbsp;outputs&nbsp;=&nbsp;get_pass_sockets(pass_class_name)<br>
&nbsp;&nbsp;&nbsp;&nbsp;inplace_pairs&nbsp;=&nbsp;get_pass_inplace_pairs(pass_class_name)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Build&nbsp;set&nbsp;of&nbsp;inplace&nbsp;output&nbsp;names&nbsp;for&nbsp;quick&nbsp;lookup<br>
&nbsp;&nbsp;&nbsp;&nbsp;inplace_outputs&nbsp;=&nbsp;{out_name&nbsp;for&nbsp;_,&nbsp;out_name&nbsp;in&nbsp;inplace_pairs}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Add&nbsp;regular&nbsp;input&nbsp;sockets<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;param_name,&nbsp;socket_type&nbsp;in&nbsp;inputs:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node.add_input(NodeSocket(param_name,&nbsp;socket_type))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Add&nbsp;output&nbsp;sockets&nbsp;and&nbsp;target&nbsp;inputs&nbsp;for&nbsp;non-inplace&nbsp;outputs<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;param_name,&nbsp;socket_type&nbsp;in&nbsp;outputs:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node.add_output(NodeSocket(param_name,&nbsp;socket_type))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;this&nbsp;output&nbsp;is&nbsp;NOT&nbsp;inplace,&nbsp;add&nbsp;a&nbsp;target&nbsp;input&nbsp;socket<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;(if&nbsp;nothing&nbsp;connected&nbsp;-&nbsp;auto-create&nbsp;FBO)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;param_name&nbsp;not&nbsp;in&nbsp;inplace_outputs:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target_socket&nbsp;=&nbsp;NodeSocket(f&quot;{param_name}_target&quot;,&nbsp;socket_type)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node.add_input(target_socket)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Store&nbsp;inplace&nbsp;pairs&nbsp;in&nbsp;node&nbsp;data&nbsp;for&nbsp;visualization<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.data[&quot;inplace_pairs&quot;]&nbsp;=&nbsp;inplace_pairs<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Get&nbsp;parameters&nbsp;dynamically&nbsp;from&nbsp;pass&nbsp;class&nbsp;inspect_fields<br>
&nbsp;&nbsp;&nbsp;&nbsp;dynamic_params&nbsp;=&nbsp;_get_dynamic_params(pass_class_name)<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;param&nbsp;in&nbsp;dynamic_params:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(param)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;node<br>
<br>
<br>
def&nbsp;create_effect_node(title:&nbsp;str)&nbsp;-&gt;&nbsp;GraphNode:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;a&nbsp;post-effect&nbsp;pass&nbsp;node.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;node&nbsp;=&nbsp;GraphNode(title,&nbsp;&quot;effect&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;pass_class_name&nbsp;=&nbsp;_get_pass_class_name(title)<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.data[&quot;pass_class&quot;]&nbsp;=&nbsp;pass_class_name<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Get&nbsp;sockets&nbsp;and&nbsp;inplace&nbsp;pairs&nbsp;from&nbsp;pass&nbsp;class<br>
&nbsp;&nbsp;&nbsp;&nbsp;inputs,&nbsp;outputs&nbsp;=&nbsp;get_pass_sockets(pass_class_name)<br>
&nbsp;&nbsp;&nbsp;&nbsp;inplace_pairs&nbsp;=&nbsp;get_pass_inplace_pairs(pass_class_name)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Build&nbsp;set&nbsp;of&nbsp;inplace&nbsp;output&nbsp;names&nbsp;for&nbsp;quick&nbsp;lookup<br>
&nbsp;&nbsp;&nbsp;&nbsp;inplace_outputs&nbsp;=&nbsp;{out_name&nbsp;for&nbsp;_,&nbsp;out_name&nbsp;in&nbsp;inplace_pairs}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Add&nbsp;regular&nbsp;input&nbsp;sockets<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;param_name,&nbsp;socket_type&nbsp;in&nbsp;inputs:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node.add_input(NodeSocket(param_name,&nbsp;socket_type))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Add&nbsp;output&nbsp;sockets&nbsp;and&nbsp;target&nbsp;inputs&nbsp;for&nbsp;non-inplace&nbsp;outputs<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;param_name,&nbsp;socket_type&nbsp;in&nbsp;outputs:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node.add_output(NodeSocket(param_name,&nbsp;socket_type))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;this&nbsp;output&nbsp;is&nbsp;NOT&nbsp;inplace,&nbsp;add&nbsp;a&nbsp;target&nbsp;input&nbsp;socket<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;(if&nbsp;nothing&nbsp;connected&nbsp;-&nbsp;auto-create&nbsp;FBO)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;param_name&nbsp;not&nbsp;in&nbsp;inplace_outputs:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target_socket&nbsp;=&nbsp;NodeSocket(f&quot;{param_name}_target&quot;,&nbsp;socket_type)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node.add_input(target_socket)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Store&nbsp;inplace&nbsp;pairs&nbsp;in&nbsp;node&nbsp;data&nbsp;for&nbsp;visualization<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.data[&quot;inplace_pairs&quot;]&nbsp;=&nbsp;inplace_pairs<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Get&nbsp;parameters&nbsp;dynamically&nbsp;from&nbsp;pass&nbsp;class&nbsp;inspect_fields<br>
&nbsp;&nbsp;&nbsp;&nbsp;dynamic_params&nbsp;=&nbsp;_get_dynamic_params(pass_class_name)<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;param&nbsp;in&nbsp;dynamic_params:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node.add_param(param)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;node<br>
<br>
<br>
def&nbsp;create_viewport_node(title:&nbsp;str)&nbsp;-&gt;&nbsp;GraphNode:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Create&nbsp;a&nbsp;viewport&nbsp;output&nbsp;node.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;node&nbsp;=&nbsp;GraphNode(title,&nbsp;&quot;viewport&quot;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Viewport&nbsp;is&nbsp;a&nbsp;sink&nbsp;-&nbsp;it&nbsp;receives&nbsp;the&nbsp;final&nbsp;image<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_input(NodeSocket(&quot;color&quot;,&nbsp;&quot;fbo&quot;))<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_input(NodeSocket(&quot;id&quot;,&nbsp;&quot;texture&quot;))&nbsp;&nbsp;#&nbsp;For&nbsp;picking<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.add_input(NodeSocket(&quot;depth&quot;,&nbsp;&quot;texture&quot;))&nbsp;&nbsp;#&nbsp;Optional<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;node.data[&quot;viewport_name&quot;]&nbsp;=&nbsp;&quot;default&quot;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Viewport&nbsp;doesn't&nbsp;need&nbsp;params&nbsp;-&nbsp;use&nbsp;ViewportFrame&nbsp;for&nbsp;that<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;node<br>
<br>
<br>
def&nbsp;get_available_passes_by_category()&nbsp;-&gt;&nbsp;dict[str,&nbsp;list[str]]:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Get&nbsp;available&nbsp;passes&nbsp;organized&nbsp;by&nbsp;category&nbsp;for&nbsp;context&nbsp;menus.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Returns&nbsp;dict&nbsp;of&nbsp;category&nbsp;-&gt;&nbsp;list&nbsp;of&nbsp;pass&nbsp;class&nbsp;names.<br>
&nbsp;&nbsp;&nbsp;&nbsp;Falls&nbsp;back&nbsp;to&nbsp;hardcoded&nbsp;list&nbsp;if&nbsp;registry&nbsp;is&nbsp;unavailable.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;categories&nbsp;=&nbsp;get_pass_categories()<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;categories<br>
<br>
<br>
def&nbsp;create_pass_node_by_class(class_name:&nbsp;str)&nbsp;-&gt;&nbsp;GraphNode:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;a&nbsp;pass&nbsp;node&nbsp;from&nbsp;the&nbsp;registered&nbsp;class&nbsp;name.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Uses&nbsp;the&nbsp;pass&nbsp;class&nbsp;to&nbsp;determine&nbsp;node&nbsp;type&nbsp;and&nbsp;parameters.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Determine&nbsp;if&nbsp;this&nbsp;is&nbsp;an&nbsp;effect&nbsp;pass&nbsp;or&nbsp;regular&nbsp;pass<br>
&nbsp;&nbsp;&nbsp;&nbsp;effect_passes&nbsp;=&nbsp;{&quot;BloomPass&quot;,&nbsp;&quot;GrayscalePass&quot;,&nbsp;&quot;MaterialPass&quot;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;class_name&nbsp;in&nbsp;effect_passes:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;create_effect_node(class_name)<br>
&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;create_pass_node(class_name)<br>
<!-- END SCAT CODE -->
</body>
</html>
