<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>examples/visual/ui_text.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
&quot;&quot;&quot;Text&nbsp;rendering&nbsp;demo:&nbsp;UI&nbsp;text&nbsp;overlay&nbsp;on&nbsp;a&nbsp;3D&nbsp;scene.&quot;&quot;&quot;<br>
<br>
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
import&nbsp;numpy&nbsp;as&nbsp;np<br>
<br>
from&nbsp;termin.geombase&nbsp;import&nbsp;Pose3<br>
from&nbsp;termin.mesh.mesh&nbsp;import&nbsp;CubeMesh<br>
from&nbsp;termin.visualization&nbsp;import&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;Entity,<br>
&nbsp;&nbsp;&nbsp;&nbsp;MeshDrawable,<br>
&nbsp;&nbsp;&nbsp;&nbsp;Scene,<br>
&nbsp;&nbsp;&nbsp;&nbsp;Material,<br>
&nbsp;&nbsp;&nbsp;&nbsp;VisualizationWorld,<br>
&nbsp;&nbsp;&nbsp;&nbsp;PerspectiveCameraComponent,<br>
&nbsp;&nbsp;&nbsp;&nbsp;OrbitCameraController,<br>
)<br>
from&nbsp;termin.visualization.render.components&nbsp;import&nbsp;MeshRenderer<br>
from&nbsp;termin._native.render&nbsp;import&nbsp;TcShader<br>
from&nbsp;termin.visualization.ui&nbsp;import&nbsp;Canvas,&nbsp;UIRectangle<br>
from&nbsp;termin.visualization.ui.elements&nbsp;import&nbsp;UIText<br>
from&nbsp;termin.visualization.ui.font&nbsp;import&nbsp;FontTextureAtlas<br>
<br>
<br>
VERT&nbsp;=&nbsp;&quot;&quot;&quot;<br>
#version&nbsp;330&nbsp;core<br>
layout(location=0)&nbsp;in&nbsp;vec3&nbsp;a_position;<br>
layout(location=1)&nbsp;in&nbsp;vec3&nbsp;a_normal;<br>
<br>
uniform&nbsp;mat4&nbsp;u_model;<br>
uniform&nbsp;mat4&nbsp;u_view;<br>
uniform&nbsp;mat4&nbsp;u_projection;<br>
<br>
out&nbsp;vec3&nbsp;v_normal;<br>
<br>
void&nbsp;main()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;v_normal&nbsp;=&nbsp;mat3(transpose(inverse(u_model)))&nbsp;*&nbsp;a_normal;<br>
&nbsp;&nbsp;&nbsp;&nbsp;gl_Position&nbsp;=&nbsp;u_projection&nbsp;*&nbsp;u_view&nbsp;*&nbsp;u_model&nbsp;*&nbsp;vec4(a_position,&nbsp;1.0);<br>
}<br>
&quot;&quot;&quot;<br>
<br>
FRAG&nbsp;=&nbsp;&quot;&quot;&quot;<br>
#version&nbsp;330&nbsp;core<br>
in&nbsp;vec3&nbsp;v_normal;<br>
uniform&nbsp;vec4&nbsp;u_color;<br>
uniform&nbsp;vec3&nbsp;u_light_dir;<br>
out&nbsp;vec4&nbsp;FragColor;<br>
<br>
void&nbsp;main()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;N&nbsp;=&nbsp;normalize(v_normal);<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;ndotl&nbsp;=&nbsp;max(dot(N,&nbsp;-normalize(u_light_dir)),&nbsp;0.0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;color&nbsp;=&nbsp;u_color.rgb&nbsp;*&nbsp;(0.2&nbsp;+&nbsp;0.8&nbsp;*&nbsp;ndotl);<br>
&nbsp;&nbsp;&nbsp;&nbsp;FragColor&nbsp;=&nbsp;vec4(color,&nbsp;u_color.a);<br>
}<br>
&quot;&quot;&quot;<br>
<br>
&quot;&quot;&quot;Standard&nbsp;UI&nbsp;shader&nbsp;sources&nbsp;(position&nbsp;+&nbsp;optional&nbsp;texturing).&quot;&quot;&quot;<br>
<br>
UI_VERTEX_SHADER&nbsp;=&nbsp;&quot;&quot;&quot;<br>
#version&nbsp;330&nbsp;core<br>
layout(location=0)&nbsp;in&nbsp;vec2&nbsp;a_position;<br>
layout(location=1)&nbsp;in&nbsp;vec2&nbsp;a_uv;<br>
<br>
out&nbsp;vec2&nbsp;v_uv;<br>
<br>
void&nbsp;main(){<br>
&nbsp;&nbsp;&nbsp;&nbsp;v_uv&nbsp;=&nbsp;a_uv;<br>
&nbsp;&nbsp;&nbsp;&nbsp;gl_Position&nbsp;=&nbsp;vec4(a_position,&nbsp;0,&nbsp;1);<br>
}<br>
&quot;&quot;&quot;<br>
<br>
UI_FRAGMENT_SHADER&nbsp;=&nbsp;&quot;&quot;&quot;<br>
#version&nbsp;330&nbsp;core<br>
uniform&nbsp;sampler2D&nbsp;u_texture;<br>
uniform&nbsp;vec4&nbsp;u_color;<br>
uniform&nbsp;bool&nbsp;u_use_texture;<br>
<br>
in&nbsp;vec2&nbsp;v_uv;<br>
out&nbsp;vec4&nbsp;FragColor;<br>
<br>
void&nbsp;main(){<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;alpha&nbsp;=&nbsp;u_color.a;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(u_use_texture)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;При&nbsp;включённой&nbsp;текстуре&nbsp;берём&nbsp;альфа-канал&nbsp;из&nbsp;красного&nbsp;канала&nbsp;атласа<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alpha&nbsp;*=&nbsp;texture(u_texture,&nbsp;v_uv).r;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;FragColor&nbsp;=&nbsp;vec4(u_color.rgb,&nbsp;alpha);<br>
}<br>
&quot;&quot;&quot;<br>
<br>
<br>
<br>
def&nbsp;build_scene(world:&nbsp;VisualizationWorld):<br>
&nbsp;&nbsp;&nbsp;&nbsp;shader&nbsp;=&nbsp;TcShader.from_sources(VERT,&nbsp;FRAG,&nbsp;&quot;&quot;,&nbsp;&quot;UITextSceneShader&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;mat&nbsp;=&nbsp;Material(shader=shader,&nbsp;color=np.array([0.7,&nbsp;0.4,&nbsp;0.2,&nbsp;1.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;mesh&nbsp;=&nbsp;MeshDrawable(CubeMesh())<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube&nbsp;=&nbsp;Entity(pose=Pose3.identity(),&nbsp;name=&quot;cube&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube.add_component(MeshRenderer(mesh,&nbsp;mat))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene&nbsp;=&nbsp;Scene()<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene.add(cube)<br>
&nbsp;&nbsp;&nbsp;&nbsp;world.add_scene(scene)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;cam_e&nbsp;=&nbsp;Entity(name=&quot;camera&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;cam&nbsp;=&nbsp;PerspectiveCameraComponent()<br>
&nbsp;&nbsp;&nbsp;&nbsp;cam_e.add_component(cam)<br>
&nbsp;&nbsp;&nbsp;&nbsp;cam_e.add_component(OrbitCameraController(radius=5.0))<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene.add(cam_e)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;canvas&nbsp;=&nbsp;Canvas()<br>
&nbsp;&nbsp;&nbsp;&nbsp;ui_shader&nbsp;=&nbsp;TcShader.from_sources(UI_VERTEX_SHADER,&nbsp;UI_FRAGMENT_SHADER,&nbsp;&quot;&quot;,&nbsp;&quot;UITextShader&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;rect_material&nbsp;=&nbsp;Material(shader=ui_shader,&nbsp;color=np.array([1.0,&nbsp;1.0,&nbsp;1.0,&nbsp;1.0],&nbsp;dtype=np.float32),&nbsp;uniforms={&quot;u_use_texture&quot;:&nbsp;False})<br>
&nbsp;&nbsp;&nbsp;&nbsp;text_material&nbsp;=&nbsp;Material(shader=ui_shader,&nbsp;color=np.array([1.0,&nbsp;1.0,&nbsp;1.0,&nbsp;1.0],&nbsp;dtype=np.float32),&nbsp;uniforms={&quot;u_use_texture&quot;:&nbsp;True})<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;canvas.add(UIRectangle(position=(0.05,&nbsp;0.05),&nbsp;size=(0.3,&nbsp;0.1),&nbsp;color=(0,&nbsp;0,&nbsp;0,&nbsp;0.5),&nbsp;material=rect_material))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;canvas.font&nbsp;=&nbsp;FontTextureAtlas(&quot;examples/data/fonts/Roboto-Regular.ttf&quot;,&nbsp;size=32)<br>
&nbsp;&nbsp;&nbsp;&nbsp;canvas.add(UIText(&quot;Hello,&nbsp;world!&quot;,&nbsp;position=(0.07,&nbsp;0.07),&nbsp;color=(1,&nbsp;1,&nbsp;1,&nbsp;1),&nbsp;scale=1.0,&nbsp;material=text_material))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;scene,&nbsp;cam,&nbsp;canvas<br>
<br>
<br>
def&nbsp;main():<br>
&nbsp;&nbsp;&nbsp;&nbsp;world&nbsp;=&nbsp;VisualizationWorld()<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene,&nbsp;cam,&nbsp;canvas&nbsp;=&nbsp;build_scene(world)<br>
&nbsp;&nbsp;&nbsp;&nbsp;win&nbsp;=&nbsp;world.create_window(title=&quot;termin&nbsp;UI&nbsp;text&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;win.add_viewport(scene,&nbsp;cam,&nbsp;canvas=canvas)<br>
&nbsp;&nbsp;&nbsp;&nbsp;world.run()<br>
<br>
<br>
if&nbsp;__name__&nbsp;==&nbsp;&quot;__main__&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;main()<br>
<!-- END SCAT CODE -->
</body>
</html>
