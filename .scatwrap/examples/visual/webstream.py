<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>examples/visual/webstream.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
&quot;&quot;&quot;<br>
WebSocket&nbsp;стриминг&nbsp;демо.<br>
<br>
Рендерит&nbsp;сцену&nbsp;с&nbsp;кубом&nbsp;и&nbsp;стримит&nbsp;в&nbsp;браузер&nbsp;через&nbsp;WebSocket.<br>
Запуск:&nbsp;python&nbsp;examples/visual/webstream.py<br>
Открыть:&nbsp;http://localhost:8080<br>
&quot;&quot;&quot;<br>
<br>
from&nbsp;__future__&nbsp;import&nbsp;annotations<br>
<br>
import&nbsp;numpy&nbsp;as&nbsp;np<br>
<br>
from&nbsp;termin.geombase&nbsp;import&nbsp;Pose3<br>
from&nbsp;termin.mesh.mesh&nbsp;import&nbsp;CubeMesh<br>
from&nbsp;termin.visualization&nbsp;import&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;Entity,<br>
&nbsp;&nbsp;&nbsp;&nbsp;Scene,<br>
&nbsp;&nbsp;&nbsp;&nbsp;VisualizationWorld,<br>
&nbsp;&nbsp;&nbsp;&nbsp;PerspectiveCameraComponent,<br>
&nbsp;&nbsp;&nbsp;&nbsp;OrbitCameraController,<br>
)<br>
from&nbsp;termin.visualization.render.components&nbsp;import&nbsp;MeshRenderer<br>
from&nbsp;termin.visualization.render.materials.simple&nbsp;import&nbsp;ColorMaterial<br>
from&nbsp;termin.visualization.streaming&nbsp;import&nbsp;WebStreamServer<br>
<br>
<br>
def&nbsp;build_scene(world:&nbsp;VisualizationWorld)&nbsp;-&gt;&nbsp;tuple[Scene,&nbsp;PerspectiveCameraComponent]:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Создаёт&nbsp;сцену&nbsp;с&nbsp;кубом&nbsp;и&nbsp;камерой.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene&nbsp;=&nbsp;Scene()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Камера&nbsp;с&nbsp;орбитальным&nbsp;контроллером<br>
&nbsp;&nbsp;&nbsp;&nbsp;camera_entity&nbsp;=&nbsp;Entity(name=&quot;camera&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;camera&nbsp;=&nbsp;PerspectiveCameraComponent()<br>
&nbsp;&nbsp;&nbsp;&nbsp;camera_entity.add_component(camera)<br>
&nbsp;&nbsp;&nbsp;&nbsp;camera_entity.add_component(OrbitCameraController())<br>
&nbsp;&nbsp;&nbsp;&nbsp;camera_entity.transform.relocate(Pose3.looking_at(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eye=np.array([3.0,&nbsp;3.0,&nbsp;3.0]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target=np.array([0.0,&nbsp;0.0,&nbsp;0.0]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;up=np.array([0.0,&nbsp;0.0,&nbsp;1.0]),<br>
&nbsp;&nbsp;&nbsp;&nbsp;))<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene.add(camera_entity)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Красный&nbsp;куб<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube&nbsp;=&nbsp;Entity(name=&quot;cube&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;material&nbsp;=&nbsp;ColorMaterial(color=(1.0,&nbsp;0.3,&nbsp;0.3,&nbsp;1.0))<br>
&nbsp;&nbsp;&nbsp;&nbsp;cube.add_component(MeshRenderer(CubeMesh(),&nbsp;material=material))<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene.add(cube)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;world.add_scene(scene)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;scene,&nbsp;camera<br>
<br>
<br>
def&nbsp;main():<br>
&nbsp;&nbsp;&nbsp;&nbsp;world&nbsp;=&nbsp;VisualizationWorld()<br>
&nbsp;&nbsp;&nbsp;&nbsp;scene,&nbsp;camera&nbsp;=&nbsp;build_scene(world)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Создаём&nbsp;стриминг&nbsp;сервер<br>
&nbsp;&nbsp;&nbsp;&nbsp;server&nbsp;=&nbsp;WebStreamServer(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;world=world,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scene=scene,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;camera=camera,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width=1280,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;height=720,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fps=30,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quality=85,<br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;termin.visualization.core.world&nbsp;import&nbsp;CLOSE_AFTER_FIRST_FRAME<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;CLOSE_AFTER_FIRST_FRAME:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;CLOSE_AFTER_FIRST_FRAME&nbsp;is&nbsp;set,&nbsp;exiting&nbsp;after&nbsp;first&nbsp;frame.&quot;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Запускаем&nbsp;с&nbsp;HTTP&nbsp;сервером<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;WebSocket&nbsp;на&nbsp;порту&nbsp;8765,&nbsp;HTTP&nbsp;на&nbsp;8080<br>
&nbsp;&nbsp;&nbsp;&nbsp;try:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.run_with_http(host=&quot;0.0.0.0&quot;,&nbsp;ws_port=8765,&nbsp;http_port=8080)<br>
&nbsp;&nbsp;&nbsp;&nbsp;except:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server.run_with_http(host=&quot;0.0.0.0&quot;,&nbsp;ws_port=8745,&nbsp;http_port=8060)<br>
<br>
if&nbsp;__name__&nbsp;==&nbsp;&quot;__main__&quot;:<br>
&nbsp;&nbsp;&nbsp;&nbsp;main()<br>
<!-- END SCAT CODE -->
</body>
</html>
