<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>examples/project/stdlib/shaders/BlinnPhong.shader</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
@program&nbsp;BlinnPhong<br>
@features&nbsp;lighting_ubo<br>
<br>
//&nbsp;============================================================<br>
//&nbsp;Blinn-Phong&nbsp;Shader&nbsp;-&nbsp;Canonical&nbsp;Implementation<br>
//&nbsp;============================================================<br>
//<br>
//&nbsp;Classic&nbsp;Blinn-Phong&nbsp;illumination&nbsp;model:<br>
//&nbsp;&nbsp;&nbsp;I&nbsp;=&nbsp;Ka*Ia&nbsp;+&nbsp;Kd*Id*(N路L)&nbsp;+&nbsp;Ks*Is*(N路H)^n<br>
//<br>
//&nbsp;Where:<br>
//&nbsp;&nbsp;&nbsp;Ka,&nbsp;Kd,&nbsp;Ks&nbsp;-&nbsp;material&nbsp;coefficients&nbsp;(ambient,&nbsp;diffuse,&nbsp;specular)<br>
//&nbsp;&nbsp;&nbsp;Ia,&nbsp;Id,&nbsp;Is&nbsp;-&nbsp;light&nbsp;intensities<br>
//&nbsp;&nbsp;&nbsp;N&nbsp;-&nbsp;surface&nbsp;normal<br>
//&nbsp;&nbsp;&nbsp;L&nbsp;-&nbsp;direction&nbsp;to&nbsp;light<br>
//&nbsp;&nbsp;&nbsp;H&nbsp;-&nbsp;half-vector:&nbsp;normalize(L&nbsp;+&nbsp;V)<br>
//&nbsp;&nbsp;&nbsp;V&nbsp;-&nbsp;direction&nbsp;to&nbsp;viewer<br>
//&nbsp;&nbsp;&nbsp;n&nbsp;-&nbsp;shininess&nbsp;exponent<br>
//<br>
//&nbsp;============================================================<br>
<br>
@phase&nbsp;opaque<br>
@priority&nbsp;0<br>
@glDepthTest&nbsp;true<br>
@glDepthMask&nbsp;true<br>
@glCull&nbsp;true<br>
<br>
@property&nbsp;Color&nbsp;u_diffuse_color&nbsp;=&nbsp;Color(1.0,&nbsp;1.0,&nbsp;1.0,&nbsp;1.0)<br>
@property&nbsp;Color&nbsp;u_specular_color&nbsp;=&nbsp;Color(1.0,&nbsp;1.0,&nbsp;1.0,&nbsp;1.0)<br>
@property&nbsp;Float&nbsp;u_ambient_factor&nbsp;=&nbsp;1.0&nbsp;range(0.0,&nbsp;1.0)<br>
@property&nbsp;Float&nbsp;u_shininess&nbsp;=&nbsp;32.0&nbsp;range(1.0,&nbsp;256.0)<br>
@property&nbsp;Texture2D&nbsp;u_diffuse_texture&nbsp;=&nbsp;&quot;white&quot;<br>
<br>
@stage&nbsp;vertex<br>
#version&nbsp;330&nbsp;core<br>
<br>
layout(location&nbsp;=&nbsp;0)&nbsp;in&nbsp;vec3&nbsp;a_position;<br>
layout(location&nbsp;=&nbsp;1)&nbsp;in&nbsp;vec3&nbsp;a_normal;<br>
layout(location&nbsp;=&nbsp;2)&nbsp;in&nbsp;vec2&nbsp;a_uv;<br>
<br>
uniform&nbsp;mat4&nbsp;u_model;<br>
uniform&nbsp;mat4&nbsp;u_view;<br>
uniform&nbsp;mat4&nbsp;u_projection;<br>
<br>
out&nbsp;vec3&nbsp;v_world_pos;<br>
out&nbsp;vec3&nbsp;v_normal;<br>
out&nbsp;vec2&nbsp;v_uv;<br>
<br>
void&nbsp;main()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;world&nbsp;=&nbsp;u_model&nbsp;*&nbsp;vec4(a_position,&nbsp;1.0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;v_world_pos&nbsp;=&nbsp;world.xyz;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Transform&nbsp;normal&nbsp;to&nbsp;world&nbsp;space&nbsp;(handles&nbsp;non-uniform&nbsp;scale)<br>
&nbsp;&nbsp;&nbsp;&nbsp;mat3&nbsp;normal_matrix&nbsp;=&nbsp;transpose(inverse(mat3(u_model)));<br>
&nbsp;&nbsp;&nbsp;&nbsp;v_normal&nbsp;=&nbsp;normal_matrix&nbsp;*&nbsp;a_normal;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;v_uv&nbsp;=&nbsp;a_uv;<br>
&nbsp;&nbsp;&nbsp;&nbsp;gl_Position&nbsp;=&nbsp;u_projection&nbsp;*&nbsp;u_view&nbsp;*&nbsp;world;<br>
}<br>
@endstage<br>
<br>
@stage&nbsp;fragment<br>
#version&nbsp;330&nbsp;core<br>
<br>
in&nbsp;vec3&nbsp;v_world_pos;<br>
in&nbsp;vec3&nbsp;v_normal;<br>
in&nbsp;vec2&nbsp;v_uv;<br>
<br>
#include&nbsp;&quot;lighting.glsl&quot;<br>
#include&nbsp;&quot;shadows.glsl&quot;<br>
<br>
//&nbsp;Material&nbsp;properties<br>
uniform&nbsp;vec4&nbsp;u_diffuse_color;<br>
uniform&nbsp;vec4&nbsp;u_specular_color;<br>
uniform&nbsp;sampler2D&nbsp;u_diffuse_texture;<br>
uniform&nbsp;float&nbsp;u_ambient_factor;<br>
uniform&nbsp;float&nbsp;u_shininess;<br>
<br>
out&nbsp;vec4&nbsp;FragColor;<br>
<br>
void&nbsp;main()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Normalize&nbsp;interpolated&nbsp;normal<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;N&nbsp;=&nbsp;normalize(v_normal);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;View&nbsp;direction<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;V&nbsp;=&nbsp;normalize(get_camera_position()&nbsp;-&nbsp;v_world_pos);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Sample&nbsp;diffuse&nbsp;texture<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;tex_color&nbsp;=&nbsp;texture(u_diffuse_texture,&nbsp;v_uv);<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;Kd&nbsp;=&nbsp;u_diffuse_color.rgb&nbsp;*&nbsp;tex_color.rgb;&nbsp;&nbsp;//&nbsp;Diffuse&nbsp;coefficient<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;Ks&nbsp;=&nbsp;u_specular_color.rgb;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Specular&nbsp;coefficient<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;alpha&nbsp;=&nbsp;u_diffuse_color.a&nbsp;*&nbsp;tex_color.a;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Ambient&nbsp;term:&nbsp;Ka&nbsp;*&nbsp;Ia<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Ka&nbsp;=&nbsp;Kd&nbsp;*&nbsp;ambient_factor&nbsp;(common&nbsp;approximation)<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;Ka&nbsp;=&nbsp;Kd&nbsp;*&nbsp;u_ambient_factor;<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;ambient&nbsp;=&nbsp;Ka&nbsp;*&nbsp;get_ambient_color()&nbsp;*&nbsp;get_ambient_intensity();<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Accumulate&nbsp;light&nbsp;contributions<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;diffuse_sum&nbsp;=&nbsp;vec3(0.0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;specular_sum&nbsp;=&nbsp;vec3(0.0);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;get_light_count();&nbsp;++i)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;L;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Direction&nbsp;to&nbsp;light<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;atten&nbsp;=&nbsp;1.0;&nbsp;//&nbsp;Attenuation<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Compute&nbsp;light&nbsp;direction&nbsp;and&nbsp;attenuation&nbsp;based&nbsp;on&nbsp;light&nbsp;type<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(get_light_type(i)&nbsp;==&nbsp;LIGHT_TYPE_DIRECTIONAL)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L&nbsp;=&nbsp;normalize(-get_light_direction(i));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;to_light&nbsp;=&nbsp;get_light_position(i)&nbsp;-&nbsp;v_world_pos;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;dist&nbsp;=&nbsp;length(to_light);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L&nbsp;=&nbsp;to_light&nbsp;/&nbsp;max(dist,&nbsp;0.0001);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Distance&nbsp;attenuation<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;atten&nbsp;=&nbsp;compute_distance_attenuation(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_light_attenuation(i),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_light_range(i),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dist<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Spot&nbsp;cone&nbsp;attenuation<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(get_light_type(i)&nbsp;==&nbsp;LIGHT_TYPE_SPOT)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;atten&nbsp;*=&nbsp;compute_spot_weight(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_light_direction(i),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;L,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_light_inner_angle(i),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_light_outer_angle(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Shadow&nbsp;factor&nbsp;(directional&nbsp;lights&nbsp;only&nbsp;for&nbsp;now)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;shadow&nbsp;=&nbsp;1.0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(get_light_type(i)&nbsp;==&nbsp;LIGHT_TYPE_DIRECTIONAL)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shadow&nbsp;=&nbsp;compute_shadow_auto(i);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Light&nbsp;intensity<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;Li&nbsp;=&nbsp;get_light_color(i)&nbsp;*&nbsp;get_light_intensity(i)&nbsp;*&nbsp;atten&nbsp;*&nbsp;shadow;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Diffuse&nbsp;term:&nbsp;Kd&nbsp;*&nbsp;(N路L)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;NdotL&nbsp;=&nbsp;max(dot(N,&nbsp;L),&nbsp;0.0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diffuse_sum&nbsp;+=&nbsp;Kd&nbsp;*&nbsp;Li&nbsp;*&nbsp;NdotL;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Specular&nbsp;term:&nbsp;Ks&nbsp;*&nbsp;(N路H)^n<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Only&nbsp;compute&nbsp;if&nbsp;surface&nbsp;faces&nbsp;the&nbsp;light<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(NdotL&nbsp;&gt;&nbsp;0.0)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;H&nbsp;=&nbsp;normalize(L&nbsp;+&nbsp;V);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;NdotH&nbsp;=&nbsp;max(dot(N,&nbsp;H),&nbsp;0.0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;spec&nbsp;=&nbsp;pow(NdotH,&nbsp;u_shininess);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specular_sum&nbsp;+=&nbsp;Ks&nbsp;*&nbsp;Li&nbsp;*&nbsp;spec;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Final&nbsp;color:&nbsp;Ambient&nbsp;+&nbsp;Diffuse&nbsp;+&nbsp;Specular<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;color&nbsp;=&nbsp;ambient&nbsp;+&nbsp;diffuse_sum&nbsp;+&nbsp;specular_sum;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;FragColor&nbsp;=&nbsp;vec4(color,&nbsp;alpha);<br>
}<br>
@endstage<br>
<br>
@endphase<br>
<br>
//&nbsp;============================================================<br>
//&nbsp;Shadow&nbsp;caster&nbsp;phase<br>
//&nbsp;============================================================<br>
<br>
@phase&nbsp;shadow<br>
@priority&nbsp;0<br>
@glDepthTest&nbsp;true<br>
@glDepthMask&nbsp;true<br>
@glCull&nbsp;true<br>
<br>
@stage&nbsp;vertex<br>
#version&nbsp;330&nbsp;core<br>
<br>
layout(location&nbsp;=&nbsp;0)&nbsp;in&nbsp;vec3&nbsp;a_position;<br>
<br>
uniform&nbsp;mat4&nbsp;u_model;<br>
uniform&nbsp;mat4&nbsp;u_view;<br>
uniform&nbsp;mat4&nbsp;u_projection;<br>
<br>
void&nbsp;main()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;gl_Position&nbsp;=&nbsp;u_projection&nbsp;*&nbsp;u_view&nbsp;*&nbsp;u_model&nbsp;*&nbsp;vec4(a_position,&nbsp;1.0);<br>
}<br>
@endstage<br>
<br>
@stage&nbsp;fragment<br>
#version&nbsp;330&nbsp;core<br>
<br>
out&nbsp;vec4&nbsp;FragColor;<br>
<br>
void&nbsp;main()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;FragColor&nbsp;=&nbsp;vec4(gl_FragCoord.z,&nbsp;0.0,&nbsp;0.0,&nbsp;1.0);<br>
}<br>
@endstage<br>
<br>
@endphase<br>
<!-- END SCAT CODE -->
</body>
</html>
