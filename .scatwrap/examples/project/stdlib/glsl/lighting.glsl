<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>examples/project/stdlib/glsl/lighting.glsl</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
/**<br>
&nbsp;*&nbsp;Lighting&nbsp;utilities&nbsp;for&nbsp;Termin&nbsp;engine&nbsp;(UBO&nbsp;mode).<br>
&nbsp;*<br>
&nbsp;*&nbsp;Usage&nbsp;in&nbsp;your&nbsp;shader:<br>
&nbsp;*&nbsp;&nbsp;&nbsp;#include&nbsp;&quot;lighting.glsl&quot;<br>
&nbsp;*<br>
&nbsp;*&nbsp;Requires:<br>
&nbsp;*&nbsp;&nbsp;&nbsp;@features&nbsp;lighting_ubo<br>
&nbsp;*<br>
&nbsp;*&nbsp;Provides:<br>
&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;Light&nbsp;type&nbsp;constants<br>
&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;Accessor&nbsp;functions&nbsp;for&nbsp;light&nbsp;data<br>
&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;Attenuation&nbsp;functions<br>
&nbsp;*&nbsp;&nbsp;&nbsp;-&nbsp;Spotlight&nbsp;falloff<br>
&nbsp;*/<br>
<br>
#ifndef&nbsp;LIGHTING_GLSL<br>
#define&nbsp;LIGHTING_GLSL<br>
<br>
//&nbsp;==============&nbsp;Light&nbsp;Types&nbsp;==============<br>
const&nbsp;int&nbsp;LIGHT_TYPE_DIRECTIONAL&nbsp;=&nbsp;0;<br>
const&nbsp;int&nbsp;LIGHT_TYPE_POINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1;<br>
const&nbsp;int&nbsp;LIGHT_TYPE_SPOT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2;<br>
<br>
const&nbsp;int&nbsp;MAX_LIGHTS&nbsp;=&nbsp;8;<br>
<br>
//&nbsp;==============&nbsp;Lighting&nbsp;UBO&nbsp;==============<br>
//&nbsp;Light&nbsp;data&nbsp;structure&nbsp;matching&nbsp;C++&nbsp;LightDataStd140<br>
struct&nbsp;LightData&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;color_intensity;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;color.rgb,&nbsp;intensity<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;direction_range;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;direction.xyz,&nbsp;range<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;position_type;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;position.xyz,&nbsp;type<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;attenuation_inner;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;attenuation.xyz,&nbsp;inner_angle<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;outer_cascade;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;outer_angle,&nbsp;cascade_count,&nbsp;cascade_blend,&nbsp;blend_distance<br>
};<br>
<br>
//&nbsp;Lighting&nbsp;uniform&nbsp;block&nbsp;(std140&nbsp;layout)<br>
//&nbsp;Note:&nbsp;binding&nbsp;point&nbsp;is&nbsp;set&nbsp;via&nbsp;glUniformBlockBinding&nbsp;in&nbsp;C++&nbsp;(for&nbsp;GLSL&nbsp;330&nbsp;compatibility)<br>
layout(std140)&nbsp;uniform&nbsp;LightingBlock&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;LightData&nbsp;u_lights[MAX_LIGHTS];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;80&nbsp;bytes&nbsp;*&nbsp;8&nbsp;=&nbsp;640&nbsp;bytes<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;u_ambient_data;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;ambient_color.rgb,&nbsp;ambient_intensity<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;u_camera_light_count;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;camera_position.xyz,&nbsp;light_count<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec4&nbsp;u_shadow_settings;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;shadow_method,&nbsp;shadow_softness,&nbsp;shadow_bias,&nbsp;_pad<br>
};<br>
<br>
//&nbsp;==============&nbsp;Accessor&nbsp;Functions&nbsp;==============<br>
<br>
int&nbsp;get_light_count()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;int(u_camera_light_count.w);<br>
}<br>
<br>
int&nbsp;get_light_type(int&nbsp;i)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;int(u_lights[i].position_type.w);<br>
}<br>
<br>
vec3&nbsp;get_light_color(int&nbsp;i)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;u_lights[i].color_intensity.rgb;<br>
}<br>
<br>
float&nbsp;get_light_intensity(int&nbsp;i)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;u_lights[i].color_intensity.w;<br>
}<br>
<br>
vec3&nbsp;get_light_direction(int&nbsp;i)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;u_lights[i].direction_range.xyz;<br>
}<br>
<br>
vec3&nbsp;get_light_position(int&nbsp;i)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;u_lights[i].position_type.xyz;<br>
}<br>
<br>
float&nbsp;get_light_range(int&nbsp;i)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;u_lights[i].direction_range.w;<br>
}<br>
<br>
vec3&nbsp;get_light_attenuation(int&nbsp;i)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;u_lights[i].attenuation_inner.xyz;<br>
}<br>
<br>
float&nbsp;get_light_inner_angle(int&nbsp;i)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;u_lights[i].attenuation_inner.w;<br>
}<br>
<br>
float&nbsp;get_light_outer_angle(int&nbsp;i)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;u_lights[i].outer_cascade.x;<br>
}<br>
<br>
int&nbsp;get_light_cascade_count(int&nbsp;i)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;int(u_lights[i].outer_cascade.y);<br>
}<br>
<br>
int&nbsp;get_light_cascade_blend(int&nbsp;i)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;int(u_lights[i].outer_cascade.z);<br>
}<br>
<br>
float&nbsp;get_light_blend_distance(int&nbsp;i)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;u_lights[i].outer_cascade.w;<br>
}<br>
<br>
vec3&nbsp;get_ambient_color()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;u_ambient_data.rgb;<br>
}<br>
<br>
float&nbsp;get_ambient_intensity()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;u_ambient_data.w;<br>
}<br>
<br>
vec3&nbsp;get_camera_position()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;u_camera_light_count.xyz;<br>
}<br>
<br>
int&nbsp;get_shadow_method()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;int(u_shadow_settings.x);<br>
}<br>
<br>
float&nbsp;get_shadow_softness()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;u_shadow_settings.y;<br>
}<br>
<br>
float&nbsp;get_shadow_bias()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;u_shadow_settings.z;<br>
}<br>
<br>
//&nbsp;==============&nbsp;Common&nbsp;Functions&nbsp;==============<br>
<br>
/**<br>
&nbsp;*&nbsp;Compute&nbsp;distance&nbsp;attenuation&nbsp;for&nbsp;point/spot&nbsp;lights.<br>
&nbsp;*<br>
&nbsp;*&nbsp;Uses&nbsp;the&nbsp;formula:&nbsp;1&nbsp;/&nbsp;(constant&nbsp;+&nbsp;linear*d&nbsp;+&nbsp;quadratic*d^2)<br>
&nbsp;*&nbsp;With&nbsp;range&nbsp;cutoff.<br>
&nbsp;*<br>
&nbsp;*&nbsp;Parameters:<br>
&nbsp;*&nbsp;&nbsp;&nbsp;attenuation:&nbsp;vec3(constant,&nbsp;linear,&nbsp;quadratic)<br>
&nbsp;*&nbsp;&nbsp;&nbsp;range:&nbsp;maximum&nbsp;light&nbsp;range&nbsp;(0&nbsp;=&nbsp;infinite)<br>
&nbsp;*&nbsp;&nbsp;&nbsp;dist:&nbsp;distance&nbsp;from&nbsp;light&nbsp;to&nbsp;fragment<br>
&nbsp;*<br>
&nbsp;*&nbsp;Returns:<br>
&nbsp;*&nbsp;&nbsp;&nbsp;Attenuation&nbsp;factor&nbsp;[0,&nbsp;1]<br>
&nbsp;*/<br>
float&nbsp;compute_distance_attenuation(vec3&nbsp;attenuation,&nbsp;float&nbsp;range,&nbsp;float&nbsp;dist)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;denom&nbsp;=&nbsp;attenuation.x&nbsp;+&nbsp;attenuation.y&nbsp;*&nbsp;dist&nbsp;+&nbsp;attenuation.z&nbsp;*&nbsp;dist&nbsp;*&nbsp;dist;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(denom&nbsp;&lt;=&nbsp;0.0)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1.0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;w&nbsp;=&nbsp;1.0&nbsp;/&nbsp;denom;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(range&nbsp;&gt;&nbsp;0.0&nbsp;&amp;&amp;&nbsp;dist&nbsp;&gt;&nbsp;range)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;0.0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;w;<br>
}<br>
<br>
/**<br>
&nbsp;*&nbsp;Compute&nbsp;spotlight&nbsp;cone&nbsp;falloff.<br>
&nbsp;*<br>
&nbsp;*&nbsp;Parameters:<br>
&nbsp;*&nbsp;&nbsp;&nbsp;light_dir:&nbsp;normalized&nbsp;direction&nbsp;the&nbsp;spotlight&nbsp;is&nbsp;pointing<br>
&nbsp;*&nbsp;&nbsp;&nbsp;L:&nbsp;normalized&nbsp;direction&nbsp;from&nbsp;fragment&nbsp;to&nbsp;light<br>
&nbsp;*&nbsp;&nbsp;&nbsp;inner_angle:&nbsp;inner&nbsp;cone&nbsp;angle&nbsp;in&nbsp;radians&nbsp;(full&nbsp;intensity)<br>
&nbsp;*&nbsp;&nbsp;&nbsp;outer_angle:&nbsp;outer&nbsp;cone&nbsp;angle&nbsp;in&nbsp;radians&nbsp;(zero&nbsp;intensity)<br>
&nbsp;*<br>
&nbsp;*&nbsp;Returns:<br>
&nbsp;*&nbsp;&nbsp;&nbsp;Spotlight&nbsp;weight&nbsp;[0,&nbsp;1]&nbsp;with&nbsp;smooth&nbsp;falloff<br>
&nbsp;*/<br>
float&nbsp;compute_spot_weight(vec3&nbsp;light_dir,&nbsp;vec3&nbsp;L,&nbsp;float&nbsp;inner_angle,&nbsp;float&nbsp;outer_angle)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;cos_theta&nbsp;=&nbsp;dot(light_dir,&nbsp;-L);<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;cos_outer&nbsp;=&nbsp;cos(outer_angle);<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;cos_inner&nbsp;=&nbsp;cos(inner_angle);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cos_theta&nbsp;&lt;=&nbsp;cos_outer)&nbsp;return&nbsp;0.0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cos_theta&nbsp;&gt;=&nbsp;cos_inner)&nbsp;return&nbsp;1.0;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;t&nbsp;=&nbsp;(cos_theta&nbsp;-&nbsp;cos_outer)&nbsp;/&nbsp;(cos_inner&nbsp;-&nbsp;cos_outer);<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;t&nbsp;*&nbsp;t&nbsp;*&nbsp;(3.0&nbsp;-&nbsp;2.0&nbsp;*&nbsp;t);&nbsp;//&nbsp;smoothstep<br>
}<br>
<br>
/**<br>
&nbsp;*&nbsp;Blinn-Phong&nbsp;specular&nbsp;highlight.<br>
&nbsp;*<br>
&nbsp;*&nbsp;Parameters:<br>
&nbsp;*&nbsp;&nbsp;&nbsp;N:&nbsp;surface&nbsp;normal&nbsp;(normalized)<br>
&nbsp;*&nbsp;&nbsp;&nbsp;L:&nbsp;direction&nbsp;to&nbsp;light&nbsp;(normalized)<br>
&nbsp;*&nbsp;&nbsp;&nbsp;V:&nbsp;direction&nbsp;to&nbsp;viewer&nbsp;(normalized)<br>
&nbsp;*&nbsp;&nbsp;&nbsp;shininess:&nbsp;specular&nbsp;exponent&nbsp;(higher&nbsp;=&nbsp;smaller&nbsp;highlight)<br>
&nbsp;*<br>
&nbsp;*&nbsp;Returns:<br>
&nbsp;*&nbsp;&nbsp;&nbsp;Specular&nbsp;intensity<br>
&nbsp;*/<br>
float&nbsp;blinn_phong_specular(vec3&nbsp;N,&nbsp;vec3&nbsp;L,&nbsp;vec3&nbsp;V,&nbsp;float&nbsp;shininess)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;vec3&nbsp;H&nbsp;=&nbsp;normalize(L&nbsp;+&nbsp;V);<br>
&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;NdotH&nbsp;=&nbsp;max(dot(N,&nbsp;H),&nbsp;0.0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;pow(NdotH,&nbsp;shininess);<br>
}<br>
<br>
#endif&nbsp;//&nbsp;LIGHTING_GLSL<br>
<!-- END SCAT CODE -->
</body>
</html>
