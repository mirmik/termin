<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>utest/kinematics/kinematic_chain_test.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
import&nbsp;unittest<br>
from&nbsp;termin.kinematic&nbsp;import&nbsp;KinematicChain3<br>
from&nbsp;termin.kinematic&nbsp;import&nbsp;KinematicTransform3,&nbsp;Rotator3,&nbsp;Actuator3<br>
from&nbsp;termin.geombase&nbsp;import&nbsp;Pose3,&nbsp;Screw2,&nbsp;Screw3<br>
from&nbsp;termin.kinematic&nbsp;import&nbsp;Transform,&nbsp;Transform3<br>
import&nbsp;numpy<br>
<br>
class&nbsp;TestKinematicChain3(unittest.TestCase):<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_chain_construction(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base&nbsp;=&nbsp;Transform3()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotator&nbsp;=&nbsp;Rotator3(axis=numpy.array([0,&nbsp;0,&nbsp;1]),&nbsp;parent=base)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;actuator&nbsp;=&nbsp;Actuator3(axis=numpy.array([1,&nbsp;0,&nbsp;0]),&nbsp;parent=rotator)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end_effector&nbsp;=&nbsp;Transform3(parent=actuator.output)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chain&nbsp;=&nbsp;KinematicChain3(distal=end_effector)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertIs(chain.distal,&nbsp;end_effector)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertIs(chain.proximal,&nbsp;base)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertEqual(len(chain.kinunits()),&nbsp;2)&nbsp;&nbsp;#&nbsp;rotator&nbsp;and&nbsp;actuator<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertIs(chain.kinunits()[0],&nbsp;actuator)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertIs(chain.kinunits()[1],&nbsp;rotator)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertIs(chain.units()[0],&nbsp;end_effector)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertIs(chain.units()[1],&nbsp;actuator.output)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertIs(chain.units()[2],&nbsp;actuator)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertIs(chain.units()[3],&nbsp;rotator.output)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertIs(chain.units()[4],&nbsp;rotator)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertIs(chain.units()[5],&nbsp;base)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertEqual(len(chain.units()),&nbsp;6)&nbsp;&nbsp;#&nbsp;base,&nbsp;rotator+1,&nbsp;actuator+1,&nbsp;end_effector<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_apply_coordinate_changes(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base&nbsp;=&nbsp;Transform3()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotator&nbsp;=&nbsp;Rotator3(axis=numpy.array([0,&nbsp;0,&nbsp;1]),&nbsp;parent=base)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;actuator&nbsp;=&nbsp;Actuator3(axis=numpy.array([1,&nbsp;0,&nbsp;0]),&nbsp;parent=rotator)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end_effector&nbsp;=&nbsp;Transform3(parent=actuator.output)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chain&nbsp;=&nbsp;KinematicChain3(distal=end_effector)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial_rotator_angle&nbsp;=&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial_actuator_displacement&nbsp;=&nbsp;0<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delta_coords&nbsp;=&nbsp;[1.0,&nbsp;numpy.pi&nbsp;/&nbsp;2]&nbsp;&nbsp;#&nbsp;Rotate&nbsp;90&nbsp;degrees&nbsp;and&nbsp;extend&nbsp;by&nbsp;1.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chain.apply_coordinate_changes(delta_coords)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(rotator.get_coord(),&nbsp;numpy.pi&nbsp;/&nbsp;2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(actuator.get_coord(),&nbsp;1.0)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_sensitivity_twists(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base&nbsp;=&nbsp;Transform3()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotator&nbsp;=&nbsp;Rotator3(axis=numpy.array([0,&nbsp;0,&nbsp;1]),&nbsp;parent=base)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;actuator&nbsp;=&nbsp;Actuator3(axis=numpy.array([1,&nbsp;0,&nbsp;0]),&nbsp;parent=rotator)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end_effector&nbsp;=&nbsp;Transform3(parent=actuator.output)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chain&nbsp;=&nbsp;KinematicChain3(distal=end_effector)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_pose&nbsp;=&nbsp;Pose3.translation(0.0,&nbsp;0.0,&nbsp;0.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;twists&nbsp;=&nbsp;chain.sensitivity_twists(topbody=end_effector,&nbsp;local_pose=local_pose)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertEqual(len(twists),&nbsp;2)&nbsp;&nbsp;#&nbsp;One&nbsp;twist&nbsp;per&nbsp;kinematic&nbsp;unit<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertIsInstance(twists[0],&nbsp;Screw3)&nbsp;&nbsp;#&nbsp;Actuator&nbsp;twist<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertIsInstance(twists[1],&nbsp;Screw3)&nbsp;&nbsp;#&nbsp;Rotator&nbsp;twist<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Check&nbsp;that&nbsp;the&nbsp;twists&nbsp;correspond&nbsp;to&nbsp;the&nbsp;correct&nbsp;axes<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numpy.testing.assert_array_almost_equal(twists[0].lin,&nbsp;numpy.array([1,&nbsp;0,&nbsp;0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numpy.testing.assert_array_almost_equal(twists[0].ang,&nbsp;numpy.array([0,&nbsp;0,&nbsp;0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numpy.testing.assert_array_almost_equal(twists[1].lin,&nbsp;numpy.array([0,&nbsp;0,&nbsp;0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numpy.testing.assert_array_almost_equal(twists[1].ang,&nbsp;numpy.array([0,&nbsp;0,&nbsp;1]))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_sensitivity_twists_with_basis(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;basis&nbsp;=&nbsp;Pose3.rotateZ(numpy.pi&nbsp;/&nbsp;2)&nbsp;&nbsp;#&nbsp;90&nbsp;degree&nbsp;rotation&nbsp;around&nbsp;Z<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base&nbsp;=&nbsp;Transform3(basis)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotator&nbsp;=&nbsp;Rotator3(axis=numpy.array([0,&nbsp;0,&nbsp;1]),&nbsp;parent=base)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;actuator&nbsp;=&nbsp;Actuator3(axis=numpy.array([1,&nbsp;0,&nbsp;0]),&nbsp;parent=rotator)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end_effector&nbsp;=&nbsp;Transform3(parent=actuator.output)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chain&nbsp;=&nbsp;KinematicChain3(distal=end_effector)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_pose&nbsp;=&nbsp;Pose3.translation(0.0,&nbsp;0.0,&nbsp;0.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;twists&nbsp;=&nbsp;chain.sensitivity_twists(topbody=end_effector,&nbsp;local_pose=local_pose,&nbsp;basis=basis)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertEqual(len(twists),&nbsp;2)&nbsp;&nbsp;#&nbsp;One&nbsp;twist&nbsp;per&nbsp;kinematic&nbsp;unit<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Check&nbsp;that&nbsp;the&nbsp;twists&nbsp;are&nbsp;transformed&nbsp;correctly&nbsp;by&nbsp;the&nbsp;basis<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numpy.testing.assert_array_almost_equal(twists[0].lin,&nbsp;numpy.array([1,&nbsp;0,&nbsp;0]))&nbsp;&nbsp;#&nbsp;Actuator&nbsp;along&nbsp;Y&nbsp;in&nbsp;basis<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numpy.testing.assert_array_almost_equal(twists[0].ang,&nbsp;numpy.array([0,&nbsp;0,&nbsp;0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numpy.testing.assert_array_almost_equal(twists[1].lin,&nbsp;numpy.array([0,&nbsp;0,&nbsp;0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numpy.testing.assert_array_almost_equal(twists[1].ang,&nbsp;numpy.array([0,&nbsp;0,&nbsp;1]))<br>
<!-- END SCAT CODE -->
</body>
</html>
