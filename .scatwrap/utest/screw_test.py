<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>utest/screw_test.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
import&nbsp;unittest<br>
from&nbsp;termin.ga201.motor&nbsp;import&nbsp;Motor2<br>
from&nbsp;termin.ga201.screw&nbsp;import&nbsp;Screw2&nbsp;as&nbsp;GA201_Screw2<br>
from&nbsp;termin.geombase.screw&nbsp;import&nbsp;Screw2,&nbsp;Screw3<br>
from&nbsp;termin.geombase.pose2&nbsp;import&nbsp;Pose2<br>
from&nbsp;termin.geombase.pose3&nbsp;import&nbsp;Pose3<br>
import&nbsp;math<br>
import&nbsp;numpy<br>
<br>
<br>
def&nbsp;early(a,&nbsp;b):<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;abs(a.x&nbsp;-&nbsp;b.x)&nbsp;&gt;&nbsp;0.0001:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;False<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;abs(a.y&nbsp;-&nbsp;b.y)&nbsp;&gt;&nbsp;0.0001:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;False<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;abs(a.z&nbsp;-&nbsp;b.z)&nbsp;&gt;&nbsp;0.0001:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;False<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;True<br>
<br>
def&nbsp;screw_equal(a,&nbsp;b):<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;abs(a.moment()&nbsp;-&nbsp;b.moment())&nbsp;&gt;&nbsp;0.0001:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;False<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;abs(a.vector()[0]&nbsp;-&nbsp;b.vector()[0])&nbsp;&gt;&nbsp;0.0001:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;False<br>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;abs(a.vector()[1]&nbsp;-&nbsp;b.vector()[1])&nbsp;&gt;&nbsp;0.0001:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;False<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;True<br>
<br>
class&nbsp;TransformationProbe(unittest.TestCase):<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_moment_carry(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;motor&nbsp;=&nbsp;Motor2.translation(1,&nbsp;0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;GA201_Screw2(m=1,&nbsp;v=[0,0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carried&nbsp;=&nbsp;screw.kinematic_carry(motor)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invcarried&nbsp;=&nbsp;carried.kinematic_carry(motor.inverse())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invcarried2&nbsp;=&nbsp;carried.inverse_kinematic_carry(motor)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertEqual(carried.moment(),&nbsp;1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((carried.vector()&nbsp;==&nbsp;numpy.array([0,-1])).all())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue(screw_equal(invcarried,&nbsp;screw))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue(screw_equal(invcarried2,&nbsp;screw))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_vectory_carry(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;motor&nbsp;=&nbsp;Motor2.translation(1,&nbsp;0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;GA201_Screw2(m=0,&nbsp;v=[0,1])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carried&nbsp;=&nbsp;screw.kinematic_carry(motor)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertEqual(carried.moment(),&nbsp;0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((carried.vector()&nbsp;==&nbsp;numpy.array([0,1])).all())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_vectorx_carry(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;motor&nbsp;=&nbsp;Motor2.translation(1,&nbsp;0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;GA201_Screw2(m=0,&nbsp;v=[1,0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carried&nbsp;=&nbsp;screw.kinematic_carry(motor)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertEqual(carried.moment(),&nbsp;0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((carried.vector()&nbsp;==&nbsp;numpy.array([1,0])).all())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_moment_carry_with_rotation(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;motor&nbsp;=&nbsp;Motor2.translation(1,&nbsp;0)&nbsp;*&nbsp;Motor2.rotation(math.pi/2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;GA201_Screw2(m=1,&nbsp;v=[0,0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carried&nbsp;=&nbsp;screw.kinematic_carry(motor)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invcarried&nbsp;=&nbsp;carried.kinematic_carry(motor.inverse())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invcarried2&nbsp;=&nbsp;carried.inverse_kinematic_carry(motor)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertEqual(carried.moment(),&nbsp;1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((carried.vector()&nbsp;==&nbsp;numpy.array([0,-1])).all())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue(screw_equal(invcarried,&nbsp;screw))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue(screw_equal(invcarried2,&nbsp;screw))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_vectory_carry_with_rotation(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;motor&nbsp;=&nbsp;Motor2.translation(1,&nbsp;0)&nbsp;*&nbsp;Motor2.rotation(math.pi/2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;GA201_Screw2(m=0,&nbsp;v=[0,1])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carried&nbsp;=&nbsp;screw.kinematic_carry(motor)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertEqual(carried.moment(),&nbsp;0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue(screw_equal(carried,&nbsp;GA201_Screw2(m=0,&nbsp;v=[-1,0])))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_vectorx_carry_with_rotation(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;motor&nbsp;=&nbsp;Motor2.translation(1,&nbsp;0)&nbsp;*&nbsp;Motor2.rotation(math.pi/2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;GA201_Screw2(m=0,&nbsp;v=[1,0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carried&nbsp;=&nbsp;screw.kinematic_carry(motor)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertEqual(carried.moment(),&nbsp;0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue(screw_equal(carried,&nbsp;GA201_Screw2(m=0,&nbsp;v=[0,1])))<br>
<br>
<br>
class&nbsp;Screw2Tests(unittest.TestCase):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Tests&nbsp;for&nbsp;geombase.Screw2&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw2_creation(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw2(ang=numpy.array([1.0]),&nbsp;lin=numpy.array([2.0,&nbsp;3.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertEqual(screw.moment(),&nbsp;1.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((screw.vector()&nbsp;==&nbsp;numpy.array([2.0,&nbsp;3.0])).all())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw2_kinematic_carry(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw2(ang=numpy.array([1.0]),&nbsp;lin=numpy.array([0.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arm&nbsp;=&nbsp;numpy.array([1.0,&nbsp;0.0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carried&nbsp;=&nbsp;screw.kinematic_carry(arm)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(carried.moment(),&nbsp;1.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(carried.vector()[0],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(carried.vector()[1],&nbsp;-1.0,&nbsp;places=5)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw2_force_carry(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw2(ang=numpy.array([1.0]),&nbsp;lin=numpy.array([1.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arm&nbsp;=&nbsp;numpy.array([1.0,&nbsp;0.0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carried&nbsp;=&nbsp;screw.force_carry(arm)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(carried.moment(),&nbsp;1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((carried.vector()&nbsp;==&nbsp;numpy.array([1.0,&nbsp;0.0])).all())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw2_scalar_multiplication(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw2(ang=numpy.array([2.0]),&nbsp;lin=numpy.array([1.0,&nbsp;2.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scaled&nbsp;=&nbsp;screw&nbsp;*&nbsp;3.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(scaled.moment(),&nbsp;6.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((scaled.vector()&nbsp;==&nbsp;numpy.array([3.0,&nbsp;6.0])).all())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw2_addition(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw1&nbsp;=&nbsp;Screw2(ang=numpy.array([1.0]),&nbsp;lin=numpy.array([1.0,&nbsp;2.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw2&nbsp;=&nbsp;Screw2(ang=numpy.array([2.0]),&nbsp;lin=numpy.array([3.0,&nbsp;4.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;screw1&nbsp;+&nbsp;screw2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(result.moment(),&nbsp;3.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((result.vector()&nbsp;==&nbsp;numpy.array([4.0,&nbsp;6.0])).all())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw2_subtraction(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw1&nbsp;=&nbsp;Screw2(ang=numpy.array([5.0]),&nbsp;lin=numpy.array([10.0,&nbsp;8.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw2&nbsp;=&nbsp;Screw2(ang=numpy.array([2.0]),&nbsp;lin=numpy.array([3.0,&nbsp;2.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;screw1&nbsp;-&nbsp;screw2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(result.moment(),&nbsp;3.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((result.vector()&nbsp;==&nbsp;numpy.array([7.0,&nbsp;6.0])).all())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw2_transform_by_pose(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw2(ang=numpy.array([1.0]),&nbsp;lin=numpy.array([1.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pose&nbsp;=&nbsp;Pose2(ang=math.pi/2,&nbsp;lin=numpy.array([0.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transformed&nbsp;=&nbsp;screw.transform_by(pose)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.moment(),&nbsp;1.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.vector()[0],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.vector()[1],&nbsp;1.0,&nbsp;places=5)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw2_transform_as_twist(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Твист&nbsp;с&nbsp;угловой&nbsp;скоростью&nbsp;1&nbsp;и&nbsp;линейной&nbsp;скоростью&nbsp;[1,&nbsp;0]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw2(ang=numpy.array([1.0]),&nbsp;lin=numpy.array([1.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pose&nbsp;=&nbsp;Pose2(ang=0.0,&nbsp;lin=numpy.array([1.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transformed&nbsp;=&nbsp;screw.transform_as_twist_by(pose)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.moment(),&nbsp;1.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;v'&nbsp;=&nbsp;R*v&nbsp;+&nbsp;p&nbsp;×&nbsp;ω&nbsp;=&nbsp;[1,0]&nbsp;+&nbsp;[1,0]&nbsp;×&nbsp;1&nbsp;=&nbsp;[1,0]&nbsp;+&nbsp;[0,1]&nbsp;=&nbsp;[1,&nbsp;1]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.vector()[0],&nbsp;1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.vector()[1],&nbsp;1.0,&nbsp;places=5)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw2_transform_as_wrench(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Ренч&nbsp;с&nbsp;моментом&nbsp;1&nbsp;и&nbsp;силой&nbsp;[1,&nbsp;0]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw2(ang=numpy.array([1.0]),&nbsp;lin=numpy.array([1.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pose&nbsp;=&nbsp;Pose2(ang=0.0,&nbsp;lin=numpy.array([1.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transformed&nbsp;=&nbsp;screw.transform_as_wrench_by(pose)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;M'&nbsp;=&nbsp;M&nbsp;+&nbsp;p&nbsp;×&nbsp;F&nbsp;=&nbsp;1&nbsp;+&nbsp;1*0&nbsp;-&nbsp;0*1&nbsp;=&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.moment(),&nbsp;1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.vector()[0],&nbsp;1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.vector()[1],&nbsp;0.0,&nbsp;places=5)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw2_twist_local_to_global(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Проверка&nbsp;преобразования&nbsp;твиста&nbsp;из&nbsp;локальной&nbsp;системы&nbsp;в&nbsp;глобальную.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Пусть&nbsp;тело&nbsp;расположено&nbsp;в&nbsp;точке&nbsp;(1,&nbsp;0)&nbsp;с&nbsp;поворотом&nbsp;90°&nbsp;(π/2).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;В&nbsp;локальной&nbsp;системе&nbsp;тела&nbsp;твист:&nbsp;ω=1,&nbsp;v=[1,&nbsp;0]&nbsp;(движется&nbsp;вдоль&nbsp;локальной&nbsp;оси&nbsp;X).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;В&nbsp;глобальной&nbsp;системе:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;угловая&nbsp;скорость&nbsp;остается&nbsp;ω=1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;линейная&nbsp;скорость:&nbsp;v_global&nbsp;=&nbsp;R*v_local&nbsp;+&nbsp;p&nbsp;×&nbsp;ω<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;где&nbsp;p&nbsp;=&nbsp;[1,&nbsp;0],&nbsp;v_local&nbsp;=&nbsp;[1,&nbsp;0],&nbsp;R&nbsp;-&nbsp;поворот&nbsp;на&nbsp;90°<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;R*[1,0]&nbsp;=&nbsp;[0,&nbsp;1]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;p&nbsp;×&nbsp;ω&nbsp;=&nbsp;[1,&nbsp;0]&nbsp;×&nbsp;1&nbsp;=&nbsp;[0,&nbsp;1]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;v_global&nbsp;=&nbsp;[0,&nbsp;1]&nbsp;+&nbsp;[0,&nbsp;1]&nbsp;=&nbsp;[0,&nbsp;2]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Локальный&nbsp;твист:&nbsp;вращение&nbsp;ω=1,&nbsp;движение&nbsp;вдоль&nbsp;локальной&nbsp;X<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_twist&nbsp;=&nbsp;Screw2(ang=numpy.array([1.0]),&nbsp;lin=numpy.array([1.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Поза&nbsp;тела:&nbsp;смещение&nbsp;на&nbsp;(1,&nbsp;0)&nbsp;и&nbsp;поворот&nbsp;на&nbsp;90°<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body_pose&nbsp;=&nbsp;Pose2(ang=math.pi/2,&nbsp;lin=numpy.array([1.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Преобразуем&nbsp;в&nbsp;глобальную&nbsp;систему<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global_twist&nbsp;=&nbsp;local_twist.transform_as_twist_by(body_pose)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Угловая&nbsp;скорость&nbsp;не&nbsp;меняется<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.moment(),&nbsp;1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Линейная&nbsp;скорость&nbsp;в&nbsp;глобальной&nbsp;системе<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.vector()[0],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.vector()[1],&nbsp;2.0,&nbsp;places=5)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw2_twist_local_to_global_2(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_twist&nbsp;=&nbsp;Screw2(ang=numpy.array([1.0]),&nbsp;lin=numpy.array([0.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body_pose&nbsp;=&nbsp;Pose2(ang=0,&nbsp;lin=numpy.array([1.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global_twist&nbsp;=&nbsp;local_twist.transform_as_twist_by(body_pose)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.moment(),&nbsp;1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.vector()[0],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.vector()[1],&nbsp;1.0,&nbsp;places=5)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw2_twist_pure_rotation_at_origin(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Твист&nbsp;чистого&nbsp;вращения&nbsp;в&nbsp;начале&nbsp;координат&nbsp;не&nbsp;меняется&nbsp;при&nbsp;трансформации.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_twist&nbsp;=&nbsp;Screw2(ang=numpy.array([2.0]),&nbsp;lin=numpy.array([0.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body_pose&nbsp;=&nbsp;Pose2(ang=math.pi/4,&nbsp;lin=numpy.array([0.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global_twist&nbsp;=&nbsp;local_twist.transform_as_twist_by(body_pose)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.moment(),&nbsp;2.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.vector()[0],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.vector()[1],&nbsp;0.0,&nbsp;places=5)<br>
<br>
<br>
class&nbsp;Screw3Tests(unittest.TestCase):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Tests&nbsp;for&nbsp;geombase.Screw3&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw3_creation(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw3(ang=numpy.array([1.0,&nbsp;0.0,&nbsp;0.0]),&nbsp;lin=numpy.array([0.0,&nbsp;1.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((screw.moment()&nbsp;==&nbsp;numpy.array([1.0,&nbsp;0.0,&nbsp;0.0])).all())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((screw.vector()&nbsp;==&nbsp;numpy.array([0.0,&nbsp;1.0,&nbsp;0.0])).all())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw3_kinematic_carry(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Твист&nbsp;с&nbsp;чистой&nbsp;угловой&nbsp;скоростью&nbsp;вокруг&nbsp;Z<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw3(ang=numpy.array([0.0,&nbsp;0.0,&nbsp;1.0]),&nbsp;lin=numpy.array([0.0,&nbsp;0.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arm&nbsp;=&nbsp;numpy.array([1.0,&nbsp;0.0,&nbsp;0.0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carried&nbsp;=&nbsp;screw.kinematic_carry(arm)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;v'&nbsp;=&nbsp;v&nbsp;+&nbsp;ω&nbsp;×&nbsp;r&nbsp;=&nbsp;[0,0,0]&nbsp;+&nbsp;[0,0,1]&nbsp;×&nbsp;[1,0,0]&nbsp;=&nbsp;[0,&nbsp;1,&nbsp;0]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((carried.moment()&nbsp;==&nbsp;numpy.array([0.0,&nbsp;0.0,&nbsp;1.0])).all())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(carried.vector()[0],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(carried.vector()[1],&nbsp;1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(carried.vector()[2],&nbsp;0.0,&nbsp;places=5)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw3_force_carry(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Ренч&nbsp;с&nbsp;чистой&nbsp;силой<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw3(ang=numpy.array([0.0,&nbsp;0.0,&nbsp;0.0]),&nbsp;lin=numpy.array([0.0,&nbsp;0.0,&nbsp;1.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arm&nbsp;=&nbsp;numpy.array([1.0,&nbsp;0.0,&nbsp;0.0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carried&nbsp;=&nbsp;screw.force_carry(arm)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;M'&nbsp;=&nbsp;M&nbsp;-&nbsp;r&nbsp;×&nbsp;F&nbsp;=&nbsp;[0,0,0]&nbsp;-&nbsp;[1,0,0]&nbsp;×&nbsp;[0,0,1]&nbsp;=&nbsp;[0,&nbsp;1,&nbsp;0]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(carried.moment()[0],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(carried.moment()[1],&nbsp;1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(carried.moment()[2],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((carried.vector()&nbsp;==&nbsp;numpy.array([0.0,&nbsp;0.0,&nbsp;1.0])).all())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw3_scalar_multiplication(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw3(ang=numpy.array([1.0,&nbsp;2.0,&nbsp;3.0]),&nbsp;lin=numpy.array([4.0,&nbsp;5.0,&nbsp;6.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scaled&nbsp;=&nbsp;screw&nbsp;*&nbsp;2.0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((scaled.moment()&nbsp;==&nbsp;numpy.array([2.0,&nbsp;4.0,&nbsp;6.0])).all())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((scaled.vector()&nbsp;==&nbsp;numpy.array([8.0,&nbsp;10.0,&nbsp;12.0])).all())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw3_transform_by_pose(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Поворот&nbsp;вокруг&nbsp;Z&nbsp;на&nbsp;90&nbsp;градусов<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw3(ang=numpy.array([1.0,&nbsp;0.0,&nbsp;0.0]),&nbsp;lin=numpy.array([1.0,&nbsp;0.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pose&nbsp;=&nbsp;Pose3.rotateZ(math.pi/2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transformed&nbsp;=&nbsp;screw.transform_by(pose)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.moment()[0],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.moment()[1],&nbsp;1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.moment()[2],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.vector()[0],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.vector()[1],&nbsp;1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.vector()[2],&nbsp;0.0,&nbsp;places=5)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw3_transform_as_twist(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Твист&nbsp;с&nbsp;угловой&nbsp;скоростью&nbsp;вокруг&nbsp;Z<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw3(ang=numpy.array([0.0,&nbsp;0.0,&nbsp;1.0]),&nbsp;lin=numpy.array([0.0,&nbsp;0.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pose&nbsp;=&nbsp;Pose3.translation(1.0,&nbsp;0.0,&nbsp;0.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transformed&nbsp;=&nbsp;screw.transform_as_twist_by(pose)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;v'&nbsp;=&nbsp;v&nbsp;+&nbsp;p&nbsp;×&nbsp;ω&nbsp;=&nbsp;[0,0,0]&nbsp;+&nbsp;[1,0,0]&nbsp;×&nbsp;[0,0,1]&nbsp;=&nbsp;[0,&nbsp;-1,&nbsp;0]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((transformed.moment()&nbsp;==&nbsp;numpy.array([0.0,&nbsp;0.0,&nbsp;1.0])).all())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.vector()[0],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.vector()[1],&nbsp;-1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.vector()[2],&nbsp;0.0,&nbsp;places=5)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw3_transform_as_wrench(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Ренч&nbsp;с&nbsp;чистой&nbsp;силой&nbsp;по&nbsp;Z<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw3(ang=numpy.array([0.0,&nbsp;0.0,&nbsp;0.0]),&nbsp;lin=numpy.array([0.0,&nbsp;0.0,&nbsp;1.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pose&nbsp;=&nbsp;Pose3.translation(1.0,&nbsp;0.0,&nbsp;0.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transformed&nbsp;=&nbsp;screw.transform_as_wrench_by(pose)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;M'&nbsp;=&nbsp;M&nbsp;+&nbsp;p&nbsp;×&nbsp;F&nbsp;=&nbsp;[0,0,0]&nbsp;+&nbsp;[1,0,0]&nbsp;×&nbsp;[0,0,1]&nbsp;=&nbsp;[0,&nbsp;-1,&nbsp;0]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.moment()[0],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.moment()[1],&nbsp;-1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(transformed.moment()[2],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertTrue((transformed.vector()&nbsp;==&nbsp;numpy.array([0.0,&nbsp;0.0,&nbsp;1.0])).all())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw3_as_pose3(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Малый&nbsp;твист&nbsp;-&gt;&nbsp;Pose3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw3(ang=numpy.array([0.0,&nbsp;0.0,&nbsp;0.1]),&nbsp;lin=numpy.array([1.0,&nbsp;0.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pose&nbsp;=&nbsp;screw.as_pose3()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertIsInstance(pose,&nbsp;Pose3)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Проверяем,&nbsp;что&nbsp;линейная&nbsp;часть&nbsp;сохранилась<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(pose.lin[0],&nbsp;1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(pose.lin[1],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(pose.lin[2],&nbsp;0.0,&nbsp;places=5)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw3_inverse_transform(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;=&nbsp;Screw3(ang=numpy.array([1.0,&nbsp;0.0,&nbsp;0.0]),&nbsp;lin=numpy.array([0.0,&nbsp;1.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pose&nbsp;=&nbsp;Pose3.rotateZ(math.pi/2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transformed&nbsp;=&nbsp;screw.transform_by(pose)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;back&nbsp;=&nbsp;transformed.inverse_transform_by(pose)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Должны&nbsp;вернуться&nbsp;к&nbsp;исходному&nbsp;винту<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(back.moment()[0],&nbsp;1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(back.moment()[1],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(back.moment()[2],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(back.vector()[0],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(back.vector()[1],&nbsp;1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(back.vector()[2],&nbsp;0.0,&nbsp;places=5)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw3_twist_local_to_global(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Проверка&nbsp;преобразования&nbsp;твиста&nbsp;из&nbsp;локальной&nbsp;системы&nbsp;в&nbsp;глобальную&nbsp;для&nbsp;Screw3.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Пусть&nbsp;тело&nbsp;расположено&nbsp;в&nbsp;точке&nbsp;(1,&nbsp;0,&nbsp;0)&nbsp;без&nbsp;поворота.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;В&nbsp;локальной&nbsp;системе&nbsp;твист:&nbsp;ω=[0,0,1],&nbsp;v=[0,0,0]&nbsp;(чистое&nbsp;вращение&nbsp;вокруг&nbsp;Z).<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;В&nbsp;глобальной&nbsp;системе:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;угловая&nbsp;скорость:&nbsp;ω_global&nbsp;=&nbsp;R*ω&nbsp;=&nbsp;[0,0,1]&nbsp;(без&nbsp;поворота)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;линейная&nbsp;скорость:&nbsp;v_global&nbsp;=&nbsp;R*v&nbsp;+&nbsp;p&nbsp;×&nbsp;ω&nbsp;=&nbsp;[0,0,0]&nbsp;+&nbsp;[1,0,0]&nbsp;×&nbsp;[0,0,1]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;[0,-1,0]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_twist&nbsp;=&nbsp;Screw3(ang=numpy.array([0.0,&nbsp;0.0,&nbsp;1.0]),&nbsp;lin=numpy.array([0.0,&nbsp;0.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body_pose&nbsp;=&nbsp;Pose3.translation(1.0,&nbsp;0.0,&nbsp;0.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global_twist&nbsp;=&nbsp;local_twist.transform_as_twist_by(body_pose)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Угловая&nbsp;скорость&nbsp;не&nbsp;изменилась<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.moment()[0],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.moment()[1],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.moment()[2],&nbsp;1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Линейная&nbsp;скорость&nbsp;из-за&nbsp;вращения&nbsp;вокруг&nbsp;смещенной&nbsp;точки<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.vector()[0],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.vector()[1],&nbsp;-1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.vector()[2],&nbsp;0.0,&nbsp;places=5)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_screw3_twist_with_rotation(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;Твист&nbsp;с&nbsp;поворотом&nbsp;тела:&nbsp;проверяем,&nbsp;что&nbsp;угловая&nbsp;скорость&nbsp;поворачивается.&quot;&quot;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Локальный&nbsp;твист:&nbsp;вращение&nbsp;вокруг&nbsp;локальной&nbsp;оси&nbsp;X<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local_twist&nbsp;=&nbsp;Screw3(ang=numpy.array([1.0,&nbsp;0.0,&nbsp;0.0]),&nbsp;lin=numpy.array([0.0,&nbsp;0.0,&nbsp;0.0]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Тело&nbsp;повернуто&nbsp;на&nbsp;90°&nbsp;вокруг&nbsp;Z<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body_pose&nbsp;=&nbsp;Pose3.rotateZ(math.pi/2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global_twist&nbsp;=&nbsp;local_twist.transform_as_twist_by(body_pose)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Локальная&nbsp;ось&nbsp;X&nbsp;→&nbsp;глобальная&nbsp;ось&nbsp;Y<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.moment()[0],&nbsp;0.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.moment()[1],&nbsp;1.0,&nbsp;places=5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.assertAlmostEqual(global_twist.moment()[2],&nbsp;0.0,&nbsp;places=5)<br>
<!-- END SCAT CODE -->
</body>
</html>
