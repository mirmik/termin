<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>utest/fem/spatial_inertia3d_test.py</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
import&nbsp;numpy&nbsp;as&nbsp;np<br>
from&nbsp;termin.fem.inertia3d&nbsp;import&nbsp;SpatialInertia3D<br>
from&nbsp;termin.geombase.pose3&nbsp;import&nbsp;Pose3<br>
<br>
def&nbsp;test_spatial_inertia3d_add():<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Два&nbsp;тела&nbsp;с&nbsp;разными&nbsp;центрами&nbsp;масс&nbsp;и&nbsp;тензорами<br>
&nbsp;&nbsp;&nbsp;&nbsp;I1&nbsp;=&nbsp;SpatialInertia3D(2.0,&nbsp;np.eye(3),&nbsp;[0.0,&nbsp;0.0,&nbsp;0.0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;I2&nbsp;=&nbsp;SpatialInertia3D(3.0,&nbsp;2*np.eye(3),&nbsp;[1.0,&nbsp;0.0,&nbsp;0.0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;I_sum&nbsp;=&nbsp;I1&nbsp;+&nbsp;I2<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Проверяем&nbsp;массу<br>
&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;np.isclose(I_sum.m,&nbsp;5.0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Проверяем&nbsp;центр&nbsp;масс<br>
&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;np.allclose(I_sum.c,&nbsp;[0.6,&nbsp;0.0,&nbsp;0.0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Проверяем&nbsp;тензор&nbsp;инерции&nbsp;с&nbsp;учетом&nbsp;Штейнера<br>
&nbsp;&nbsp;&nbsp;&nbsp;d1&nbsp;=&nbsp;np.array([0.0,&nbsp;0.0,&nbsp;0.0])&nbsp;-&nbsp;np.array([0.6,&nbsp;0.0,&nbsp;0.0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;d2&nbsp;=&nbsp;np.array([1.0,&nbsp;0.0,&nbsp;0.0])&nbsp;-&nbsp;np.array([0.6,&nbsp;0.0,&nbsp;0.0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;skew1&nbsp;=&nbsp;np.array([[0,&nbsp;-d1[2],&nbsp;d1[1]],&nbsp;[d1[2],&nbsp;0,&nbsp;-d1[0]],&nbsp;[-d1[1],&nbsp;d1[0],&nbsp;0]])<br>
&nbsp;&nbsp;&nbsp;&nbsp;skew2&nbsp;=&nbsp;np.array([[0,&nbsp;-d2[2],&nbsp;d2[1]],&nbsp;[d2[2],&nbsp;0,&nbsp;-d2[0]],&nbsp;[-d2[1],&nbsp;d2[0],&nbsp;0]])<br>
&nbsp;&nbsp;&nbsp;&nbsp;expected_I&nbsp;=&nbsp;np.eye(3)&nbsp;+&nbsp;2*np.eye(3)&nbsp;+&nbsp;2.0&nbsp;*&nbsp;skew1&nbsp;@&nbsp;skew1.T&nbsp;+&nbsp;3.0&nbsp;*&nbsp;skew2&nbsp;@&nbsp;skew2.T<br>
&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;np.allclose(I_sum.Ic,&nbsp;expected_I)<br>
<br>
#&nbsp;def&nbsp;test_spatial_inertia3d_transform():<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Тело&nbsp;с&nbsp;центром&nbsp;масс&nbsp;не&nbsp;в&nbsp;начале<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;=&nbsp;SpatialInertia3D(1.0,&nbsp;np.eye(3),&nbsp;[1.0,&nbsp;2.0,&nbsp;3.0])<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Поворот&nbsp;на&nbsp;90°&nbsp;вокруг&nbsp;оси&nbsp;Z&nbsp;и&nbsp;сдвиг<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;angle&nbsp;=&nbsp;np.pi/2<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Кватернион&nbsp;для&nbsp;поворота&nbsp;на&nbsp;90°&nbsp;вокруг&nbsp;оси&nbsp;Z:&nbsp;[cos(a/2),&nbsp;0,&nbsp;0,&nbsp;sin(a/2)]<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qw&nbsp;=&nbsp;np.cos(angle/2)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qz&nbsp;=&nbsp;np.sin(angle/2)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quat&nbsp;=&nbsp;np.array([qw,&nbsp;0.0,&nbsp;0.0,&nbsp;qz])<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pose&nbsp;=&nbsp;Pose3(quat,&nbsp;np.array([3.0,&nbsp;4.0,&nbsp;5.0]))<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_tr&nbsp;=&nbsp;I.transform_by(pose)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Центр&nbsp;масс&nbsp;должен&nbsp;повернуться&nbsp;и&nbsp;сместиться<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expected_c&nbsp;=&nbsp;pose.transform_point([1.0,&nbsp;2.0,&nbsp;3.0])<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;np.allclose(I_tr.c,&nbsp;expected_c)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Тензор&nbsp;инерции&nbsp;должен&nbsp;повернуться<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rz&nbsp;=&nbsp;pose.rotation_matrix()<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expected_I&nbsp;=&nbsp;Rz&nbsp;@&nbsp;np.eye(3)&nbsp;@&nbsp;Rz.T&nbsp;+&nbsp;1.0&nbsp;*&nbsp;np.array([[0,&nbsp;-expected_c[2],&nbsp;expected_c[1]],&nbsp;[expected_c[2],&nbsp;0,&nbsp;-expected_c[0]],&nbsp;[-expected_c[1],&nbsp;expected_c[0],&nbsp;0]])&nbsp;@&nbsp;np.array([[0,&nbsp;-expected_c[2],&nbsp;expected_c[1]],&nbsp;[expected_c[2],&nbsp;0,&nbsp;-expected_c[0]],&nbsp;[-expected_c[1],&nbsp;expected_c[0],&nbsp;0]]).T<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;np.allclose(I_tr.I_com,&nbsp;expected_I)<br>
<br>
#&nbsp;def&nbsp;test_spatial_inertia3d_to_matrix():<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;=&nbsp;SpatialInertia3D(2.0,&nbsp;np.eye(3),&nbsp;[1.0,&nbsp;-2.0,&nbsp;3.0])<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mat&nbsp;=&nbsp;I.to_matrix_vw_order()<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c_skew&nbsp;=&nbsp;np.array([[0,&nbsp;-3.0,&nbsp;-2.0],&nbsp;[3.0,&nbsp;0,&nbsp;-1.0],&nbsp;[2.0,&nbsp;1.0,&nbsp;0]])<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;upper_left&nbsp;=&nbsp;np.eye(3)&nbsp;+&nbsp;2.0&nbsp;*&nbsp;(c_skew&nbsp;@&nbsp;c_skew.T)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;upper_right&nbsp;=&nbsp;2.0&nbsp;*&nbsp;c_skew<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lower_left&nbsp;=&nbsp;-2.0&nbsp;*&nbsp;c_skew.T<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lower_right&nbsp;=&nbsp;2.0&nbsp;*&nbsp;np.eye(3)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expected&nbsp;=&nbsp;np.block([<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[upper_left,&nbsp;upper_right],<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[lower_left,&nbsp;lower_right]<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;np.allclose(mat,&nbsp;expected)<br>
<br>
#&nbsp;def&nbsp;test_spatial_inertia3d_zero_mass():<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I1&nbsp;=&nbsp;SpatialInertia3D(0.0,&nbsp;np.zeros((3,3)),&nbsp;[0.0,&nbsp;0.0,&nbsp;0.0])<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I2&nbsp;=&nbsp;SpatialInertia3D(0.0,&nbsp;np.zeros((3,3)),&nbsp;[1.0,&nbsp;1.0,&nbsp;1.0])<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I_sum&nbsp;=&nbsp;I1&nbsp;+&nbsp;I2<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;np.isclose(I_sum.m,&nbsp;0.0)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;np.allclose(I_sum.c,&nbsp;[0.0,&nbsp;0.0,&nbsp;0.0])<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert&nbsp;np.allclose(I_sum.I_com,&nbsp;np.zeros((3,3)))<br>
<!-- END SCAT CODE -->
</body>
</html>
